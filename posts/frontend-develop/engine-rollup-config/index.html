<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å·¥ç¨‹åŒ–ï¼šRollup æ„å»º | æ›œçµï¼ˆSUNï¼‰Site</title><meta name=keywords content="å·¥ç¨‹åŒ–,Rollup"><meta name=description content="Rollupæ˜¯ä¸€ä¸ªç”¨äºJavaScriptçš„æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œä½¿ç”¨JavaScriptçš„ES6ç‰ˆæœ¬ä¸­åŒ…å«çš„æ–°æ ‡å‡†åŒ–ä»£ç æ¨¡å—æ ¼å¼ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„CommonJSå’ŒAMDç­‰ç‰¹æ®Šè§£å†³æ–¹æ¡ˆã€‚è®©ä½ åƒES æ¨¡å—ä¸€æ ·ï¼Œåœ¨æ‰€æœ‰åœºæ™¯è·å¾—åŸç”Ÿæ”¯æŒï¼Œè‡ªç”±æ— ç¼åœ°ç»„åˆä½ æœ€å–œæ¬¢çš„åº“ä¸­æœ€æœ‰ç”¨çš„ä¸ªåˆ«å‡½æ•°&mldr;"><meta name=author content="æ›œçµ"><link rel=canonical href=https://lianpf.github.io/posts/frontend-develop/engine-rollup-config/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lianpf.github.io/img-common/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://lianpf.github.io/img-common/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://lianpf.github.io/img-common/favicon.png><link rel=apple-touch-icon href=https://lianpf.github.io/img-common/avatar.jpeg><link rel=mask-icon href=https://lianpf.github.io/img-common/avatar.jpeg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="å·¥ç¨‹åŒ–ï¼šRollup æ„å»º"><meta property="og:description" content="Rollupæ˜¯ä¸€ä¸ªç”¨äºJavaScriptçš„æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œä½¿ç”¨JavaScriptçš„ES6ç‰ˆæœ¬ä¸­åŒ…å«çš„æ–°æ ‡å‡†åŒ–ä»£ç æ¨¡å—æ ¼å¼ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„CommonJSå’ŒAMDç­‰ç‰¹æ®Šè§£å†³æ–¹æ¡ˆã€‚è®©ä½ åƒES æ¨¡å—ä¸€æ ·ï¼Œåœ¨æ‰€æœ‰åœºæ™¯è·å¾—åŸç”Ÿæ”¯æŒï¼Œè‡ªç”±æ— ç¼åœ°ç»„åˆä½ æœ€å–œæ¬¢çš„åº“ä¸­æœ€æœ‰ç”¨çš„ä¸ªåˆ«å‡½æ•°&mldr;"><meta property="og:type" content="article"><meta property="og:url" content="https://lianpf.github.io/posts/frontend-develop/engine-rollup-config/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-27T19:36:15+08:00"><meta property="article:modified_time" content="2024-08-27T19:36:15+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="å·¥ç¨‹åŒ–ï¼šRollup æ„å»º"><meta name=twitter:description content="Rollupæ˜¯ä¸€ä¸ªç”¨äºJavaScriptçš„æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œä½¿ç”¨JavaScriptçš„ES6ç‰ˆæœ¬ä¸­åŒ…å«çš„æ–°æ ‡å‡†åŒ–ä»£ç æ¨¡å—æ ¼å¼ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„CommonJSå’ŒAMDç­‰ç‰¹æ®Šè§£å†³æ–¹æ¡ˆã€‚è®©ä½ åƒES æ¨¡å—ä¸€æ ·ï¼Œåœ¨æ‰€æœ‰åœºæ™¯è·å¾—åŸç”Ÿæ”¯æŒï¼Œè‡ªç”±æ— ç¼åœ°ç»„åˆä½ æœ€å–œæ¬¢çš„åº“ä¸­æœ€æœ‰ç”¨çš„ä¸ªåˆ«å‡½æ•°&mldr;"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://lianpf.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» å‰ç«¯","item":"https://lianpf.github.io/posts/frontend-develop/"},{"@type":"ListItem","position":3,"name":"å·¥ç¨‹åŒ–ï¼šRollup æ„å»º","item":"https://lianpf.github.io/posts/frontend-develop/engine-rollup-config/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"å·¥ç¨‹åŒ–ï¼šRollup æ„å»º","name":"å·¥ç¨‹åŒ–ï¼šRollup æ„å»º","description":"Rollupæ˜¯ä¸€ä¸ªç”¨äºJavaScriptçš„æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œä½¿ç”¨JavaScriptçš„ES6ç‰ˆæœ¬ä¸­åŒ…å«çš„æ–°æ ‡å‡†åŒ–ä»£ç æ¨¡å—æ ¼å¼ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„CommonJSå’ŒAMDç­‰ç‰¹æ®Šè§£å†³æ–¹æ¡ˆã€‚è®©ä½ åƒES æ¨¡å—ä¸€æ ·ï¼Œåœ¨æ‰€æœ‰åœºæ™¯è·å¾—åŸç”Ÿæ”¯æŒï¼Œè‡ªç”±æ— ç¼åœ°ç»„åˆä½ æœ€å–œæ¬¢çš„åº“ä¸­æœ€æœ‰ç”¨çš„ä¸ªåˆ«å‡½æ•°\u0026hellip;\n","keywords":["å·¥ç¨‹åŒ–","Rollup"],"articleBody":"Rollupæ˜¯ä¸€ä¸ªç”¨äºJavaScriptçš„æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œä½¿ç”¨JavaScriptçš„ES6ç‰ˆæœ¬ä¸­åŒ…å«çš„æ–°æ ‡å‡†åŒ–ä»£ç æ¨¡å—æ ¼å¼ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„CommonJSå’ŒAMDç­‰ç‰¹æ®Šè§£å†³æ–¹æ¡ˆã€‚è®©ä½ åƒES æ¨¡å—ä¸€æ ·ï¼Œåœ¨æ‰€æœ‰åœºæ™¯è·å¾—åŸç”Ÿæ”¯æŒï¼Œè‡ªç”±æ— ç¼åœ°ç»„åˆä½ æœ€å–œæ¬¢çš„åº“ä¸­æœ€æœ‰ç”¨çš„ä¸ªåˆ«å‡½æ•°â€¦\nç³»åˆ—æ–‡ç« ï¼š\nç¬¬ä¸€ç¯‡ï¼šå·¥ç¨‹åŒ–: babelçš„ä¸€äº›å¸¸è§é—®é¢˜ ç¬¬äºŒç¯‡ï¼šå·¥ç¨‹åŒ–ï¼šRollup æ„å»º ç¬¬äºŒç¯‡ï¼šå·¥ç¨‹åŒ–ï¼š@vue/cli å’Œ Webpack æ„å»º ä¸€ã€å®‰è£…ä½¿ç”¨ ä½œä¸º å…¨å±€å‘½ä»¤è¡Œå·¥å…· ä½¿ç”¨\n$ npm install --global rollup äºŒã€åŸºç¡€ç¤ºä¾‹ åœºæ™¯æè¿°ï¼šåˆ©ç”¨ES MODULEæœºåˆ¶ï¼Œå°è£…äº†ä¸€ä¸ª@js/sdkåŒ…ã€‚å…¶ä¸­ï¼Œè¦æ±‚å¯¹äº?.ç±»ä¼¼è¯­æ³•ï¼Œè¿›è¡ŒES5çš„ç¼–è¯‘å¤„ç†ã€‚@js/sdkå…·ä½“è¦æ±‚å¦‚ä¸‹:\nsdk/src/index.jså¯¼å‡ºå¦‚ä¸‹ï¼š export { modelA, modelB, // ... } from './zmini/index' sdk/src/utils/util.jsç­‰ä½¿ç”¨?.è¯­æ³•æ–‡ä»¶ï¼Œè¿›è¡Œç¼–è¯‘ï¼š const resError = { platform, code: error?.code, errorCode: error?.subCode, message: error?.message } å‰æœŸä¸»è¦åˆ©ç”¨bableï¼Œè¿›è¡Œæ„å»ºï¼Œæ‰€ä»¥éœ€è¦å…¼å®¹bableç›¸å…³é€»è¾‘ã€‚å†å²package.jsonæ ¸å¿ƒå¦‚ä¸‹ï¼š { \"scripts\": { \"build\": \"babel src -d lib\" // æ„å»ºå‘½ä»¤ }, \"devDependencies\": { \"@babel/cli\": \"^7.23.4\", // babel ä¾èµ– \"@babel/core\": \"^7.23.5\", \"@babel/preset-env\": \"^7.23.5\" } } 1.å®‰è£…ä¾èµ–å’Œæ–‡ä»¶é…ç½® 1.1 å®‰è£…ä¾èµ– å®‰è£…å¿…è¦çš„ä¾èµ–åŒ…ï¼š\n$ npm install --save-dev rollup @rollup/plugin-node-resolve @rollup/plugin-commonjs @rollup/plugin-babel @rollup/plugin-terser @babel/core @babel/preset-env @rollup/plugin-node-resolve: å…è®¸ Rollup æŸ¥æ‰¾å¹¶æ‰“åŒ… node_modules ä¸­çš„æ¨¡å—ã€‚ @rollup/plugin-commonjs: ä½¿ Rollup å¯ä»¥è½¬æ¢ CommonJS æ¨¡å—ä¸º ES6 æ¨¡å—ã€‚ @rollup/plugin-babel: é›†æˆ Babel ä»¥ä¾¿å¤„ç†ç°ä»£ JavaScript è¯­æ³•ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ”¯æŒæ›´è€çš„ç¯å¢ƒï¼ˆå¦‚ Node.js 12+ï¼‰çš„ä»£ç ã€‚ @rollup/plugin-terser: ç”¨äºå‹ç¼©è¾“å‡ºçš„ä»£ç ï¼Œä»¥å‡å°æ‰“åŒ…åçš„ä½“ç§¯ã€‚ babel.config.js: é…ç½® Babelï¼Œä½¿å…¶ä½¿ç”¨ @babel/preset-env æ¥æ ¹æ®ç›®æ ‡ç¯å¢ƒç¼–è¯‘ä»£ç ï¼Œå¹¶ä½¿ç”¨ core-js è‡ªåŠ¨å¼•å…¥ polyfill ä»¥æ”¯æŒå¯é€‰é“¾è¯­æ³•å’Œå…¶ä»–ç°ä»£ JavaScript ç‰¹æ€§ã€‚ 1.2 Rollup é…ç½®æ–‡ä»¶ åˆ›å»ºä¸€ä¸ª rollup.config.js æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nimport resolve from '@rollup/plugin-node-resolve'; import commonjs from '@rollup/plugin-commonjs'; import babel from '@rollup/plugin-babel'; import { terser } from '@rollup/plugin-terser'; // import terser from '@rollup/plugin-terser'; // æŸäº›ç‰ˆæœ¬æ˜¯é»˜è®¤å¯¼å‡º export default { input: 'src/index.js', // å…¥å£æ–‡ä»¶ output: [ // { // file: 'lib/bundle.cjs.js', // CommonJS è¾“å‡º // format: 'cjs', // sourcemap: true, // }, { file: 'lib/bundle.esm.js', // ES Module è¾“å‡º format: 'es', sourcemap: true, } ], external: ['@js/base-sdk'], // å¿½ç•¥package.jsonä¸­çš„ä¾èµ–ï¼Œé¿å…è¢«æ‰“åŒ…åˆ°libs plugins: [ resolve(), // è§£ææ¨¡å— commonjs(), // å¤„ç† CommonJS æ¨¡å— babel({ babelHelpers: 'bundled', exclude: 'node_modules/**', // åªç¼–è¯‘æˆ‘ä»¬çš„æºç  presets: [ [ '@babel/preset-env', { targets: { node: '12', // ç¡®ä¿æ”¯æŒ node 12+ }, useBuiltIns: 'usage', corejs: 3, // è‡ªåŠ¨å¼•å…¥ polyfill }, ], ], }), terser() // ä»£ç å‹ç¼© ], }; 1.3 Babel é…ç½®æ–‡ä»¶ åˆ›å»ºä¸€ä¸ª .babelrc æˆ– babel.config.js æ–‡ä»¶é…ç½®Babelï¼Œç¡®ä¿ç¼–è¯‘ç›®æ ‡æ”¯æŒè¾ƒè€çš„ Node.js ç¯å¢ƒï¼š\n{ \"presets\": [ [ \"@babel/preset-env\", { \"targets\": { \"node\": \"12\" }, \"useBuiltIns\": \"usage\", \"corejs\": 3 } ] ] } 2.æ„å»ºå‘½ä»¤ åœ¨ä½ çš„ sdk/package.json ä¸­ï¼Œæ›´æ–° scripts éƒ¨åˆ†ï¼Œä½¿ç”¨ Rollup æ„å»ºä½ çš„åŒ…ï¼š\n{ \"type\": \"module\", // ç¬¬ä¸€ç§æ–¹å¼ï¼šä½¿ç”¨ main å’Œ module ä¸¤ä¸ªé…ç½® // \"main\": \"./lib/bundle.cjs.js\", // CommonJS å…¥å£ // \"module\": \"./lib/bundle.esm.js\", // ES Module å…¥å£ // ç¬¬äºŒç§ï¼šåªä½¿ç”¨main â€”â€” æ¨èè¿™ç§ \"main\": \"./lib/bundle.esm.js\", // å…¥å£é…ç½®ES Module \"scripts\": { \"build\": \"rollup -c\" } } ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ„å»ºä½ çš„ SDK åŒ…ï¼š\n$ npm run build æ„å»ºå®Œæˆåï¼Œç”Ÿæˆçš„æ–‡ä»¶å°†åœ¨ lib/ ç›®å½•ä¸‹ï¼Œåˆ†åˆ«ä»¥ CommonJS å’Œ ES Module æ ¼å¼è¾“å‡ºã€‚è¿™äº›æ–‡ä»¶å°†å…¼å®¹ Node.js 12 åŠæ›´é«˜ç‰ˆæœ¬ã€‚\nä¸‰ã€å¸¸è§é—®é¢˜ 1. æƒ³è¦åœ¨node 16ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨rollupæ„å»ºï¼Œè¯·é—®æˆ‘è¦å¦‚ä½•å¤„ç†ï¼Ÿ å¼‚å¸¸å¦‚ä¸‹ï¼š\nlianpf@lianpf-PC:~/xxx/@js/sdk$ npm install --save-dev rollup @rollup/plugin-node-resolve @rollup/plugin-commonjs @rollup/plugin-babel @rollup/plugin-terser @babel/core @babel/preset-env npm WARN EBADENGINE Unsupported engine { npm WARN EBADENGINE package: 'rollup@4.21.0', npm WARN EBADENGINE required: { node: '\u003e=18.0.0', npm: '\u003e=8.0.0' }, npm WARN EBADENGINE current: { node: 'v16.17.1', npm: '8.15.0' } npm WARN EBADENGINE } added 63 packages, removed 4 packages, and changed 93 packages in 15s 20 packages are looking for funding run `npm fund` for details å¤„ç†æ–¹å¼ï¼š\nè¿™ä¸ªé”™è¯¯æ˜¯ç”±äºä½ å½“å‰ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬ (v16.17.1) å’Œ Rollup çš„æœ€æ–°ç‰ˆæœ¬ (4.21.0) ä¹‹é—´å­˜åœ¨ä¸å…¼å®¹é—®é¢˜ã€‚Rollup 4.21.0 è¦æ±‚ Node.js ç‰ˆæœ¬ä¸º 18.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè€Œä½ ç›®å‰ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ 16.17.1ï¼Œå› æ­¤å‡ºç°äº† EBADENGINE è­¦å‘Šã€‚\nè§£å†³æ–¹æ¡ˆï¼š å‡çº§ Node.js ç‰ˆæœ¬\næœ€ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯å‡çº§ä½ çš„ Node.js ç‰ˆæœ¬åˆ° 18.0.0 æˆ–æ›´é«˜ã€‚ä½ å¯ä»¥ä½¿ç”¨ n æˆ– nvm æ¥ç®¡ç†å’Œåˆ‡æ¢ Node.js ç‰ˆæœ¬ã€‚\nä½¿ç”¨ n å·¥å…·å‡çº§ï¼š\nsudo npm install -g n sudo n stable ä½¿ç”¨ nvm å·¥å…·å‡çº§ï¼š\nnvm install 18 nvm use 18 ç„¶åå†æ¬¡è¿è¡Œ npm install æ¥å®‰è£…ä¾èµ–ã€‚\nä½¿ç”¨æ”¯æŒ Node.js 16 çš„ Rollup ç‰ˆæœ¬\nå¦‚æœä½ æ— æ³•å‡çº§ Node.js ç‰ˆæœ¬ï¼ˆæ¯”å¦‚é¡¹ç›®éœ€è¦å…¼å®¹ Node.js 16ï¼‰ï¼Œä½ å¯ä»¥å®‰è£…ä¸€ä¸ªæ—§ç‰ˆæœ¬çš„ Rollupã€‚æ¯”å¦‚ï¼ŒRollup 3.x æ”¯æŒ Node.js 16ã€‚\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…è¾ƒæ—§çš„ Rollup ç‰ˆæœ¬ï¼š\nnpm install --save-dev rollup@3 @rollup/plugin-node-resolve @rollup/plugin-commonjs @rollup/plugin-babel @rollup/plugin-terser @babel/core @babel/preset-env 2. @rollup/plugin-commonjsä¸»è¦å¤„ç†ä»€ä¹ˆè¯­æ³•ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ï¼Œoutputæ‰éœ€è¦è¾“å‡ºCommonJSï¼Ÿ @rollup/plugin-commonjsæ’ä»¶ä¸»è¦å¤„ç†CommonJS(CJS)æ¨¡å—çš„è¯­æ³•ï¼Œç‰¹åˆ«åœ¨Node.jsç¯å¢ƒä¸­ã€‚å®ƒä½¿ç”¨require()å‡½æ•°æ¥åŒæ­¥åœ°åŠ è½½å…¶ä»–æ¨¡å—ï¼Œå¹¶é€šè¿‡ module.exportsæˆ–exportså¯¹è±¡æ¥å¯¼å‡ºæ¨¡å—çš„åŠŸèƒ½ã€‚\nç¤ºä¾‹ï¼š\nå‡è®¾ä½ æœ‰ä¸€ä¸ªCommonJSæ¨¡å—ï¼ˆmath.jsï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€äº›æ•°å­¦å‡½æ•°å¹¶å¯¼å‡ºå®ƒä»¬ï¼š\n// math.js (CommonJS) function add(a, b) { return a + b; } function subtract(a, b) { return a - b; } module.exports = { add, subtract }; ç„¶åï¼Œä½ æƒ³åœ¨å¦ä¸€ä¸ªä½¿ç”¨ ES æ¨¡å—è¯­æ³•çš„æ–‡ä»¶ä¸­å¯¼å…¥è¿™ä¸ª CommonJS æ¨¡å—ã€‚ä½†ç”±äº Rollup é»˜è®¤åªç†è§£ ES æ¨¡å—ï¼Œå®ƒæ— æ³•ç›´æ¥è§£æ require() è°ƒç”¨ã€‚è¿™å°±æ˜¯ @rollup/plugin-commonjs æ’ä»¶å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å®ƒå¯ä»¥å°† CommonJS æ¨¡å—è½¬æ¢ä¸º Rollup å¯ä»¥ç†è§£çš„ ES æ¨¡å—æ ¼å¼ã€‚\nä½•æ—¶éœ€è¦è¾“å‡º CommonJSæ ¼å¼ï¼ˆå¦‚ .cjs.jsï¼‰ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š èƒŒæ™¯ï¼šåœ¨Node.jsä¸­ï¼Œç‰ˆæœ¬12æ‰å¼€å§‹å¯¹ES æ¨¡å—æœ‰åŸºç¡€çš„æ”¯æŒ\nå…¼å®¹æ€§ï¼šæŸäº›åº“æˆ–åº”ç”¨ç¨‹åºï¼ˆå› ä¸ºéœ€è¦æ”¯æŒè¾ƒæ—§çš„Node.jsç‰ˆæœ¬æˆ–ç‰¹å®šç¯å¢ƒï¼‰ä¸æ”¯æŒES æ¨¡å—ã€‚ ç”Ÿæ€ç³»ç»Ÿæ”¯æŒï¼šè¾“å‡ºCommonJS æ ¼å¼å¯ç¡®ä¿ä½ çš„åº“æˆ–åº”ç”¨ç¨‹åºï¼Œè¢«åŸºäºCommonJSçš„å·¥å…·å’Œæ„å»ºç³»ç»Ÿï¼ˆå¦‚ï¼šNode.jsåŒ…ç®¡ç†å·¥å…·npmï¼‰æ‰€æ¶ˆè´¹ã€‚ æ€§èƒ½è€ƒè™‘ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒCommonJS æ¨¡å—æ¯”ES æ¨¡å—åŠ è½½å¾—æ›´å¿«ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸ä½¿ç”¨åŒæ­¥çš„require()è°ƒç”¨ã€‚ç„¶è€Œï¼Œåœ¨ç°ä»£Node.js ç‰ˆæœ¬ä¸­é€šå¸¸å·®å¼‚å¾ˆå°ï¼Œä¸”éšç€ES æ¨¡å—æ€§èƒ½çš„æå‡è€Œé€æ¸æ¶ˆå¤±ã€‚ å¤–éƒ¨ä½¿ç”¨åœºæ™¯ï¼šå¤–éƒ¨ä½¿ç”¨ CommonJS æ¨¡å—çš„åœºæ™¯éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š Node.js é¡¹ç›®ï¼šåœ¨ Node.js ä¸­ï¼Œç›´åˆ°ç‰ˆæœ¬ 12 æ‰å¼€å§‹å¯¹ ES æ¨¡å—æœ‰åŸºæœ¬çš„æ”¯æŒï¼Œè€Œ CommonJS ä»ç„¶æ˜¯ä¸»æµã€‚ é—ç•™ä»£ç åº“ï¼šè®¸å¤šæ—§çš„é¡¹ç›®å’Œåº“ä»ç„¶ä½¿ç”¨ CommonJSï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨ ES æ¨¡å—æˆä¸ºæ ‡å‡†ä¹‹å‰å°±å¼€å‘çš„ã€‚ æ··åˆé¡¹ç›®ï¼šåœ¨ä¸€äº›é¡¹ç›®ä¸­ï¼Œä½ å¯èƒ½éœ€è¦åŒæ—¶æ”¯æŒ ES æ¨¡å—å’Œ CommonJS æ¨¡å—ï¼Œä»¥ä¾¿èƒ½å¤Ÿå…¼å®¹ä¸åŒçš„ç¯å¢ƒæˆ–å·¥å…·é“¾ã€‚ npm åŒ…ï¼šç”±äº npm æ˜¯ JavaScript ç¤¾åŒºä¸­æœ€å¤§çš„åŒ…æ³¨å†Œè¡¨ä¹‹ä¸€ï¼Œå¹¶ä¸”è®¸å¤šåŒ…ä»ç„¶ä½¿ç”¨ CommonJSï¼Œå› æ­¤å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª npm åŒ…ï¼Œå¹¶å¸Œæœ›å®ƒèƒ½å¤Ÿè¢«å°½å¯èƒ½å¤šçš„é¡¹ç›®æ‰€ä½¿ç”¨ï¼Œé‚£ä¹ˆé€šå¸¸éœ€è¦æ”¯æŒ CommonJS æ ¼å¼ã€‚ 3. å¦‚ä½•ä¿æŒå¼€å‘å’Œæ„å»ºæ–‡ä»¶ç›®å½•ä¸€è‡´ï¼Œä»¥ä¾¿äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ï¼Ÿ ç¤ºä¾‹ï¼š å‡è®¾ä½ çš„ src ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\nsrc/ index.js utils/ helper.js components/ button.js modal.js åœ¨æ‰“åŒ…åï¼Œä½ çš„ lib ç›®å½•ç»“æ„å’Œsrcä¿æŒä¸€è‡´ï¼š\nlib/ index.js utils/ helper.js components/ button.js modal.js ä¼˜åŒ– rollup.config.jsï¼š\ndir é€‰é¡¹ï¼šåœ¨ output é…ç½®ä¸­ä½¿ç”¨ dir è€Œä¸æ˜¯ fileï¼ŒRollupä¼šå°†è¾“å‡ºçš„æ–‡ä»¶æ”¾åœ¨æŒ‡å®šçš„ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯ç”Ÿæˆå•ä¸€çš„æ–‡ä»¶ preserveModulesï¼šå¯ç”¨æ­¤é€‰é¡¹ï¼ŒRollupå°†ä¿ç•™æ¨¡å—çš„åŸå§‹ç»“æ„ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆæ¯ä¸ªæ¨¡å—ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ preserveModulesRootï¼šæŒ‡å®šä¿ç•™çš„æ¨¡å—ç›®å½•çš„æ ¹ç›®å½•ã€‚æ­¤ä¾‹ä¸­ï¼Œsrc ç›®å½•çš„å±‚çº§ç»“æ„ä¼šä¿æŒåˆ° lib ä¸­ export default { input: 'src/index.js', // å…¥å£æ–‡ä»¶ï¼ˆå¯æ”¯æŒå¤šä¸ªå…¥å£ï¼‰ output: [ { dir: 'lib', // è¾“å‡ºæ–‡ä»¶å¤¹ format: 'es', // ES Module è¾“å‡º sourcemap: true, preserveModules: true, // ä¿æŒæ¨¡å—ç»“æ„ preserveModulesRoot: 'src', // ä¿æŒ src ç›®å½•ç»“æ„ }, ], external: ['@js/base-sdk'], // å¿½ç•¥package.jsonä¸­çš„ä¾èµ–ï¼Œé¿å…è¢«æ‰“åŒ…åˆ°libs plugins: [ // ... ], }; æ€»ç»“ å¸¸ç”¨ï¼ˆæœ€ç»ˆï¼‰é…ç½® å¾…è¡¥å……â€¦\nå‚è€ƒ rollup.js ä¸­æ–‡æ–‡æ¡£ æœ€åï¼Œ å¸Œæœ›å¤§å®¶æ—©æ—¥å®ç°ï¼šæˆä¸ºç¼–ç¨‹é«˜æ‰‹çš„ä¼Ÿå¤§æ¢¦æƒ³ï¼ æ¬¢è¿äº¤æµ~\næœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ›œçµæ‰€æœ‰ï¼æœªç»å…è®¸ï¼Œä¸¥ç¦è½¬è½½ï¼å¯¹éæ³•è½¬è½½è€…, åŸä½œè€…ä¿ç•™é‡‡ç”¨æ³•å¾‹æ‰‹æ®µè¿½ç©¶çš„æƒåˆ©ï¼ è‹¥éœ€è½¬è½½ï¼Œè¯·è”ç³»å¾®ä¿¡å…¬ä¼—å·ï¼šè¿å…ˆç”Ÿæœ‰çŒ«ç—…ï¼Œå¯è·å–ä½œè€…è”ç³»æ–¹å¼ï¼\n","wordCount":"2806","inLanguage":"zh","datePublished":"2024-08-27T19:36:15+08:00","dateModified":"2024-08-27T19:36:15+08:00","author":[{"@type":"Person","name":"æ›œçµ"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://lianpf.github.io/posts/frontend-develop/engine-rollup-config/"},"publisher":{"@type":"Organization","name":"æ›œçµï¼ˆSUNï¼‰Site","logo":{"@type":"ImageObject","url":"https://lianpf.github.io/img-common/favicon.png"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lianpf.github.io/ accesskey=h title="æ›œçµï¼ˆSUNï¼‰Site (Alt + H)"><img src=https://lianpf.github.io/img-common/avatar.jpeg alt=logo aria-label=logo height=35>æ›œçµï¼ˆSUNï¼‰Site</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lianpf.github.io/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://lianpf.github.io/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://lianpf.github.io/archives/ title="â±ï¸ å½’æ¡£"><span>â±ï¸ å½’æ¡£</span></a></li><li><a href=https://lianpf.github.io/tags title="ğŸ§© æ ‡ç­¾"><span>ğŸ§© æ ‡ç­¾</span></a></li><li><a href=https://lianpf.github.io/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://lianpf.github.io/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://lianpf.github.io/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://lianpf.github.io/posts/frontend-develop/>ğŸ‘¨ğŸ»â€ğŸ’» å‰ç«¯</a></div><h1 class=post-title>å·¥ç¨‹åŒ–ï¼šRollup æ„å»º</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2024-08-27
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>2806å­—
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>6åˆ†é’Ÿ
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>æ›œçµ
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://lianpf.github.io/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/ style=color:var(--secondary)!important>å·¥ç¨‹åŒ–</a>
&nbsp;<a href=https://lianpf.github.io/tags/rollup/ style=color:var(--secondary)!important>Rollup</a></span></span></span></span>
<span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script>
<script>let url=document.documentURI,dnsUrl="https://lianpf.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:null,region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e4%b8%80%e5%ae%89%e8%a3%85%e4%bd%bf%e7%94%a8 aria-label=ä¸€ã€å®‰è£…ä½¿ç”¨>ä¸€ã€å®‰è£…ä½¿ç”¨</a></li><li><a href=#%e4%ba%8c%e5%9f%ba%e7%a1%80%e7%a4%ba%e4%be%8b aria-label=äºŒã€åŸºç¡€ç¤ºä¾‹>äºŒã€åŸºç¡€ç¤ºä¾‹</a><ul><li><a href=#1%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96%e5%92%8c%e6%96%87%e4%bb%b6%e9%85%8d%e7%bd%ae aria-label=1.å®‰è£…ä¾èµ–å’Œæ–‡ä»¶é…ç½®>1.å®‰è£…ä¾èµ–å’Œæ–‡ä»¶é…ç½®</a><ul><li><a href=#11-%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96 aria-label="1.1 å®‰è£…ä¾èµ–">1.1 å®‰è£…ä¾èµ–</a></li><li><a href=#12-rollup-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="1.2 Rollup é…ç½®æ–‡ä»¶">1.2 Rollup é…ç½®æ–‡ä»¶</a></li><li><a href=#13-babel-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="1.3 Babel é…ç½®æ–‡ä»¶">1.3 Babel é…ç½®æ–‡ä»¶</a></li></ul></li><li><a href=#2%e6%9e%84%e5%bb%ba%e5%91%bd%e4%bb%a4 aria-label=2.æ„å»ºå‘½ä»¤>2.æ„å»ºå‘½ä»¤</a></li></ul></li><li><a href=#%e4%b8%89%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98 aria-label=ä¸‰ã€å¸¸è§é—®é¢˜>ä¸‰ã€å¸¸è§é—®é¢˜</a><ul><li><a href=#1-%e6%83%b3%e8%a6%81%e5%9c%a8node-16%e7%8e%af%e5%a2%83%e4%b8%8b%e4%bd%bf%e7%94%a8rollup%e6%9e%84%e5%bb%ba%e8%af%b7%e9%97%ae%e6%88%91%e8%a6%81%e5%a6%82%e4%bd%95%e5%a4%84%e7%90%86 aria-label="1. æƒ³è¦åœ¨node 16ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨rollupæ„å»ºï¼Œè¯·é—®æˆ‘è¦å¦‚ä½•å¤„ç†ï¼Ÿ">1. æƒ³è¦åœ¨<code>node 16</code>ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨<code>rollup</code>æ„å»ºï¼Œè¯·é—®æˆ‘è¦å¦‚ä½•å¤„ç†ï¼Ÿ</a></li><li><a href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88 aria-label=è§£å†³æ–¹æ¡ˆï¼š>è§£å†³æ–¹æ¡ˆï¼š</a></li><li><a href=#2-rollupplugin-commonjs%e4%b8%bb%e8%a6%81%e5%a4%84%e7%90%86%e4%bb%80%e4%b9%88%e8%af%ad%e6%b3%95%e4%bb%80%e4%b9%88%e6%83%85%e5%86%b5%e4%b8%8boutput%e6%89%8d%e9%9c%80%e8%a6%81%e8%be%93%e5%87%bacommonjs aria-label="2. @rollup/plugin-commonjsä¸»è¦å¤„ç†ä»€ä¹ˆè¯­æ³•ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ï¼Œoutputæ‰éœ€è¦è¾“å‡ºCommonJSï¼Ÿ">2. <code>@rollup/plugin-commonjs</code>ä¸»è¦å¤„ç†ä»€ä¹ˆè¯­æ³•ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ï¼Œoutputæ‰éœ€è¦è¾“å‡ºCommonJSï¼Ÿ</a></li><li><a href=#3-%e5%a6%82%e4%bd%95%e4%bf%9d%e6%8c%81%e5%bc%80%e5%8f%91%e5%92%8c%e6%9e%84%e5%bb%ba%e6%96%87%e4%bb%b6%e7%9b%ae%e5%bd%95%e4%b8%80%e8%87%b4%e4%bb%a5%e4%be%bf%e4%ba%8e%e8%b0%83%e8%af%95%e5%92%8c%e6%8e%92%e6%9f%a5%e9%97%ae%e9%a2%98 aria-label="3. å¦‚ä½•ä¿æŒå¼€å‘å’Œæ„å»ºæ–‡ä»¶ç›®å½•ä¸€è‡´ï¼Œä»¥ä¾¿äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ï¼Ÿ">3. å¦‚ä½•ä¿æŒå¼€å‘å’Œæ„å»ºæ–‡ä»¶ç›®å½•ä¸€è‡´ï¼Œä»¥ä¾¿äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ï¼Ÿ</a></li></ul></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=æ€»ç»“>æ€»ç»“</a><ul><li><a href=#%e5%b8%b8%e7%94%a8%e6%9c%80%e7%bb%88%e9%85%8d%e7%bd%ae aria-label=å¸¸ç”¨ï¼ˆæœ€ç»ˆï¼‰é…ç½®>å¸¸ç”¨ï¼ˆæœ€ç»ˆï¼‰é…ç½®</a></li></ul></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=å‚è€ƒ>å‚è€ƒ</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p><code>Rollup</code>æ˜¯ä¸€ä¸ªç”¨äº<code>JavaScript</code>çš„æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œä½¿ç”¨<code>JavaScript</code>çš„<code>ES6</code>ç‰ˆæœ¬ä¸­åŒ…å«çš„æ–°æ ‡å‡†åŒ–ä»£ç æ¨¡å—æ ¼å¼ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„<code>CommonJS</code>å’Œ<code>AMD</code>ç­‰ç‰¹æ®Šè§£å†³æ–¹æ¡ˆã€‚è®©ä½ åƒ<code>ES æ¨¡å—</code>ä¸€æ ·ï¼Œåœ¨æ‰€æœ‰åœºæ™¯è·å¾—åŸç”Ÿæ”¯æŒï¼Œè‡ªç”±æ— ç¼åœ°ç»„åˆ<strong>ä½ æœ€å–œæ¬¢çš„åº“ä¸­æœ€æœ‰ç”¨çš„ä¸ªåˆ«å‡½æ•°</strong>&mldr;</p><p>ç³»åˆ—æ–‡ç« ï¼š</p><ul><li>ç¬¬ä¸€ç¯‡ï¼š<a href=/posts/frontend-develop/engine-babel-faq/>å·¥ç¨‹åŒ–: babelçš„ä¸€äº›å¸¸è§é—®é¢˜</a></li><li>ç¬¬äºŒç¯‡ï¼š<a href=/posts/frontend-develop/engine-rollup-config/>å·¥ç¨‹åŒ–ï¼šRollup æ„å»º</a></li><li>ç¬¬äºŒç¯‡ï¼š<a href=/posts/frontend-develop/engine-webpack-vuecli-config/>å·¥ç¨‹åŒ–ï¼š@vue/cli å’Œ Webpack æ„å»º</a></li></ul><hr><h2 id=ä¸€å®‰è£…ä½¿ç”¨>ä¸€ã€å®‰è£…ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#ä¸€å®‰è£…ä½¿ç”¨>#</a></h2><p>ä½œä¸º <strong><font color=Tomato>å…¨å±€å‘½ä»¤è¡Œå·¥å…·</font></strong> ä½¿ç”¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm install --global rollup
</span></span></code></pre></div><hr><h2 id=äºŒåŸºç¡€ç¤ºä¾‹>äºŒã€åŸºç¡€ç¤ºä¾‹<a hidden class=anchor aria-hidden=true href=#äºŒåŸºç¡€ç¤ºä¾‹>#</a></h2><p>åœºæ™¯æè¿°ï¼šåˆ©ç”¨<code>ES MODULE</code>æœºåˆ¶ï¼Œå°è£…äº†ä¸€ä¸ª<code>@js/sdk</code>åŒ…ã€‚å…¶ä¸­ï¼Œè¦æ±‚å¯¹äº<code>?.</code>ç±»ä¼¼è¯­æ³•ï¼Œè¿›è¡Œ<code>ES5</code>çš„ç¼–è¯‘å¤„ç†ã€‚<code>@js/sdk</code>å…·ä½“è¦æ±‚å¦‚ä¸‹:</p><ul><li><code>sdk/src/index.js</code>å¯¼å‡ºå¦‚ä¸‹ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>export</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>modelA</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>modelB</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./zmini/index&#39;</span> 
</span></span></code></pre></div><ul><li><code>sdk/src/utils/util.js</code>ç­‰ä½¿ç”¨<code>?.</code>è¯­æ³•æ–‡ä»¶ï¼Œè¿›è¡Œç¼–è¯‘ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>resError</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>platform</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>error</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>code</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>errorCode</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>error</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>subCode</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>error</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>message</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>å‰æœŸä¸»è¦åˆ©ç”¨<code>bable</code>ï¼Œè¿›è¡Œæ„å»ºï¼Œæ‰€ä»¥éœ€è¦å…¼å®¹<code>bable</code>ç›¸å…³é€»è¾‘ã€‚å†å²<code>package.json</code>æ ¸å¿ƒå¦‚ä¸‹ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;scripts&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;build&#34;</span>: <span style=color:#e6db74>&#34;babel src -d lib&#34;</span> // æ„å»ºå‘½ä»¤
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;devDependencies&#34;</span>: <span style=color:#f92672>{</span> 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;@babel/cli&#34;</span>: <span style=color:#e6db74>&#34;^7.23.4&#34;</span>, // babel ä¾èµ–
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;@babel/core&#34;</span>: <span style=color:#e6db74>&#34;^7.23.5&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;@babel/preset-env&#34;</span>: <span style=color:#e6db74>&#34;^7.23.5&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=1å®‰è£…ä¾èµ–å’Œæ–‡ä»¶é…ç½®>1.å®‰è£…ä¾èµ–å’Œæ–‡ä»¶é…ç½®<a hidden class=anchor aria-hidden=true href=#1å®‰è£…ä¾èµ–å’Œæ–‡ä»¶é…ç½®>#</a></h3><h4 id=11-å®‰è£…ä¾èµ–>1.1 å®‰è£…ä¾èµ–<a hidden class=anchor aria-hidden=true href=#11-å®‰è£…ä¾èµ–>#</a></h4><p><strong>å®‰è£…å¿…è¦çš„ä¾èµ–åŒ…</strong>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm install --save-dev rollup @rollup/plugin-node-resolve @rollup/plugin-commonjs @rollup/plugin-babel @rollup/plugin-terser @babel/core @babel/preset-env
</span></span></code></pre></div><ul><li><strong><code>@rollup/plugin-node-resolve</code></strong>: å…è®¸ Rollup æŸ¥æ‰¾å¹¶æ‰“åŒ… <code>node_modules</code> ä¸­çš„æ¨¡å—ã€‚</li><li><strong><code>@rollup/plugin-commonjs</code></strong>: ä½¿ Rollup å¯ä»¥è½¬æ¢ CommonJS æ¨¡å—ä¸º ES6 æ¨¡å—ã€‚</li><li><strong><code>@rollup/plugin-babel</code></strong>: é›†æˆ Babel ä»¥ä¾¿å¤„ç†ç°ä»£ JavaScript è¯­æ³•ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ”¯æŒæ›´è€çš„ç¯å¢ƒï¼ˆå¦‚ Node.js 12+ï¼‰çš„ä»£ç ã€‚</li><li><strong><code>@rollup/plugin-terser</code></strong>: ç”¨äºå‹ç¼©è¾“å‡ºçš„ä»£ç ï¼Œä»¥å‡å°æ‰“åŒ…åçš„ä½“ç§¯ã€‚</li><li><strong><code>babel.config.js</code></strong>: é…ç½® Babelï¼Œä½¿å…¶ä½¿ç”¨ <code>@babel/preset-env</code> æ¥æ ¹æ®ç›®æ ‡ç¯å¢ƒç¼–è¯‘ä»£ç ï¼Œå¹¶ä½¿ç”¨ <code>core-js</code> è‡ªåŠ¨å¼•å…¥ polyfill ä»¥æ”¯æŒå¯é€‰é“¾è¯­æ³•å’Œå…¶ä»–ç°ä»£ JavaScript ç‰¹æ€§ã€‚</li></ul><h4 id=12-rollup-é…ç½®æ–‡ä»¶>1.2 Rollup é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#12-rollup-é…ç½®æ–‡ä»¶>#</a></h4><p>åˆ›å»ºä¸€ä¸ª <code>rollup.config.js</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>resolve</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@rollup/plugin-node-resolve&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>commonjs</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@rollup/plugin-commonjs&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>babel</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@rollup/plugin-babel&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>terser</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@rollup/plugin-terser&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// import terser from &#39;@rollup/plugin-terser&#39;; // æŸäº›ç‰ˆæœ¬æ˜¯é»˜è®¤å¯¼å‡º
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>input</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;src/index.js&#39;</span>, <span style=color:#75715e>// å…¥å£æ–‡ä»¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>output</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>    <span style=color:#75715e>//     {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//         file: &#39;lib/bundle.cjs.js&#39;, // CommonJS è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//         format: &#39;cjs&#39;,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//         sourcemap: true,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//    },
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>       {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>file</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;lib/bundle.esm.js&#39;</span>, <span style=color:#75715e>// ES Module è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>format</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;es&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>sourcemap</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>external</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;@js/base-sdk&#39;</span>], <span style=color:#75715e>// å¿½ç•¥package.jsonä¸­çš„ä¾èµ–ï¼Œé¿å…è¢«æ‰“åŒ…åˆ°libs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>plugins</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resolve</span>(), <span style=color:#75715e>// è§£ææ¨¡å—
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>commonjs</span>(), <span style=color:#75715e>// å¤„ç† CommonJS æ¨¡å—
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>babel</span>({
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>babelHelpers</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;bundled&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>exclude</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;node_modules/**&#39;</span>, <span style=color:#75715e>// åªç¼–è¯‘æˆ‘ä»¬çš„æºç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>presets</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;@babel/preset-env&#39;</span>,
</span></span><span style=display:flex><span>                    {
</span></span><span style=display:flex><span>                       <span style=color:#a6e22e>targets</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>                         <span style=color:#a6e22e>node</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;12&#39;</span>, <span style=color:#75715e>// ç¡®ä¿æ”¯æŒ node 12+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                       },
</span></span><span style=display:flex><span>                       <span style=color:#a6e22e>useBuiltIns</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;usage&#39;</span>,
</span></span><span style=display:flex><span>                       <span style=color:#a6e22e>corejs</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>, <span style=color:#75715e>// è‡ªåŠ¨å¼•å…¥ polyfill
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    },
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>       }),
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>terser</span>() <span style=color:#75715e>// ä»£ç å‹ç¼©
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    ],
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h4 id=13-babel-é…ç½®æ–‡ä»¶>1.3 Babel é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#13-babel-é…ç½®æ–‡ä»¶>#</a></h4><p>åˆ›å»ºä¸€ä¸ª <code>.babelrc</code> æˆ– <code>babel.config.js</code> æ–‡ä»¶é…ç½®Babelï¼Œç¡®ä¿ç¼–è¯‘ç›®æ ‡æ”¯æŒè¾ƒè€çš„ Node.js ç¯å¢ƒï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;presets&#34;</span>: [
</span></span><span style=display:flex><span>        [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;@babel/preset-env&#34;</span>,
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>               <span style=color:#f92672>&#34;targets&#34;</span>: {
</span></span><span style=display:flex><span>                 <span style=color:#f92672>&#34;node&#34;</span>: <span style=color:#e6db74>&#34;12&#34;</span>
</span></span><span style=display:flex><span>               },
</span></span><span style=display:flex><span>               <span style=color:#f92672>&#34;useBuiltIns&#34;</span>: <span style=color:#e6db74>&#34;usage&#34;</span>,
</span></span><span style=display:flex><span>               <span style=color:#f92672>&#34;corejs&#34;</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2æ„å»ºå‘½ä»¤>2.æ„å»ºå‘½ä»¤<a hidden class=anchor aria-hidden=true href=#2æ„å»ºå‘½ä»¤>#</a></h3><p>åœ¨ä½ çš„ <code>sdk/package.json</code> ä¸­ï¼Œæ›´æ–° <code>scripts</code> éƒ¨åˆ†ï¼Œä½¿ç”¨ Rollup æ„å»ºä½ çš„åŒ…ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;module&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç¬¬ä¸€ç§æ–¹å¼ï¼šä½¿ç”¨ main å’Œ module ä¸¤ä¸ªé…ç½®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// &#34;main&#34;: &#34;./lib/bundle.cjs.js&#34;,  // CommonJS å…¥å£
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// &#34;module&#34;: &#34;./lib/bundle.esm.js&#34;, // ES Module å…¥å£
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// ç¬¬äºŒç§ï¼šåªä½¿ç”¨main â€”â€” æ¨èè¿™ç§
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>&#34;main&#34;</span>: <span style=color:#e6db74>&#34;./lib/bundle.esm.js&#34;</span>,  <span style=color:#75715e>// å…¥å£é…ç½®ES Module
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>&#34;scripts&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;build&#34;</span>: <span style=color:#e6db74>&#34;rollup -c&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ„å»ºä½ çš„ SDK åŒ…ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm run build
</span></span></code></pre></div><p>æ„å»ºå®Œæˆåï¼Œç”Ÿæˆçš„æ–‡ä»¶å°†åœ¨ <code>lib/</code> ç›®å½•ä¸‹ï¼Œåˆ†åˆ«ä»¥ CommonJS å’Œ ES Module æ ¼å¼è¾“å‡ºã€‚è¿™äº›æ–‡ä»¶å°†å…¼å®¹ Node.js 12 åŠæ›´é«˜ç‰ˆæœ¬ã€‚</p><hr><h2 id=ä¸‰å¸¸è§é—®é¢˜>ä¸‰ã€å¸¸è§é—®é¢˜<a hidden class=anchor aria-hidden=true href=#ä¸‰å¸¸è§é—®é¢˜>#</a></h2><h3 id=1-æƒ³è¦åœ¨node-16ç¯å¢ƒä¸‹ä½¿ç”¨rollupæ„å»ºè¯·é—®æˆ‘è¦å¦‚ä½•å¤„ç†>1. æƒ³è¦åœ¨<code>node 16</code>ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨<code>rollup</code>æ„å»ºï¼Œè¯·é—®æˆ‘è¦å¦‚ä½•å¤„ç†ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#1-æƒ³è¦åœ¨node-16ç¯å¢ƒä¸‹ä½¿ç”¨rollupæ„å»ºè¯·é—®æˆ‘è¦å¦‚ä½•å¤„ç†>#</a></h3><p>å¼‚å¸¸å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lianpf@lianpf-PC:~/xxx/@js/sdk$ npm install --save-dev rollup @rollup/plugin-node-resolve @rollup/plugin-commonjs @rollup/plugin-babel @rollup/plugin-terser @babel/core @babel/preset-env
</span></span><span style=display:flex><span>npm WARN EBADENGINE Unsupported engine <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>npm WARN EBADENGINE   package: <span style=color:#e6db74>&#39;rollup@4.21.0&#39;</span>,
</span></span><span style=display:flex><span>npm WARN EBADENGINE   required: <span style=color:#f92672>{</span> node: <span style=color:#e6db74>&#39;&gt;=18.0.0&#39;</span>, npm: <span style=color:#e6db74>&#39;&gt;=8.0.0&#39;</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>npm WARN EBADENGINE   current: <span style=color:#f92672>{</span> node: <span style=color:#e6db74>&#39;v16.17.1&#39;</span>, npm: <span style=color:#e6db74>&#39;8.15.0&#39;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>npm WARN EBADENGINE <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>added <span style=color:#ae81ff>63</span> packages, removed <span style=color:#ae81ff>4</span> packages, and changed <span style=color:#ae81ff>93</span> packages in 15s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span> packages are looking <span style=color:#66d9ef>for</span> funding
</span></span><span style=display:flex><span>  run <span style=color:#e6db74>`</span>npm fund<span style=color:#e6db74>`</span> <span style=color:#66d9ef>for</span> details
</span></span></code></pre></div><p>å¤„ç†æ–¹å¼ï¼š</p><p>è¿™ä¸ªé”™è¯¯æ˜¯ç”±äºä½ å½“å‰ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬ (v16.17.1) å’Œ Rollup çš„æœ€æ–°ç‰ˆæœ¬ (4.21.0) ä¹‹é—´å­˜åœ¨ä¸å…¼å®¹é—®é¢˜ã€‚Rollup 4.21.0 è¦æ±‚ Node.js ç‰ˆæœ¬ä¸º 18.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè€Œä½ ç›®å‰ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ 16.17.1ï¼Œå› æ­¤å‡ºç°äº† <code>EBADENGINE</code> è­¦å‘Šã€‚</p><h3 id=è§£å†³æ–¹æ¡ˆ>è§£å†³æ–¹æ¡ˆï¼š<a hidden class=anchor aria-hidden=true href=#è§£å†³æ–¹æ¡ˆ>#</a></h3><ol><li><p><strong>å‡çº§ Node.js ç‰ˆæœ¬</strong><br>æœ€ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯å‡çº§ä½ çš„ Node.js ç‰ˆæœ¬åˆ° 18.0.0 æˆ–æ›´é«˜ã€‚ä½ å¯ä»¥ä½¿ç”¨ <a href=https://github.com/tj/n>n</a> æˆ– <a href=https://github.com/nvm-sh/nvm>nvm</a> æ¥ç®¡ç†å’Œåˆ‡æ¢ Node.js ç‰ˆæœ¬ã€‚</p><ul><li><p>ä½¿ç”¨ <code>n</code> å·¥å…·å‡çº§ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo npm install -g n
</span></span><span style=display:flex><span>sudo n stable
</span></span></code></pre></div></li><li><p>ä½¿ç”¨ <code>nvm</code> å·¥å…·å‡çº§ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nvm install <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span>nvm use <span style=color:#ae81ff>18</span>
</span></span></code></pre></div></li></ul><p>ç„¶åå†æ¬¡è¿è¡Œ <code>npm install</code> æ¥å®‰è£…ä¾èµ–ã€‚</p></li><li><p><strong>ä½¿ç”¨æ”¯æŒ Node.js 16 çš„ Rollup ç‰ˆæœ¬</strong><br>å¦‚æœä½ æ— æ³•å‡çº§ Node.js ç‰ˆæœ¬ï¼ˆæ¯”å¦‚é¡¹ç›®éœ€è¦å…¼å®¹ Node.js 16ï¼‰ï¼Œä½ å¯ä»¥å®‰è£…ä¸€ä¸ªæ—§ç‰ˆæœ¬çš„ Rollupã€‚æ¯”å¦‚ï¼ŒRollup 3.x æ”¯æŒ Node.js 16ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…è¾ƒæ—§çš„ Rollup ç‰ˆæœ¬ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install --save-dev rollup@3 @rollup/plugin-node-resolve @rollup/plugin-commonjs @rollup/plugin-babel @rollup/plugin-terser @babel/core @babel/preset-env
</span></span></code></pre></div></li></ol><h3 id=2-rollupplugin-commonjsä¸»è¦å¤„ç†ä»€ä¹ˆè¯­æ³•ä»€ä¹ˆæƒ…å†µä¸‹outputæ‰éœ€è¦è¾“å‡ºcommonjs>2. <code>@rollup/plugin-commonjs</code>ä¸»è¦å¤„ç†ä»€ä¹ˆè¯­æ³•ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ï¼Œoutputæ‰éœ€è¦è¾“å‡ºCommonJSï¼Ÿ<a hidden class=anchor aria-hidden=true href=#2-rollupplugin-commonjsä¸»è¦å¤„ç†ä»€ä¹ˆè¯­æ³•ä»€ä¹ˆæƒ…å†µä¸‹outputæ‰éœ€è¦è¾“å‡ºcommonjs>#</a></h3><p><code>@rollup/plugin-commonjs</code>æ’ä»¶ä¸»è¦å¤„ç†<code>CommonJS(CJS)</code>æ¨¡å—çš„è¯­æ³•ï¼Œç‰¹åˆ«åœ¨<code>Node.js</code>ç¯å¢ƒä¸­ã€‚å®ƒä½¿ç”¨<code>require()</code>å‡½æ•°æ¥åŒæ­¥åœ°åŠ è½½å…¶ä»–æ¨¡å—ï¼Œå¹¶é€šè¿‡ <code>module.exports</code>æˆ–<code>exports</code>å¯¹è±¡æ¥å¯¼å‡ºæ¨¡å—çš„åŠŸèƒ½ã€‚</p><p>ç¤ºä¾‹ï¼š<br>å‡è®¾ä½ æœ‰ä¸€ä¸ª<code>CommonJS</code>æ¨¡å—ï¼ˆmath.jsï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€äº›æ•°å­¦å‡½æ•°å¹¶å¯¼å‡ºå®ƒä»¬ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// math.js (CommonJS)  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) {  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>;  
</span></span><span style=display:flex><span>}  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>subtract</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) {  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>b</span>;  
</span></span><span style=display:flex><span>}  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>add</span>, <span style=color:#a6e22e>subtract</span> };
</span></span></code></pre></div><p>ç„¶åï¼Œä½ æƒ³åœ¨å¦ä¸€ä¸ªä½¿ç”¨ ES æ¨¡å—è¯­æ³•çš„æ–‡ä»¶ä¸­å¯¼å…¥è¿™ä¸ª CommonJS æ¨¡å—ã€‚ä½†ç”±äº Rollup é»˜è®¤åªç†è§£ ES æ¨¡å—ï¼Œå®ƒæ— æ³•ç›´æ¥è§£æ require() è°ƒç”¨ã€‚è¿™å°±æ˜¯ @rollup/plugin-commonjs æ’ä»¶å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å®ƒå¯ä»¥å°† CommonJS æ¨¡å—è½¬æ¢ä¸º Rollup å¯ä»¥ç†è§£çš„ ES æ¨¡å—æ ¼å¼ã€‚</p><p><strong>ä½•æ—¶éœ€è¦è¾“å‡º <code>CommonJSæ ¼å¼</code>ï¼ˆå¦‚ <code>.cjs.js</code>ï¼‰</strong>ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š<br></p><blockquote><p>èƒŒæ™¯ï¼šåœ¨<code>Node.js</code>ä¸­ï¼Œç‰ˆæœ¬<code>12</code>æ‰å¼€å§‹å¯¹<code>ES æ¨¡å—</code>æœ‰åŸºç¡€çš„æ”¯æŒ</p></blockquote><ul><li>å…¼å®¹æ€§ï¼šæŸäº›åº“æˆ–åº”ç”¨ç¨‹åºï¼ˆå› ä¸ºéœ€è¦æ”¯æŒè¾ƒæ—§çš„<code>Node.jsç‰ˆæœ¬</code>æˆ–ç‰¹å®šç¯å¢ƒï¼‰ä¸æ”¯æŒ<code>ES æ¨¡å—</code>ã€‚</li><li>ç”Ÿæ€ç³»ç»Ÿæ”¯æŒï¼šè¾“å‡º<code>CommonJS æ ¼å¼</code>å¯ç¡®ä¿ä½ çš„åº“æˆ–åº”ç”¨ç¨‹åºï¼Œè¢«åŸºäº<code>CommonJS</code>çš„å·¥å…·å’Œæ„å»ºç³»ç»Ÿï¼ˆå¦‚ï¼š<code>Node.js</code>åŒ…ç®¡ç†å·¥å…·<code>npm</code>ï¼‰æ‰€æ¶ˆè´¹ã€‚</li><li>æ€§èƒ½è€ƒè™‘ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ<code>CommonJS æ¨¡å—</code>æ¯”<code>ES æ¨¡å—</code>åŠ è½½å¾—æ›´å¿«ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸ä½¿ç”¨åŒæ­¥çš„<code>require()</code>è°ƒç”¨ã€‚ç„¶è€Œï¼Œåœ¨ç°ä»£<code>Node.js ç‰ˆæœ¬</code>ä¸­é€šå¸¸å·®å¼‚å¾ˆå°ï¼Œä¸”éšç€<code>ES æ¨¡å—</code>æ€§èƒ½çš„æå‡è€Œé€æ¸æ¶ˆå¤±ã€‚</li><li>å¤–éƒ¨ä½¿ç”¨åœºæ™¯ï¼šå¤–éƒ¨ä½¿ç”¨ CommonJS æ¨¡å—çš„åœºæ™¯éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š<ul><li>Node.js é¡¹ç›®ï¼šåœ¨ Node.js ä¸­ï¼Œç›´åˆ°ç‰ˆæœ¬ 12 æ‰å¼€å§‹å¯¹ ES æ¨¡å—æœ‰åŸºæœ¬çš„æ”¯æŒï¼Œè€Œ CommonJS ä»ç„¶æ˜¯ä¸»æµã€‚</li><li>é—ç•™ä»£ç åº“ï¼šè®¸å¤šæ—§çš„é¡¹ç›®å’Œåº“ä»ç„¶ä½¿ç”¨ CommonJSï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨ ES æ¨¡å—æˆä¸ºæ ‡å‡†ä¹‹å‰å°±å¼€å‘çš„ã€‚</li><li>æ··åˆé¡¹ç›®ï¼šåœ¨ä¸€äº›é¡¹ç›®ä¸­ï¼Œä½ å¯èƒ½éœ€è¦åŒæ—¶æ”¯æŒ ES æ¨¡å—å’Œ CommonJS æ¨¡å—ï¼Œä»¥ä¾¿èƒ½å¤Ÿå…¼å®¹ä¸åŒçš„ç¯å¢ƒæˆ–å·¥å…·é“¾ã€‚</li><li>npm åŒ…ï¼šç”±äº npm æ˜¯ JavaScript ç¤¾åŒºä¸­æœ€å¤§çš„åŒ…æ³¨å†Œè¡¨ä¹‹ä¸€ï¼Œå¹¶ä¸”è®¸å¤šåŒ…ä»ç„¶ä½¿ç”¨ CommonJSï¼Œå› æ­¤å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª npm åŒ…ï¼Œå¹¶å¸Œæœ›å®ƒèƒ½å¤Ÿè¢«å°½å¯èƒ½å¤šçš„é¡¹ç›®æ‰€ä½¿ç”¨ï¼Œé‚£ä¹ˆé€šå¸¸éœ€è¦æ”¯æŒ CommonJS æ ¼å¼ã€‚</li></ul></li></ul><h3 id=3-å¦‚ä½•ä¿æŒå¼€å‘å’Œæ„å»ºæ–‡ä»¶ç›®å½•ä¸€è‡´ä»¥ä¾¿äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜>3. å¦‚ä½•ä¿æŒå¼€å‘å’Œæ„å»ºæ–‡ä»¶ç›®å½•ä¸€è‡´ï¼Œä»¥ä¾¿äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#3-å¦‚ä½•ä¿æŒå¼€å‘å’Œæ„å»ºæ–‡ä»¶ç›®å½•ä¸€è‡´ä»¥ä¾¿äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜>#</a></h3><p>ç¤ºä¾‹ï¼š<br>å‡è®¾ä½ çš„ <code>src</code> ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>src/
</span></span><span style=display:flex><span>  index.js
</span></span><span style=display:flex><span>  utils/
</span></span><span style=display:flex><span>    helper.js
</span></span><span style=display:flex><span>  components/
</span></span><span style=display:flex><span>    button.js
</span></span><span style=display:flex><span>    modal.js
</span></span></code></pre></div><p>åœ¨æ‰“åŒ…åï¼Œä½ çš„ <code>lib</code> ç›®å½•ç»“æ„å’Œ<code>src</code>ä¿æŒä¸€è‡´ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lib/
</span></span><span style=display:flex><span>  index.js
</span></span><span style=display:flex><span>  utils/
</span></span><span style=display:flex><span>    helper.js
</span></span><span style=display:flex><span>  components/
</span></span><span style=display:flex><span>    button.js
</span></span><span style=display:flex><span>    modal.js
</span></span></code></pre></div><p>ä¼˜åŒ– <code>rollup.config.js</code>ï¼š</p><ul><li><code>dir</code> é€‰é¡¹ï¼šåœ¨ <code>output</code> é…ç½®ä¸­ä½¿ç”¨ <code>dir</code> è€Œä¸æ˜¯ <code>file</code>ï¼Œ<code>Rollup</code>ä¼šå°†è¾“å‡ºçš„æ–‡ä»¶æ”¾åœ¨æŒ‡å®šçš„ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯ç”Ÿæˆå•ä¸€çš„æ–‡ä»¶</li><li><code>preserveModules</code>ï¼šå¯ç”¨æ­¤é€‰é¡¹ï¼Œ<code>Rollup</code>å°†ä¿ç•™æ¨¡å—çš„åŸå§‹ç»“æ„ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆæ¯ä¸ªæ¨¡å—ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶</li><li><code>preserveModulesRoot</code>ï¼šæŒ‡å®šä¿ç•™çš„æ¨¡å—ç›®å½•çš„æ ¹ç›®å½•ã€‚æ­¤ä¾‹ä¸­ï¼Œ<code>src</code> ç›®å½•çš„å±‚çº§ç»“æ„ä¼šä¿æŒåˆ° <code>lib</code> ä¸­</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>input</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;src/index.js&#39;</span>, <span style=color:#75715e>// å…¥å£æ–‡ä»¶ï¼ˆå¯æ”¯æŒå¤šä¸ªå…¥å£ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>output</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>dir</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;lib&#39;</span>, <span style=color:#75715e>// è¾“å‡ºæ–‡ä»¶å¤¹
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>format</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;es&#39;</span>, <span style=color:#75715e>// ES Module è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>sourcemap</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>preserveModules</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>, <span style=color:#75715e>// ä¿æŒæ¨¡å—ç»“æ„
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>preserveModulesRoot</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;src&#39;</span>, <span style=color:#75715e>// ä¿æŒ src ç›®å½•ç»“æ„
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    },
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>external</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;@js/base-sdk&#39;</span>], <span style=color:#75715e>// å¿½ç•¥package.jsonä¸­çš„ä¾èµ–ï¼Œé¿å…è¢«æ‰“åŒ…åˆ°libs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>plugins</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  ],
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><hr><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><h3 id=å¸¸ç”¨æœ€ç»ˆé…ç½®>å¸¸ç”¨ï¼ˆæœ€ç»ˆï¼‰é…ç½®<a hidden class=anchor aria-hidden=true href=#å¸¸ç”¨æœ€ç»ˆé…ç½®>#</a></h3><p>å¾…è¡¥å……&mldr;</p><hr><h2 id=å‚è€ƒ>å‚è€ƒ<a hidden class=anchor aria-hidden=true href=#å‚è€ƒ>#</a></h2><ul><li><a href=https://www.rollupjs.com/>rollup.js ä¸­æ–‡æ–‡æ¡£</a></li></ul><hr><p><strong>æœ€åï¼Œ å¸Œæœ›å¤§å®¶æ—©æ—¥å®ç°ï¼šæˆä¸ºç¼–ç¨‹é«˜æ‰‹çš„ä¼Ÿå¤§æ¢¦æƒ³ï¼</strong><br><strong>æ¬¢è¿äº¤æµ~</strong></p><img src=/img-common/weChatPublic.jpg alt=å¾®ä¿¡å…¬ä¼—å· width=600 height=286><p><strong>æœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ›œçµæ‰€æœ‰ï¼æœªç»å…è®¸ï¼Œä¸¥ç¦è½¬è½½ï¼å¯¹éæ³•è½¬è½½è€…, åŸä½œè€…ä¿ç•™é‡‡ç”¨æ³•å¾‹æ‰‹æ®µè¿½ç©¶çš„æƒåˆ©ï¼</strong><br><strong>è‹¥éœ€è½¬è½½ï¼Œè¯·è”ç³»å¾®ä¿¡å…¬ä¼—å·ï¼šè¿å…ˆç”Ÿæœ‰çŒ«ç—…ï¼Œå¯è·å–ä½œè€…è”ç³»æ–¹å¼ï¼</strong></p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://lianpf.github.io/posts/frontend-develop/engine-webpack-vuecli-config/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>å·¥ç¨‹åŒ–ï¼š@vue/cli å’Œ Webpack æ„å»º</span></a>
<a class=next href=https://lianpf.github.io/posts/other/pregnancylatecare-and-hospitalnotice/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>å­•æ™šæœŸä¿å¥å’Œå…¥é™¢é¡»çŸ¥</span></a></nav></footer></div><script src=https://utteranc.es/client.js repo=lianpf/lianpf.github.io issue-term=title label=comments theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>Copyright
&copy;
2016-2024
<a href=https://lianpf.github.io/ style=color:#939393>æ›œçµï¼ˆSUNï¼‰Site</a>.
åŸºäº Hugo å¼•æ“å’Œ PaperMod ä¸»é¢˜</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href,s=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>