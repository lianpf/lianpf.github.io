<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>工程化实践：搭建 npm 私服(私有源) | 曜灵（SUN）Site</title><meta name=keywords content="npm,verdaccio,私有源,私服,前端工程化,CI/CD"><meta name=description content="本文旨在帮助前端团队理解 npm 私服的价值、主流方案对比，以及通过 Verdaccio 实现私有 npm 仓库的完整落地过程，解决依赖安全、网络和包管理混乱等痛点。"><meta name=author content="曜灵"><link rel=canonical href=https://lianpf.github.io/posts/frontend-develop/how-to-build-npm-private-registry-with-verdaccio/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lianpf.github.io/img-common/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://lianpf.github.io/img-common/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://lianpf.github.io/img-common/favicon.png><link rel=apple-touch-icon href=https://lianpf.github.io/img-common/avatar.jpeg><link rel=mask-icon href=https://lianpf.github.io/img-common/avatar.jpeg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><style>.fa-commenting-o,#post_meta_style_8,#comment_count,.comment-count,.comment-icon,svg[class*=comment],a[aria-label*=comment]{display:none!important}</style><meta property="og:title" content="工程化实践：搭建 npm 私服(私有源)"><meta property="og:description" content="本文旨在帮助前端团队理解 npm 私服的价值、主流方案对比，以及通过 Verdaccio 实现私有 npm 仓库的完整落地过程，解决依赖安全、网络和包管理混乱等痛点。"><meta property="og:type" content="article"><meta property="og:url" content="https://lianpf.github.io/posts/frontend-develop/how-to-build-npm-private-registry-with-verdaccio/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-05T17:42:59+08:00"><meta property="article:modified_time" content="2025-10-19T10:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="工程化实践：搭建 npm 私服(私有源)"><meta name=twitter:description content="本文旨在帮助前端团队理解 npm 私服的价值、主流方案对比，以及通过 Verdaccio 实现私有 npm 仓库的完整落地过程，解决依赖安全、网络和包管理混乱等痛点。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"📚文章","item":"https://lianpf.github.io/posts/"},{"@type":"ListItem","position":2,"name":"👨🏻‍💻 前端","item":"https://lianpf.github.io/posts/frontend-develop/"},{"@type":"ListItem","position":3,"name":"工程化实践：搭建 npm 私服(私有源)","item":"https://lianpf.github.io/posts/frontend-develop/how-to-build-npm-private-registry-with-verdaccio/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"工程化实践：搭建 npm 私服(私有源)","name":"工程化实践：搭建 npm 私服(私有源)","description":"本文旨在帮助前端团队理解 npm 私服的价值、主流方案对比，以及通过 Verdaccio 实现私有 npm 仓库的完整落地过程，解决依赖安全、网络和包管理混乱等痛点。","keywords":["npm","verdaccio","私有源","私服","前端工程化","CI/CD"],"articleBody":"在现代前端工程化体系中，高效、安全的依赖管理是保障项目稳定性的基石。本文将深入探讨为何需要搭建私有 npm 仓库，对比主流方案，并手把手带你使用轻量级工具 Verdaccio 搭建一个属于自己团队的 npm 私服。\n一、前言：为什么需要 npm 私服？ 在团队协作和企业级项目开发中，直接依赖公共 npm 源（registry.npmjs.org）常常会遇到以下痛点：\n网络与速度问题：公共源服务器在国外，国内访问速度不稳定，CI/CD 构建时容易因网络波动导致失败，严重影响开发和部署效率。 依赖安全性与合规性：公共 npm 仓库的包质量参差不齐，可能存在恶意代码。企业内部对于使用的开源包有严格的审计和安全要求，需要一个可控的依赖来源。 内部包管理混乱：团队内部开发的通用组件、工具库等私有包，不适合发布到公共仓库。通过 Git、文件等方式共享不仅版本管理困难，也无法享受 npm 带来的便利。 版本一致性与稳定性：公共包版本更新频繁，可能引入 Breaking Changes。私服可以缓存稳定版本的包，确保团队成员和CI环境安装的依赖版本高度一致。 npm 私服的核心作用：\n缓存加速：作为公共 npm 源的缓存代理，第一次下载后，后续请求直接从内网私服获取，极大提升 npm install 速度。 本地隔离：所有依赖请求都通过私服，即使公共源宕机或无法访问，只要缓存中存在，就不会影响内部开发。 权限控制：可以精细化管理用户和包的发布、访问权限，确保私有包的安全性。 内部包托管：为团队内部的私有包提供一个统一的托管平台，实现规范化的版本管理和分发。 二、主流私服方案概览 目前，市面上有多种成熟的 npm 私服解决方案，我们重点对比以下三种：\n特性 Verdaccio Nexus Repository OSS JFrog Artifactory 定位 轻量级、专注 npm 企业级、多格式制品库 DevOps 核心、全功能 实现 Node.js Java Java 优点 开源免费、配置简单、资源占用低、启动快、插件丰富 支持 npm, maven, docker 等多种格式、稳定可靠、权限管理强大 功能最全面、深度集成 CI/CD、支持分布式 缺点 仅支持 npm 资源占用高、配置相对复杂 商业版昂贵、对中小团队过于复杂 适用场景 中小型团队、前端团队、快速搭建 需要统一管理多语言制品的中大型企业 对 DevOps 和合规性有极高要求的大型企业 选择建议： 对于绝大多数前端团队而言，Verdaccio 是性价比最高的选择。它轻量、易用且完全能满足 npm 包管理的全部需求。\n三、基于 Verdaccio 的私有 npm 源搭建实战 下面我们以 Verdaccio 为例，演示完整的搭建和使用流程。\n1. 环境准备与安装 确保你的服务器或本地环境已安装 Node.js (\u003e=18.x) 和 npm。\n全局安装 Verdaccio npm install -g verdaccio 验证安装 verdaccio --version 2. 启动与访问 直接在终端运行命令即可启动服务。\nverdaccio 启动后，你会在终端看到类似信息，告知配置文件路径和访问地址：\nwarn --- config file - /Users/your_user/.config/verdaccio/config.yaml warn --- http address - http://localhost:4873/ - verdaccio/5.29.0 此时，通过浏览器访问 http://localhost:4873 即可看到 Verdaccio 的 Web 管理界面。\n3. 核心配置 (config.yaml) 首次启动后，Verdaccio 会在用户目录下创建 config.yaml 文件，这是它的核心配置文件。\n存储路径 (storage)：定义私服包和缓存的存储位置。 storage: ./storage 上游源 (uplinks)：配置公共 npm 源代理。当私服没有某个包时，会从这里拉取。 uplinks: npmjs: url: https://registry.npmjs.org/ 包权限 (packages)：定义不同作用域（scope）或包的访问、发布权限。 packages: '@my-scope/*': access: $authenticated publish: $authenticated # 所有已登录的用户都可以发布该包 unpublish: $authenticated proxy: [] # 不代理到公共仓库 '**': # 对于代理自 NPMJS 的公共包（**），应阻止任何用户发布，确保这些包永远只作为外部内容的缓存 access: $all # 所有人（包括未登录用户）都可以下载和访问该包 publish: $none # 明确禁止任何用户发布到公共代理区域 proxy: npmjs # 代理到 NPMJS 配置解读： @my-scope/*：所有以 @my-scope/ 开头的包，只允许认证用户（$authenticated）访问和发布。 **：所有其他（第三方）包，允许任何人（$all）访问（拉取），但禁止发布。 proxy: npmjs 表示如本地没有，则去 npmjs 上游拉取。 4. 用户管理与使用 4.1 私有源使用 第1步：切换 npm 源\n为了让 npm 命令指向我们的私服，需要配置 registry。推荐使用 nrm 工具管理多个源，但这里我们用原生命令演示：\n# 设置 npm 源为本地私服 npm set registry http://localhost:4873/ # 验证当前源 npm get registry 第2步：添加用户\n在私服上注册一个新用户，用于登录和发布包。\nnpm adduser --registry http://localhost:4873/ 根据提示输入用户名、密码和邮箱即可。\n第3步：发布私有包\n进入你的私有包项目目录，执行发布命令：\nnpm publish 发布成功后，你可以在 Verdaccio 的 Web 界面看到你的私有包。\n第4步：安装包\n现在，无论是安装公共包还是私有包，npm install 都会通过你的私服进行。\n# 安装公共包（会通过私服代理并缓存） npm install lodash # 安装私有包 npm install @my-scope/my-private-package 4.2 基于用户组的细粒度权限管理 在团队协作中，仅使用 $authenticated（所有登录用户）来控制发布权限有时过于宽泛。我们常常需要更精细的控制，例如：\nui-team 组的成员才能发布 @company/ui- 前缀的组件包。 api-team 组的成员才能发布 @company/api- 前缀的工具包。 要实现这种基于“用户组”的权限分配，需要借助支持组管理的认证插件（如 ldap、gitlab 或 sinopia-htpasswd-with-groups等），因为 Verdaccio 默认的 htpasswd 认证方式不支持用户组。\n这是否是合理的方案？\n答案是：非常合理。 在企业环境中，通过集成 LDAP/Active Directory 或 GitLab 等现有认证系统，是实现 npm 私服权限管理的标准实践。它不仅提升了安全性，还简化了用户管理，是工程化成熟的必经之路。\n如何实现？（以 LDAP 为例）\n下面以集成企业中常见的 LDAP 系统为例，梳理出一个清晰、简化的流程。\n第 1 步：安装认证插件\n首先，为 Verdaccio 安装 LDAP 认证插件。\nnpm install -g verdaccio-ldap 第 2 步：配置 config.yaml\n接下来，修改 config.yaml 文件，主要调整 auth 和 packages 两个部分。\n配置 auth，对接 LDAP 服务： 将 auth 部分替换为 LDAP 插件的配置，指向公司的 LDAP 服务器。这一步通常由运维或 IT 部门协助完成。\nauth: ldap: # ldap 插件的 url 指向、管理员账号、搜索规则等 # 详细配置请参考 verdaccio-ldap 插件官方文档 url: \"ldap://ldap.company.com:389\" userDn: \"cn={{username}},ou=users,dc=company,dc=com\" groupDn: \"cn={{group}},ou=groups,dc=company,dc=com\" 配置 packages，分配组权限： 这是实现细粒度控制的核心。在 packages 规则中，直接使用从 LDAP 同步过来的用户组名来分配 publish 权限。\npackages: # 公司私有包，所有登录用户都可以访问 '@company/*': access: $authenticated proxy: [] # 私有包不走上游代理 # UI 组件包，仅限 'frontend-team' 组的成员发布 '@company/ui-*': access: $authenticated publish: frontend-team unpublish: frontend-team # API 工具包，仅限 'backend-team' 组的成员发布 '@company/api-*': access: $authenticated publish: backend-team unpublish: backend-team # 共享工具包，多个组都可以发布 '@company/shared-*': access: $authenticated publish: [frontend-team, backend-team] # -------------------------------------------------- # 公共包规则（保持不变） '**': access: $all publish: $none # 禁止任何人发布公共范围的包 proxy: npmjs 工作流程：\n开发者执行 npm login 时，Verdaccio 通过 verdaccio-ldap 插件将用户名和密码转发至 LDAP 服务器进行验证。 验证成功后，插件会获取该用户所属的用户组列表（如 frontend-team）。 当该用户执行 npm publish @company/ui-button 时，Verdaccio 会检查 @company/ui-* 规则。 规则要求发布者必须属于 frontend-team 组，由于该用户组成员身份匹配，因此发布操作被允许。如果另一组的成员尝试发布，则会被拒绝。 通过以上步骤，实现了一个与企业现有用户体系集成、权限分明、安全可控的 npm 私服。\n5. 团队协作与内网部署 内网部署：建议使用 pm2 等进程守护工具来管理 verdaccio 服务，确保其稳定运行。 # 安装 pm2 npm install -g pm2 # 使用 pm2 启动 verdaccio pm2 start verdaccio # 设置开机自启 pm2 startup 反向代理：在生产环境中，建议使用 Nginx 或 Caddy 作为反向代理，配置域名、HTTPS 和负载均衡，提升安全性。 CI/CD 集成：在 GitLab CI、Jenkins 等工具的构建脚本中，只需将 registry 配置指向私服地址，即可在自动化流程中使用私服。 # .npmrc 文件示例 registry=http://your-verdaccio-server:4873/ //your-verdaccio-server:4873/:_authToken=\"your_auth_token\" 四、问题排查与优化 权限问题：发布包时遇到 403 Forbidden 错误，请检查 config.yaml 中 packages 的 publish 权限配置是否正确，以及当前登录用户是否符合要求。 缓存问题：如果公共包更新后，私服拉取的仍然是旧版本，可以尝试清除缓存或使用 npm cache clean --force。 插件扩展：Verdaccio 支持丰富的插件，例如 verdaccio-ldap 可以实现与公司 LDAP 系统的用户认证对接，实现单点登录。 五、结语与延伸 搭建 npm 私服是前端工程化迈向成熟的重要一步。它不仅解决了团队开发中的实际痛点，更是保障供应链安全、提升开发效率的关键基础设施。从 Verdaccio 开始，团队可以逐步构建起统一的内部包管理体系，并将其融入到更宏大的 DevOps 一体化流程中。\n参考 Verdaccio 官方文档：https://verdaccio.org/ 最后， 希望大家早日实现：成为编程高手的伟大梦想！ 欢迎交流~\n本文版权归原作者曜灵所有！未经允许，严禁转载！对非法转载者, 原作者保留采用法律手段追究的权利！ 若需转载，请联系微信公众号：连先生有猫病，可获取作者联系方式！\n","wordCount":"3211","inLanguage":"zh","datePublished":"2025-09-05T17:42:59+08:00","dateModified":"2025-10-19T10:00:00+08:00","author":[{"@type":"Person","name":"曜灵"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://lianpf.github.io/posts/frontend-develop/how-to-build-npm-private-registry-with-verdaccio/"},"publisher":{"@type":"Organization","name":"曜灵（SUN）Site","logo":{"@type":"ImageObject","url":"https://lianpf.github.io/img-common/favicon.png"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lianpf.github.io/ accesskey=h title="曜灵（SUN）Site (Alt + H)"><img src=https://lianpf.github.io/img-common/avatar.jpeg alt=logo aria-label=logo height=35>曜灵（SUN）Site</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lianpf.github.io/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li><li><a href=https://lianpf.github.io/ title="🏠 主页"><span>🏠 主页</span></a></li><li><a href=https://lianpf.github.io/archives/ title="⏱️ 归档"><span>⏱️ 归档</span></a></li><li><a href=https://lianpf.github.io/tags title="🧩 标签"><span>🧩 标签</span></a></li><li><a href=https://lianpf.github.io/about title="🙋🏻‍♂️ 关于"><span>🙋🏻‍♂️ 关于</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://lianpf.github.io/>🏠 主页</a>&nbsp;»&nbsp;<a href=https://lianpf.github.io/posts/>📚文章</a>&nbsp;»&nbsp;<a href=https://lianpf.github.io/posts/frontend-develop/>👨🏻‍💻 前端</a></div><h1 class=post-title>工程化实践：搭建 npm 私服(私有源)</h1><div class=post-description>本文旨在帮助前端团队理解 npm 私服的价值、主流方案对比，以及通过 Verdaccio 实现私有 npm 仓库的完整落地过程，解决依赖安全、网络和包管理混乱等痛点。</div><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>&nbsp;创建&nbsp;2025-09-05
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_2><span class="fa fa-calendar-plus-o"></span>
<span>&nbsp;更新&nbsp;2025-10-19
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>曜灵
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://lianpf.github.io/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/ style=color:var(--secondary)!important>工程化</a>
&nbsp;<a href=https://lianpf.github.io/tags/npm/ style=color:var(--secondary)!important>npm</a></span></span></span></span>
<span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;</span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e4%b8%80%e5%89%8d%e8%a8%80%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81-npm-%e7%a7%81%e6%9c%8d aria-label="一、前言：为什么需要 npm 私服？">一、前言：为什么需要 npm 私服？</a></li><li><a href=#%e4%ba%8c%e4%b8%bb%e6%b5%81%e7%a7%81%e6%9c%8d%e6%96%b9%e6%a1%88%e6%a6%82%e8%a7%88 aria-label=二、主流私服方案概览>二、主流私服方案概览</a></li><li><a href=#%e4%b8%89%e5%9f%ba%e4%ba%8e-verdaccio-%e7%9a%84%e7%a7%81%e6%9c%89-npm-%e6%ba%90%e6%90%ad%e5%bb%ba%e5%ae%9e%e6%88%98 aria-label="三、基于 Verdaccio 的私有 npm 源搭建实战">三、基于 Verdaccio 的私有 npm 源搭建实战</a><ul><li><a href=#1-%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87%e4%b8%8e%e5%ae%89%e8%a3%85 aria-label="1. 环境准备与安装">1. 环境准备与安装</a></li><li><a href=#2-%e5%90%af%e5%8a%a8%e4%b8%8e%e8%ae%bf%e9%97%ae aria-label="2. 启动与访问">2. 启动与访问</a></li><li><a href=#3-%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae-configyaml aria-label="3. 核心配置 (config.yaml)">3. 核心配置 (<code>config.yaml</code>)</a></li><li><a href=#4-%e7%94%a8%e6%88%b7%e7%ae%a1%e7%90%86%e4%b8%8e%e4%bd%bf%e7%94%a8 aria-label="4. 用户管理与使用">4. 用户管理与使用</a><ul><li><a href=#41-%e7%a7%81%e6%9c%89%e6%ba%90%e4%bd%bf%e7%94%a8 aria-label="4.1 私有源使用">4.1 私有源使用</a></li><li><a href=#42-%e5%9f%ba%e4%ba%8e%e7%94%a8%e6%88%b7%e7%bb%84%e7%9a%84%e7%bb%86%e7%b2%92%e5%ba%a6%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86 aria-label="4.2 基于用户组的细粒度权限管理">4.2 基于用户组的细粒度权限管理</a></li></ul></li><li><a href=#5-%e5%9b%a2%e9%98%9f%e5%8d%8f%e4%bd%9c%e4%b8%8e%e5%86%85%e7%bd%91%e9%83%a8%e7%bd%b2 aria-label="5. 团队协作与内网部署">5. 团队协作与内网部署</a></li></ul></li><li><a href=#%e5%9b%9b%e9%97%ae%e9%a2%98%e6%8e%92%e6%9f%a5%e4%b8%8e%e4%bc%98%e5%8c%96 aria-label=四、问题排查与优化>四、问题排查与优化</a></li><li><a href=#%e4%ba%94%e7%bb%93%e8%af%ad%e4%b8%8e%e5%bb%b6%e4%bc%b8 aria-label=五、结语与延伸>五、结语与延伸</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>在现代前端工程化体系中，高效、安全的依赖管理是保障项目稳定性的基石。本文将深入探讨为何需要搭建私有 npm 仓库，对比主流方案，并手把手带你使用轻量级工具 Verdaccio 搭建一个属于自己团队的 npm 私服。</p><hr><h2 id=一前言为什么需要-npm-私服>一、前言：为什么需要 npm 私服？<a hidden class=anchor aria-hidden=true href=#一前言为什么需要-npm-私服>#</a></h2><p>在团队协作和企业级项目开发中，直接依赖公共 npm 源（<code>registry.npmjs.org</code>）常常会遇到以下痛点：</p><ul><li><strong>网络与速度问题</strong>：公共源服务器在国外，国内访问速度不稳定，CI/CD 构建时容易因网络波动导致失败，严重影响开发和部署效率。</li><li><strong>依赖安全性与合规性</strong>：公共 npm 仓库的包质量参差不齐，可能存在恶意代码。企业内部对于使用的开源包有严格的审计和安全要求，需要一个可控的依赖来源。</li><li><strong>内部包管理混乱</strong>：团队内部开发的通用组件、工具库等私有包，不适合发布到公共仓库。通过 Git、文件等方式共享不仅版本管理困难，也无法享受 npm 带来的便利。</li><li><strong>版本一致性与稳定性</strong>：公共包版本更新频繁，可能引入 <code>Breaking Changes</code>。私服可以缓存稳定版本的包，确保团队成员和CI环境安装的依赖版本高度一致。</li></ul><p><strong>npm 私服的核心作用</strong>：</p><ol><li><strong>缓存加速</strong>：作为公共 npm 源的缓存代理，第一次下载后，后续请求直接从内网私服获取，极大提升 <code>npm install</code> 速度。</li><li><strong>本地隔离</strong>：所有依赖请求都通过私服，即使公共源宕机或无法访问，只要缓存中存在，就不会影响内部开发。</li><li><strong>权限控制</strong>：可以精细化管理用户和包的发布、访问权限，确保私有包的安全性。</li><li><strong>内部包托管</strong>：为团队内部的私有包提供一个统一的托管平台，实现规范化的版本管理和分发。</li></ol><hr><h2 id=二主流私服方案概览>二、主流私服方案概览<a hidden class=anchor aria-hidden=true href=#二主流私服方案概览>#</a></h2><p>目前，市面上有多种成熟的 npm 私服解决方案，我们重点对比以下三种：</p><table><thead><tr><th style=text-align:left>特性</th><th style=text-align:left>Verdaccio</th><th style=text-align:left>Nexus Repository OSS</th><th style=text-align:left>JFrog Artifactory</th></tr></thead><tbody><tr><td style=text-align:left><strong>定位</strong></td><td style=text-align:left>轻量级、专注 npm</td><td style=text-align:left>企业级、多格式制品库</td><td style=text-align:left>DevOps 核心、全功能</td></tr><tr><td style=text-align:left><strong>实现</strong></td><td style=text-align:left>Node.js</td><td style=text-align:left>Java</td><td style=text-align:left>Java</td></tr><tr><td style=text-align:left><strong>优点</strong></td><td style=text-align:left>开源免费、配置简单、资源占用低、启动快、插件丰富</td><td style=text-align:left>支持 npm, maven, docker 等多种格式、稳定可靠、权限管理强大</td><td style=text-align:left>功能最全面、深度集成 CI/CD、支持分布式</td></tr><tr><td style=text-align:left><strong>缺点</strong></td><td style=text-align:left>仅支持 npm</td><td style=text-align:left>资源占用高、配置相对复杂</td><td style=text-align:left>商业版昂贵、对中小团队过于复杂</td></tr><tr><td style=text-align:left><strong>适用场景</strong></td><td style=text-align:left>中小型团队、前端团队、快速搭建</td><td style=text-align:left>需要统一管理多语言制品的中大型企业</td><td style=text-align:left>对 DevOps 和合规性有极高要求的大型企业</td></tr></tbody></table><p><strong>选择建议</strong>：
对于绝大多数前端团队而言，<strong>Verdaccio</strong> 是性价比最高的选择。它轻量、易用且完全能满足 npm 包管理的全部需求。</p><hr><h2 id=三基于-verdaccio-的私有-npm-源搭建实战>三、基于 Verdaccio 的私有 npm 源搭建实战<a hidden class=anchor aria-hidden=true href=#三基于-verdaccio-的私有-npm-源搭建实战>#</a></h2><p>下面我们以 <code>Verdaccio</code> 为例，演示完整的搭建和使用流程。</p><h3 id=1-环境准备与安装>1. 环境准备与安装<a hidden class=anchor aria-hidden=true href=#1-环境准备与安装>#</a></h3><p>确保你的服务器或本地环境已安装 <strong>Node.js (>=18.x)</strong> 和 <strong>npm</strong>。</p><ul><li><strong>全局安装 Verdaccio</strong><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install -g verdaccio
</span></span></code></pre></div></li><li><strong>验证安装</strong><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>verdaccio --version
</span></span></code></pre></div></li></ul><h3 id=2-启动与访问>2. 启动与访问<a hidden class=anchor aria-hidden=true href=#2-启动与访问>#</a></h3><p>直接在终端运行命令即可启动服务。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>verdaccio
</span></span></code></pre></div><p>启动后，你会在终端看到类似信息，告知配置文件路径和访问地址：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> warn --- config file  - /Users/your_user/.config/verdaccio/config.yaml
</span></span><span style=display:flex><span> warn --- http address - http://localhost:4873/ - verdaccio/5.29.0
</span></span></code></pre></div><p>此时，通过浏览器访问 <code>http://localhost:4873</code> 即可看到 Verdaccio 的 Web 管理界面。</p><h3 id=3-核心配置-configyaml>3. 核心配置 (<code>config.yaml</code>)<a hidden class=anchor aria-hidden=true href=#3-核心配置-configyaml>#</a></h3><p>首次启动后，Verdaccio 会在用户目录下创建 <code>config.yaml</code> 文件，这是它的核心配置文件。</p><ul><li><strong>存储路径 (<code>storage</code>)</strong>：定义私服包和缓存的存储位置。<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>storage</span>: <span style=color:#ae81ff>./storage</span>
</span></span></code></pre></div></li><li><strong>上游源 (<code>uplinks</code>)</strong>：配置公共 npm 源代理。当私服没有某个包时，会从这里拉取。<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>uplinks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>npmjs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://registry.npmjs.org/</span>
</span></span></code></pre></div></li><li><strong>包权限 (<code>packages</code>)</strong>：定义不同作用域（scope）或包的访问、发布权限。<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>packages</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#39;@my-scope/*&#39;</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>access</span>: <span style=color:#ae81ff>$authenticated</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>publish</span>: <span style=color:#ae81ff>$authenticated</span> <span style=color:#75715e># 所有已登录的用户都可以发布该包</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>unpublish</span>: <span style=color:#ae81ff>$authenticated</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy</span>: []              <span style=color:#75715e># 不代理到公共仓库</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#39;**&#39;</span>: <span style=color:#75715e># 对于代理自 NPMJS 的公共包（**），应阻止任何用户发布，确保这些包永远只作为外部内容的缓存</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>access</span>: <span style=color:#ae81ff>$all</span> <span style=color:#75715e># 所有人（包括未登录用户）都可以下载和访问该包</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>publish</span>: <span style=color:#ae81ff>$none </span> <span style=color:#75715e># 明确禁止任何用户发布到公共代理区域</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy</span>: <span style=color:#ae81ff>npmjs</span> <span style=color:#75715e># 代理到 NPMJS</span>
</span></span></code></pre></div><strong>配置解读</strong>：<ul><li><code>@my-scope/*</code>：所有以 <code>@my-scope/</code> 开头的包，只允许认证用户（<code>$authenticated</code>）访问和发布。</li><li><code>**</code>：所有其他（第三方）包，允许任何人（<code>$all</code>）访问（拉取），但禁止发布。<ul><li><code>proxy: npmjs</code> 表示如本地没有，则去 <code>npmjs</code> 上游拉取。</li></ul></li></ul></li></ul><h3 id=4-用户管理与使用>4. 用户管理与使用<a hidden class=anchor aria-hidden=true href=#4-用户管理与使用>#</a></h3><h4 id=41-私有源使用>4.1 私有源使用<a hidden class=anchor aria-hidden=true href=#41-私有源使用>#</a></h4><p><strong>第1步：切换 npm 源</strong><br>为了让 <code>npm</code> 命令指向我们的私服，需要配置 registry。推荐使用 <code>nrm</code> 工具管理多个源，但这里我们用原生命令演示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 设置 npm 源为本地私服</span>
</span></span><span style=display:flex><span>npm set registry http://localhost:4873/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 验证当前源</span>
</span></span><span style=display:flex><span>npm get registry
</span></span></code></pre></div><p><strong>第2步：添加用户</strong><br>在私服上注册一个新用户，用于登录和发布包。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm adduser --registry http://localhost:4873/
</span></span></code></pre></div><p>根据提示输入用户名、密码和邮箱即可。</p><p><strong>第3步：发布私有包</strong><br>进入你的私有包项目目录，执行发布命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm publish
</span></span></code></pre></div><p>发布成功后，你可以在 Verdaccio 的 Web 界面看到你的私有包。</p><p><strong>第4步：安装包</strong><br>现在，无论是安装公共包还是私有包，<code>npm install</code> 都会通过你的私服进行。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 安装公共包（会通过私服代理并缓存）</span>
</span></span><span style=display:flex><span>npm install lodash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 安装私有包</span>
</span></span><span style=display:flex><span>npm install @my-scope/my-private-package
</span></span></code></pre></div><h4 id=42-基于用户组的细粒度权限管理>4.2 基于用户组的细粒度权限管理<a hidden class=anchor aria-hidden=true href=#42-基于用户组的细粒度权限管理>#</a></h4><p>在团队协作中，仅使用 <code>$authenticated</code>（所有登录用户）来控制发布权限有时过于宽泛。我们常常需要更精细的控制，例如：</p><ul><li><code>ui-team</code> 组的成员才能发布 <code>@company/ui-</code> 前缀的组件包。</li><li><code>api-team</code> 组的成员才能发布 <code>@company/api-</code> 前缀的工具包。</li></ul><p>要实现这种基于“用户组”的权限分配，需要借助支持组管理的认证插件（如 <code>ldap</code>、<code>gitlab</code> 或 <code>sinopia-htpasswd-with-groups</code>等），因为 Verdaccio 默认的 <code>htpasswd</code> 认证方式不支持用户组。</p><p><strong>这是否是合理的方案？</strong></p><p><strong>答案是：非常合理。</strong> 在企业环境中，通过集成 LDAP/Active Directory 或 GitLab 等现有认证系统，是实现 npm 私服权限管理的标准实践。它不仅提升了安全性，还简化了用户管理，是工程化成熟的必经之路。</p><p><strong>如何实现？（以 LDAP 为例）</strong></p><p>下面以集成企业中常见的 <code>LDAP 系统</code>为例，梳理出一个清晰、简化的流程。</p><p><strong>第 1 步：安装认证插件</strong></p><p>首先，为 Verdaccio 安装 LDAP 认证插件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install -g verdaccio-ldap
</span></span></code></pre></div><p><strong>第 2 步：配置 <code>config.yaml</code></strong></p><p>接下来，修改 <code>config.yaml</code> 文件，主要调整 <code>auth</code> 和 <code>packages</code> 两个部分。</p><ol><li><p><strong>配置 <code>auth</code>，对接 LDAP 服务</strong>：
将 <code>auth</code> 部分替换为 LDAP 插件的配置，指向公司的 LDAP 服务器。这一步通常由运维或 IT 部门协助完成。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>auth</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ldap</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># ldap 插件的 url 指向、管理员账号、搜索规则等</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 详细配置请参考 verdaccio-ldap 插件官方文档</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#34;ldap://ldap.company.com:389&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>userDn</span>: <span style=color:#e6db74>&#34;cn={{username}},ou=users,dc=company,dc=com&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>groupDn</span>: <span style=color:#e6db74>&#34;cn={{group}},ou=groups,dc=company,dc=com&#34;</span>
</span></span></code></pre></div></li><li><p><strong>配置 <code>packages</code>，分配组权限</strong>：
这是实现细粒度控制的核心。在 <code>packages</code> 规则中，直接使用从 LDAP 同步过来的<strong>用户组名</strong>来分配 <code>publish</code> 权限。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>packages</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># 公司私有包，所有登录用户都可以访问</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#39;@company/*&#39;</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>access</span>: <span style=color:#ae81ff>$authenticated</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy</span>: [] <span style=color:#75715e># 私有包不走上游代理</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># UI 组件包，仅限 &#39;frontend-team&#39; 组的成员发布</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#39;@company/ui-*&#39;</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>access</span>: <span style=color:#ae81ff>$authenticated</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>publish</span>: <span style=color:#ae81ff>frontend-team</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>unpublish</span>: <span style=color:#ae81ff>frontend-team</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># API 工具包，仅限 &#39;backend-team&#39; 组的成员发布</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#39;@company/api-*&#39;</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>access</span>: <span style=color:#ae81ff>$authenticated</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>publish</span>: <span style=color:#ae81ff>backend-team</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>unpublish</span>: <span style=color:#ae81ff>backend-team</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># 共享工具包，多个组都可以发布</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#39;@company/shared-*&#39;</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>access</span>: <span style=color:#ae81ff>$authenticated</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>publish</span>: [<span style=color:#ae81ff>frontend-team, backend-team]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># --------------------------------------------------</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># 公共包规则（保持不变）</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#39;**&#39;</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>access</span>: <span style=color:#ae81ff>$all</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>publish</span>: <span style=color:#ae81ff>$none</span> <span style=color:#75715e># 禁止任何人发布公共范围的包</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy</span>: <span style=color:#ae81ff>npmjs</span>
</span></span></code></pre></div></li></ol><p><strong>工作流程：</strong></p><ol><li>开发者执行 <code>npm login</code> 时，Verdaccio 通过 <code>verdaccio-ldap</code> 插件将用户名和密码转发至 LDAP 服务器进行验证。</li><li>验证成功后，插件会获取该用户所属的用户组列表（如 <code>frontend-team</code>）。</li><li>当该用户执行 <code>npm publish @company/ui-button</code> 时，Verdaccio 会检查 <code>@company/ui-*</code> 规则。</li><li>规则要求发布者必须属于 <code>frontend-team</code> 组，由于该用户组成员身份匹配，因此发布操作被允许。如果另一组的成员尝试发布，则会被拒绝。</li></ol><p>通过以上步骤，实现了一个与企业现有用户体系集成、权限分明、安全可控的 npm 私服。</p><h3 id=5-团队协作与内网部署>5. 团队协作与内网部署<a hidden class=anchor aria-hidden=true href=#5-团队协作与内网部署>#</a></h3><ul><li><strong>内网部署</strong>：建议使用 <code>pm2</code> 等进程守护工具来管理 <code>verdaccio</code> 服务，确保其稳定运行。<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 安装 pm2</span>
</span></span><span style=display:flex><span>npm install -g pm2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 pm2 启动 verdaccio</span>
</span></span><span style=display:flex><span>pm2 start verdaccio
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置开机自启</span>
</span></span><span style=display:flex><span>pm2 startup
</span></span></code></pre></div></li><li><strong>反向代理</strong>：在生产环境中，建议使用 Nginx 或 Caddy 作为反向代理，配置域名、HTTPS 和负载均衡，提升安全性。</li><li><strong>CI/CD 集成</strong>：在 GitLab CI、Jenkins 等工具的构建脚本中，只需将 registry 配置指向私服地址，即可在自动化流程中使用私服。<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># .npmrc 文件示例</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>registry=http://your-verdaccio-server:4873/</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>//your-verdaccio-server:4873/:_authToken=&#34;your_auth_token&#34;</span>
</span></span></code></pre></div></li></ul><hr><h2 id=四问题排查与优化>四、问题排查与优化<a hidden class=anchor aria-hidden=true href=#四问题排查与优化>#</a></h2><ul><li><strong>权限问题</strong>：发布包时遇到 <code>403 Forbidden</code> 错误，请检查 <code>config.yaml</code> 中 <code>packages</code> 的 <code>publish</code> 权限配置是否正确，以及当前登录用户是否符合要求。</li><li><strong>缓存问题</strong>：如果公共包更新后，私服拉取的仍然是旧版本，可以尝试清除缓存或使用 <code>npm cache clean --force</code>。</li><li><strong>插件扩展</strong>：Verdaccio 支持丰富的插件，例如 <code>verdaccio-ldap</code> 可以实现与公司 LDAP 系统的用户认证对接，实现单点登录。</li></ul><hr><h2 id=五结语与延伸>五、结语与延伸<a hidden class=anchor aria-hidden=true href=#五结语与延伸>#</a></h2><p>搭建 npm 私服是前端工程化迈向成熟的重要一步。它不仅解决了团队开发中的实际痛点，更是保障供应链安全、提升开发效率的关键基础设施。从 Verdaccio 开始，团队可以逐步构建起统一的内部包管理体系，并将其融入到更宏大的 DevOps 一体化流程中。</p><hr><h2 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ul><li>Verdaccio 官方文档：<a href=https://verdaccio.org/>https://verdaccio.org/</a></li></ul><hr><p><strong>最后， 希望大家早日实现：成为编程高手的伟大梦想！</strong><br><strong>欢迎交流~</strong></p><img src=/img-common/weChatPublic.jpg alt=微信公众号 width=600 height=286><p><strong>本文版权归原作者曜灵所有！未经允许，严禁转载！对非法转载者, 原作者保留采用法律手段追究的权利！</strong><br><strong>若需转载，请联系微信公众号：连先生有猫病，可获取作者联系方式！</strong></p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://lianpf.github.io/ alt=wechat_pay></a><p>微信</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://lianpf.github.io/ alt=alipay></a><p>支付宝</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>🧧 鼓励</span></button></div></div><footer class=post-footer><nav class=paginav><a class=next href=https://lianpf.github.io/posts/backend-develop/python-basics/><span class=title>下一页 »</span><br><span>Python 基础</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 工程化实践：搭建 npm 私服(私有源) on twitter" href="https://twitter.com/intent/tweet/?text=%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%ae%9e%e8%b7%b5%ef%bc%9a%e6%90%ad%e5%bb%ba%20npm%20%e7%a7%81%e6%9c%8d%28%e7%a7%81%e6%9c%89%e6%ba%90%29&amp;url=https%3a%2f%2flianpf.github.io%2fposts%2ffrontend-develop%2fhow-to-build-npm-private-registry-with-verdaccio%2f&amp;hashtags=%e5%b7%a5%e7%a8%8b%e5%8c%96%2cnpm"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 工程化实践：搭建 npm 私服(私有源) on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flianpf.github.io%2fposts%2ffrontend-develop%2fhow-to-build-npm-private-registry-with-verdaccio%2f&amp;title=%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%ae%9e%e8%b7%b5%ef%bc%9a%e6%90%ad%e5%bb%ba%20npm%20%e7%a7%81%e6%9c%8d%28%e7%a7%81%e6%9c%89%e6%ba%90%29&amp;summary=%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%ae%9e%e8%b7%b5%ef%bc%9a%e6%90%ad%e5%bb%ba%20npm%20%e7%a7%81%e6%9c%8d%28%e7%a7%81%e6%9c%89%e6%ba%90%29&amp;source=https%3a%2f%2flianpf.github.io%2fposts%2ffrontend-develop%2fhow-to-build-npm-private-registry-with-verdaccio%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 工程化实践：搭建 npm 私服(私有源) on reddit" href="https://reddit.com/submit?url=https%3a%2f%2flianpf.github.io%2fposts%2ffrontend-develop%2fhow-to-build-npm-private-registry-with-verdaccio%2f&title=%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%ae%9e%e8%b7%b5%ef%bc%9a%e6%90%ad%e5%bb%ba%20npm%20%e7%a7%81%e6%9c%8d%28%e7%a7%81%e6%9c%89%e6%ba%90%29"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 工程化实践：搭建 npm 私服(私有源) on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2flianpf.github.io%2fposts%2ffrontend-develop%2fhow-to-build-npm-private-registry-with-verdaccio%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 工程化实践：搭建 npm 私服(私有源) on whatsapp" href="https://api.whatsapp.com/send?text=%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%ae%9e%e8%b7%b5%ef%bc%9a%e6%90%ad%e5%bb%ba%20npm%20%e7%a7%81%e6%9c%8d%28%e7%a7%81%e6%9c%89%e6%ba%90%29%20-%20https%3a%2f%2flianpf.github.io%2fposts%2ffrontend-develop%2fhow-to-build-npm-private-registry-with-verdaccio%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 工程化实践：搭建 npm 私服(私有源) on telegram" href="https://telegram.me/share/url?text=%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%ae%9e%e8%b7%b5%ef%bc%9a%e6%90%ad%e5%bb%ba%20npm%20%e7%a7%81%e6%9c%8d%28%e7%a7%81%e6%9c%89%e6%ba%90%29&amp;url=https%3a%2f%2flianpf.github.io%2fposts%2ffrontend-develop%2fhow-to-build-npm-private-registry-with-verdaccio%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></div><script src=https://utteranc.es/client.js repo=lianpf/lianpf.github.io issue-term=title label=comments theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>Copyright
&copy;
2016-2025
<a href=https://lianpf.github.io/ style=color:#939393>曜灵（SUN）Site</a>.
基于 Hugo 引擎和 PaperMod 主题</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

————————————————
版权声明：本文为「曜灵（SUN）Site」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href,s=window.getSelection().toString()+`

————————————————
版权声明：本文为「曜灵（SUN）Site」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="复制";function i(){t.innerText="已复制！",setTimeout(()=>{t.innerText="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
————————————————
版权声明：本文为「曜灵（SUN）Site」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>