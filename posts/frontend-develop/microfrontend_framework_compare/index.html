<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å¾®å‰ç«¯: qiankunã€wujieå’ŒMicro Appç­‰æ¡†æ¶å¯¹æ¯” | æ›œçµï¼ˆSUNï¼‰Site</title><meta name=keywords content="å·¥å…·"><meta name=description content="ç³»åˆ—æ–‡ç« ï¼š ç¬¬ä¸€ç¯‡ï¼šå¾®å‰ç«¯: qiankunã€wujieå’ŒMic"><meta name=author content="æ›œçµ"><link rel=canonical href=https://lianpf.github.io/posts/frontend-develop/microfrontend_framework_compare/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lianpf.github.io/img-common/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://lianpf.github.io/img-common/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://lianpf.github.io/img-common/favicon.png><link rel=apple-touch-icon href=https://lianpf.github.io/img-common/avatar.jpeg><link rel=mask-icon href=https://lianpf.github.io/img-common/avatar.jpeg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="å¾®å‰ç«¯: qiankunã€wujieå’ŒMicro Appç­‰æ¡†æ¶å¯¹æ¯”"><meta property="og:description" content="ç³»åˆ—æ–‡ç« ï¼š ç¬¬ä¸€ç¯‡ï¼šå¾®å‰ç«¯: qiankunã€wujieå’ŒMic"><meta property="og:type" content="article"><meta property="og:url" content="https://lianpf.github.io/posts/frontend-develop/microfrontend_framework_compare/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-15T20:37:01+08:00"><meta property="article:modified_time" content="2024-05-15T20:37:01+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="å¾®å‰ç«¯: qiankunã€wujieå’ŒMicro Appç­‰æ¡†æ¶å¯¹æ¯”"><meta name=twitter:description content="ç³»åˆ—æ–‡ç« ï¼š ç¬¬ä¸€ç¯‡ï¼šå¾®å‰ç«¯: qiankunã€wujieå’ŒMic"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://lianpf.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» å‰ç«¯","item":"https://lianpf.github.io/posts/frontend-develop/"},{"@type":"ListItem","position":3,"name":"å¾®å‰ç«¯: qiankunã€wujieå’ŒMicro Appç­‰æ¡†æ¶å¯¹æ¯”","item":"https://lianpf.github.io/posts/frontend-develop/microfrontend_framework_compare/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"å¾®å‰ç«¯: qiankunã€wujieå’ŒMicro Appç­‰æ¡†æ¶å¯¹æ¯”","name":"å¾®å‰ç«¯: qiankunã€wujieå’ŒMicro Appç­‰æ¡†æ¶å¯¹æ¯”","description":"ç³»åˆ—æ–‡ç« ï¼š ç¬¬ä¸€ç¯‡ï¼šå¾®å‰ç«¯: qiankunã€wujieå’ŒMic","keywords":["å·¥å…·"],"articleBody":"ç³»åˆ—æ–‡ç« ï¼š\nç¬¬ä¸€ç¯‡ï¼šå¾®å‰ç«¯: qiankunã€wujieå’ŒMicro Appç­‰æ¡†æ¶å¯¹æ¯” å¾®å‰ç«¯æ¶æ„ä¸»è¦è§£å†³å•ä½“åº”ç”¨ï¼ˆå¸¸è§äºä¼ä¸šçº§ Web åº”ç”¨ï¼‰åœ¨ä¸€ä¸ªç›¸å¯¹é•¿çš„æ—¶é—´è·¨åº¦ä¸‹ï¼Œç”±äºå‚ä¸çš„äººå‘˜ã€å›¢é˜Ÿçš„å¢å¤šã€å˜è¿ï¼Œä»ä¸€ä¸ªæ™®é€šåº”ç”¨æ¼”å˜æˆä¸€ä¸ª å·¨çŸ³åº”ç”¨(Frontend Monolith) åï¼Œåº”ç”¨ä¸å¯ç»´æŠ¤çš„é—®é¢˜ã€‚\nåœ¨å„å¤§å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆå‡ºç°å‰ï¼Œé€šå¸¸ç”¨iframeè§£å†³è¿™ç±»é—®é¢˜ã€‚æœ¬æ–‡é¦–å…ˆä»iframeå’Œå¾®å‰ç«¯æ¶æ„çš„è§†è§’ï¼Œå»å¯¹æ¯”ä¸‹åŸç†ã€‚å…¶æ¬¡ï¼Œå¯¹æ¯”ç°æœ‰çš„å„å¤§å¾®å‰ç«¯æ¡†æ¶\nä¸€ã€iframe vs å¾®å‰ç«¯æ¶æ„ 1.iframe iframeæä¾›äº†æµè§ˆå™¨åŸç”Ÿçš„ç¡¬éš”ç¦»æ–¹æ¡ˆ ï¼Œä¸è®ºæ˜¯ã€å·¨çŸ³åº”ç”¨ã€‘çš„æ ·å¼éš”ç¦»ã€jséš”ç¦»é—®é¢˜éƒ½èƒ½è¢«å®Œç¾è§£å†³ã€‚ ä½†æœ€å¤§é—®é¢˜ä¹Ÿåœ¨äºiframeçš„éš”ç¦»æ€§æ— æ³•è¢«çªç ´ï¼Œå¯¼è‡´åº”ç”¨é—´ä¸Šä¸‹æ–‡æ— æ³•è¢«å…±äº«ï¼Œå¸¦æ¥å¼€å‘å’Œäº§å“ä½“éªŒçš„é—®é¢˜ï¼š\nurlä¸åŒæ­¥: æµè§ˆå™¨åˆ·æ–°iframe urlçŠ¶æ€ä¸¢å¤±ã€åé€€å‰è¿›æŒ‰é’®æ— æ³•ä½¿ç”¨ UIä¸åŒæ­¥: DOMç»“æ„ä¸å…±äº«ï¼Œå¼¹çª—åªèƒ½åœ¨iframeå†…éƒ¨å±•ç¤ºï¼Œæ— æ³•è¦†ç›–å…¨å±€ éš”ç¦»é—®é¢˜: å…¨å±€ä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»ï¼Œå†…å­˜å˜é‡ä¸å…±äº«ï¼Œiframeå†…å¤–ç³»ç»Ÿçš„é€šä¿¡ã€æ•°æ®åŒæ­¥ç­‰éœ€æ±‚ï¼Œä¸»åº”ç”¨çš„cookieè¦é€ä¼ åˆ°æ ¹åŸŸåéƒ½ä¸åŒçš„å­åº”ç”¨ä¸­å®ç°å…ç™»æ•ˆæœ æ…¢: æ¯æ¬¡å­åº”ç”¨è¿›å…¥éƒ½æ˜¯ä¸€æ¬¡æµè§ˆå™¨ä¸Šä¸‹æ–‡é‡å»ºã€èµ„æºé‡æ–°åŠ è½½çš„è¿‡ç¨‹ 2.å¾®å‰ç«¯æ¶æ„ å¾®å‰ç«¯æ¡†æ¶å†…çš„å„ä¸ªåº”ç”¨éƒ½æ”¯æŒç‹¬ç«‹å¼€å‘éƒ¨ç½²ã€ä¸é™æŠ€æœ¯æ¡†æ¶ã€æ”¯æŒç‹¬ç«‹è¿è¡Œã€åº”ç”¨çŠ¶æ€éš”ç¦»ä½†ä¹Ÿå¯å…±äº«ç­‰ç‰¹å¾ã€‚\näºŒã€å¾®å‰ç«¯æ¶æ„ æ¡†æ¶1: single-spa single-spaæ˜¯æœ€æ—©çš„å¾®å‰ç«¯æ¡†æ¶ï¼Œå…¼å®¹å¤šç§å‰ç«¯æŠ€æœ¯æ ˆï¼Œæ”¯æŒå°†å¤šä¸ªå•é¡µé¢åº”ç”¨èšåˆä¸ºä¸€ä¸ªæ•´ä½“åº”ç”¨çš„ã€‚\nç®€å•æ¥è¯´å°±æ˜¯ã€èšåˆã€‘ï¼Œè¯¥åº“å¯è®©ä½ çš„åº”ç”¨ä½¿ç”¨å¤šä¸ªä¸åŒçš„æŠ€æœ¯æ ˆï¼ˆvueã€reactã€angularç­‰)è¿›è¡ŒåŒæ­¥å¼€å‘ï¼Œæœ€åä½¿ç”¨ä¸€ä¸ªå…¬ç”¨çš„è·¯ç”±å»å®ç°å®Œç¾çš„åˆ‡æ¢\n1.å®ç°æ–¹æ¡ˆ single-spaå®ç°äº†ä¸€å¥— ã€ç”Ÿå‘½å‘¨æœŸã€‘ï¼Œå¼€å‘è€…éœ€åœ¨ç›¸åº”çš„æ—¶æœºè‡ªå·±å»åŠ è½½å¯¹åº”çš„å­åº”ç”¨ã€‚å®ƒåšçš„äº‹æƒ…å°±æ˜¯ï¼šæ³¨å†Œå­åº”ç”¨ã€ç›‘å¬URLå˜åŒ–ï¼Œç„¶ååŠ è½½å¯¹åº”çš„å­åº”ç”¨jsï¼Œæ‰§è¡Œå¯¹åº”å­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸæµç¨‹ã€‚\næä¾›registerApplicationæ–¹æ³•ï¼Œç”¨æ¥æ³¨å†Œå­åº”ç”¨åˆ—è¡¨ æä¾›activeWhenï¼Œç”±å¼€å‘è€…æŒ‡å®šè·¯ç”±æ»¡è¶³æ¡ä»¶æ—¶ï¼Œæ¿€æ´»ï¼ˆæŒ‚è½½ï¼‰å­åº”ç”¨çš„jsã€cssã€‚ jséš”ç¦»ç”±single-spa-leaked-globalså®ç° æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ mount A å­åº”ç”¨æ—¶ï¼Œæ­£å¸¸æ·»åŠ å…¨å±€å˜é‡ï¼Œæ¯”å¦‚ jQuery çš„ $, lodash çš„ _ã€‚åœ¨ unmount A å­åº”ç”¨æ—¶ï¼Œç”¨ä¸€ä¸ªå¯¹è±¡è®°å½•ä¹‹å‰ç»™ window æ·»åŠ çš„å…¨å±€å˜é‡ï¼Œå¹¶æŠŠ A åº”ç”¨é‡Œæ·»åŠ  window çš„å˜é‡éƒ½åˆ æ‰ã€‚ä¸‹ä¸€æ¬¡å† mount A åº”ç”¨æ—¶ï¼ŒæŠŠè®°å½•çš„å…¨å±€å˜é‡é‡æ–°åŠ å›æ¥ã€‚ csséš”ç¦»ï¼š å­åº”ç”¨ä¹‹é—´é€šè¿‡single-spa-cssæ’ä»¶æä¾›çš„cssç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œåšåˆ°å­åº”ç”¨mountæ—¶åŠ è½½cssï¼Œå­åº”ç”¨unmountæ—¶å°†css unmountæ‰ ä¸»åº”ç”¨ä¸å­åº”ç”¨ä¹‹é—´å¯é€šè¿‡PostCSSPrefix Selectorç»™æ ·å¼è‡ªåŠ¨åŠ å‰ç¼€çš„æ–¹å¼ï¼Œæˆ–Shadow DOMçš„å½¢å¼å»è§£å†³ã€‚ 2.single-spaå®æˆ˜ i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶ ä¸»è¦é€šè¿‡single-spaæä¾›çš„registerApplicationæ–¹æ³•æ³¨å†Œå­åº”ç”¨ï¼Œå­åº”ç”¨éœ€è¦æŒ‡å®šåŠ è½½å­åº”ç”¨çš„æ–¹æ³•ã€å’Œè·¯ç”±æ¡ä»¶\nimport Vue from 'vue' import App from './App.vue' import router from './router' import { registerApplication, start } from 'single-spa' Vue.config.productionTip = false // è¿œç¨‹åŠ è½½å­åº”ç”¨ function createScript(url) { return new Promise((resolve, reject) =\u003e { const script = document.createElement('script') script.src = url script.onload = resolve script.onerror = reject const firstScript = document.getElementsByTagName('script')[0] firstScript.parentNode.insertBefore(script, firstScript) }) } // åŠ è½½å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª promise function loadApp(url, globalVar) { // æ”¯æŒè¿œç¨‹åŠ è½½å­åº”ç”¨ return async () =\u003e { await createScript(url + '/js/chunk-vendors.js') await createScript(url + '/js/app.js') // è¿™é‡Œçš„returnå¾ˆé‡è¦ï¼Œéœ€è¦ä»è¿™ä¸ªå…¨å±€å¯¹è±¡ä¸­æ‹¿åˆ°å­åº”ç”¨æš´éœ²å‡ºæ¥çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° return window[globalVar] } } // å­åº”ç”¨åˆ—è¡¨ const apps = [ { // å­åº”ç”¨åç§° name: 'app1', // å­åº”ç”¨åŠ è½½å‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªpromise app: loadApp('http://localhost:8081', 'app1'), // å½“è·¯ç”±æ»¡è¶³æ¡ä»¶æ—¶ï¼ˆè¿”å›trueï¼‰ï¼Œæ¿€æ´»ï¼ˆæŒ‚è½½ï¼‰å­åº”ç”¨ activeWhen: location =\u003e location.pathname.startsWith('/app1'), // ä¼ é€’ç»™å­åº”ç”¨çš„å¯¹è±¡ customProps: {} }, { name: 'app2', app: loadApp('http://localhost:8082', 'app2'), activeWhen: location =\u003e location.pathname.startsWith('/app2'), customProps: {} }, { // å­åº”ç”¨åç§° name: 'app3', // å­åº”ç”¨åŠ è½½å‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªpromise app: loadApp('http://localhost:3000', 'app3'), // å½“è·¯ç”±æ»¡è¶³æ¡ä»¶æ—¶ï¼ˆè¿”å›trueï¼‰ï¼Œæ¿€æ´»ï¼ˆæŒ‚è½½ï¼‰å­åº”ç”¨ activeWhen: location =\u003e location.pathname.startsWith('/app3'), // ä¼ é€’ç»™å­åº”ç”¨çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œè¯¥é…ç½®å‘Šè¯‰reactå­åº”ç”¨è‡ªå·±çš„å®¹å™¨å…ƒç´ æ˜¯ä»€ä¹ˆï¼Œè¿™å—å„¿å’Œvueå­åº”ç”¨çš„é›†æˆä¸ä¸€æ ·ï¼Œå®˜ç½‘å¹¶æ²¡æœ‰è¯´è¿™éƒ¨åˆ†ï¼Œæˆ–è€…æˆ‘æ²¡æ‰¾åˆ°ï¼Œæ˜¯é€šè¿‡çœ‹single-spa-reactæºç çŸ¥é“çš„ customProps: { domElement: document.getElementById('microApp'), // æ·»åŠ  name å±æ€§æ˜¯ä¸ºäº†å…¼å®¹è‡ªå·±å†™çš„lyn-single-spaï¼ŒåŸç”Ÿçš„ä¸éœ€è¦ï¼Œå½“ç„¶åŠ äº†ä¹Ÿä¸å½±å“ name: 'app3' } } ] // æ³¨å†Œå­åº”ç”¨ for (let i = apps.length - 1; i \u003e= 0; i--) { registerApplication(apps[i]) } new Vue({ router, mounted() { // å¯åŠ¨ start() }, render: h =\u003e h(App) }).$mount('#app') ii.å­åº”ç”¨å¯¼å‡ºæ–‡ä»¶ å­åº”ç”¨éœ€è¦å®‰è£…single-spa-reactæˆ–è€…single-spa-vueï¼Œ å°†å­åº”ç”¨ä¼ é€’ç»™single-spa-reactï¼Œå¾—åˆ°å­åº”ç”¨è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸï¼Œ å­åº”ç”¨å°†ç”Ÿå‘½å‘¨æœŸå¯¼å‡ºåˆ°å…¨å±€ï¼Œ åœ¨ä¸»åº”ç”¨å¯ä»¥è·å–å­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° import React from 'react'; import ReactDOM from 'react-dom'; import './index.css' import { BrowserRouter, Link, Route } from 'react-router-dom' import singleSpaReact from 'single-spa-react' // å­åº”ç”¨ç‹¬ç«‹è¿è¡Œ if (!window.singleSpaNavigate) { ReactDOM.render(rootComponent(), document.getElementById('root')) } // ç”Ÿå‘½å‘¨æœŸa const reactLifecycles = singleSpaReact({ React, ReactDOM, rootComponent, errorBoundary(err, info, props) { return \u003cdiv\u003e This renders when a catastrophic error occurs \u003c/div\u003e } }) // è¿™é‡Œå’Œvueä¸ä¸€æ ·ï¼Œpropså¿…é¡»å‘ä¸‹ä¼ é€’ export const bootstrap = async props =\u003e { console.log('app3 bootstrap'); return reactLifecycles.bootstrap(props) } export const mount = async props =\u003e { console.log('app3 mount'); return reactLifecycles.mount(props); } export const unmount = async props =\u003e { console.log('app3 unmount'); return reactLifecycles.unmount(props) } // æ ¹ç»„ä»¶ function rootComponent() { return \u003cReact.StrictMode\u003e \u003cBrowserRouter\u003e \u003cdiv\u003e \u003cLink to=\"/app3\"\u003eHome\u003c/Link\u003e | \u003cLink to=\"/app3/about\"\u003e About\u003c/Link\u003e \u003cRoute exact path=\"/app3\" component={Home} /\u003e \u003cRoute exact path=\"/app3/about\" component={About} /\u003e \u003c/div\u003e \u003c/BrowserRouter\u003e \u003c/React.StrictMode\u003e } // home ç»„ä»¶ function Home() { return \u003cdiv\u003e \u003ch1\u003eapp3 home page\u003c/h1\u003e \u003c/div\u003e } // about ç»„ä»¶ function About() { return \u003cdiv\u003e \u003ch1\u003eapp3 about page\u003c/h1\u003e \u003c/div\u003e } iii.æ‰“åŒ…é…ç½® å°†å­åº”ç”¨å¯¼å‡ºæ¨¡å¼è®¾ç½®ä¸ºumd\nconst package = require('./package.json') module.exports = { // å‘Šè¯‰å­åº”ç”¨åœ¨è¿™ä¸ªåœ°å€åŠ è½½é™æ€èµ„æºï¼Œå¦åˆ™ä¼šå»åŸºåº§åº”ç”¨çš„åŸŸåä¸‹åŠ è½½ publicPath: '//localhost:8082', // å¼€å‘æœåŠ¡å™¨ devServer: { port: 8082 }, configureWebpack: { // å¯¼å‡ºumdæ ¼å¼çš„åŒ…ï¼Œåœ¨å…¨å±€å¯¹è±¡ä¸ŠæŒ‚è½½å±æ€§package.nameï¼ŒåŸºåº§åº”ç”¨éœ€è¦é€šè¿‡è¿™ä¸ªå…¨å±€å¯¹è±¡è·å–ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚å­åº”ç”¨å¯¼å‡ºçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° output: { // libraryçš„å€¼åœ¨æ‰€æœ‰å­åº”ç”¨ä¸­éœ€è¦å”¯ä¸€ library: package.name, libraryTarget: 'umd' } } } iv.é¢„è§ˆ å¯ä»¥çœ‹åˆ°å®ƒæ˜¯åŠ¨æ€åŠ è½½çš„å­åº”ç”¨çš„jsï¼Œå¹¶æ‰§è¡Œjsï¼Œå°†å†…å®¹æ¸²æŸ“åˆ°äº†ä¸»åº”ç”¨çš„ç›’å­å†…ã€‚\n3.æ¡†æ¶ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š\næ•æ·æ€§ - ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ï¼Œå¾®åº”ç”¨ä»“åº“ç‹¬ç«‹ï¼Œå‰åç«¯å¯ç‹¬ç«‹å¼€å‘ï¼Œéƒ¨ç½²å®Œæˆåä¸»æ¡†æ¶è‡ªåŠ¨å®ŒæˆåŒæ­¥æ›´æ–°ï¼› æŠ€æœ¯æ ˆæ— å…³ï¼Œä¸»æ¡†æ¶ä¸é™åˆ¶æ¥å…¥åº”ç”¨çš„æŠ€æœ¯æ ˆï¼Œå¾®åº”ç”¨å…·å¤‡å®Œå…¨è‡ªä¸»æƒï¼› å¢é‡å‡çº§ï¼Œåœ¨é¢å¯¹å„ç§å¤æ‚åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å¾ˆéš¾å¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç³»ç»Ÿåšå…¨é‡çš„æŠ€æœ¯æ ˆå‡çº§æˆ–é‡æ„ï¼Œè€Œå¾®å‰ç«¯æ˜¯ä¸€ç§éå¸¸å¥½çš„å®æ–½æ¸è¿›å¼é‡æ„çš„æ‰‹æ®µå’Œç­–ç•¥ ç¼ºç‚¹ï¼š\néœ€è¦è‡ªå·±å»åŠ è½½å­åº”ç”¨ ä¸æ”¯æŒJavascriptæ²™ç®±éš”ç¦»ï¼Œéœ€è¦è‡ªå·±å»ä½¿ç”¨single-spa-leaked-globalsä¹‹ç±»çš„åº“å»éš”ç¦» ä¸æ”¯æŒcsséš”ç¦»ï¼Œéœ€è¦è‡ªå·±ä½¿ç”¨single-spa-cssåº“æˆ–è€…postcssç­‰å»è§£å†³æ ·å¼å†²çªé—®é¢˜ æ— æ³•é¢„åŠ è½½ æ¡†æ¶2: qiankun é˜¿é‡Œçš„qiankunæ˜¯åŸºäºsingle-spaçš„å¾®å‰ç«¯å®ç°åº“ï¼Œå­µåŒ–è‡ªèš‚èšï¼Œèƒ½æ›´ç®€å•ã€æ— ç—›çš„æ„å»ºä¸€ä¸ªç”Ÿäº§å¯ç”¨å¾®å‰ç«¯æ¶æ„ç³»ç»Ÿã€‚ç›®å‰(2024å¹´4æœˆ) github star 15.4kã€‚\n1.å®ç°æ–¹æ¡ˆ single-spaæ˜¯åŸºäºjs-entryæ–¹æ¡ˆï¼Œè€Œqiankun æ˜¯åŸºäºhtml-entry åŠæ²™ç®±è®¾è®¡ï¼Œä½¿å¾—å¾®åº”ç”¨çš„æ¥å…¥ åƒä½¿ç”¨ iframe ä¸€æ ·ç®€å•ã€‚ ä¸»åº”ç”¨ç›‘å¬è·¯ç”±ï¼ŒåŠ è½½å¯¹åº”å­åº”ç”¨çš„htmlï¼ŒæŒ‚è½½åˆ°ä¸»åº”ç”¨çš„å…ƒç´ å†…ï¼Œç„¶åè§£æå­åº”ç”¨çš„htmlï¼Œä»ä¸­åˆ†æå‡ºcssã€jså†å»æ²™ç›’åŒ–ååŠ è½½æ‰§è¡Œï¼Œæœ€ç»ˆå°†å­åº”ç”¨çš„å†…å®¹æ¸²æŸ“å‡ºæ¥ã€‚ qiankunå®ç°æ ·å¼éš”ç¦»æœ‰ä¸¤ç§æ¨¡å¼å¯ä¾›å¼€å‘è€…é€‰æ‹©ï¼š strictStyleIsolationï¼š è¿™ç§æ¨¡å¼ä¸‹ qiankun ä¼šä¸ºæ¯ä¸ªå¾®åº”ç”¨çš„å®¹å™¨åŒ…è£¹ä¸Šä¸€ä¸ª shadow dom èŠ‚ç‚¹ï¼Œä»è€Œç¡®ä¿å¾®åº”ç”¨çš„æ ·å¼ä¸ä¼šå¯¹å…¨å±€é€ æˆå½±å“ã€‚ experimentalStyleIsolationï¼š å½“ experimentalStyleIsolation è¢«è®¾ç½®ä¸º true æ—¶ï¼Œqiankun ä¼šæ”¹å†™å­åº”ç”¨æ‰€æ·»åŠ çš„æ ·å¼ï¼Œä¼šä¸ºæ‰€æœ‰æ ·å¼è§„åˆ™å¢åŠ ä¸€ä¸ªç‰¹æ®Šçš„é€‰æ‹©å™¨è§„åˆ™ï¼Œæ¥é™å®šå…¶å½±å“èŒƒå›´ qiankunå®ç°jséš”ç¦»ï¼Œé‡‡ç”¨äº†ä¸¤ç§æ²™ç®±ï¼Œåˆ†åˆ«ä¸ºåŸºäºProxyå®ç°çš„æ²™ç®±å’Œå¿«ç…§æ²™ç®±ï¼Œå½“æµè§ˆå™¨ä¸æ”¯æŒProxyä¼šé™çº§ä¸ºå¿«ç…§æ²™ç®± Proxyæ²™ç®±æœºåˆ¶ï¼š\n// ä¼ªä»£ç  class ProxySandbox { constructor() { const rawWindow = window; const fakeWindow = {} const proxy = new Proxy(fakeWindow, { set(target, p, value) { target[p] = value; return true }, get(target, p) { return target[p] || rawWindow[p]; } }); this.proxy = proxy } } let sandbox1 = new ProxySandbox(); let sandbox2 = new ProxySandbox(); window.a = 1; // ä¼ªä»£ç  ((window) =\u003e { window.a = 'hello'; console.log(window.a) // hello })(sandbox1.proxy); ((window) =\u003e { window.a = 'world'; console.log(window.a) // world })(sandbox2.proxy); å¿«ç…§æ²™ç®±ï¼š\n// ä¼ªä»£ç  class SnapshotSandbox { constructor() { this.proxy = window; this.modifyPropsMap = {}; // ä¿®æ”¹äº†é‚£äº›å±æ€§ this.active(); // è°ƒç”¨activeä¿å­˜ä¸»åº”ç”¨windowå¿«ç…§ } /**1. åˆå§‹åŒ–æ—¶ï¼Œåœ¨å­åº”ç”¨å³å°†mountå‰ï¼Œå…ˆè°ƒç”¨activeï¼Œä¿å­˜å½“å‰ä¸»åº”ç”¨çš„windowå¿«ç…§*/ active() { this.windowSnapshot = {}; // windowå¯¹è±¡çš„å¿«ç…§ for (const prop in window) { if (window.hasOwnProperty(prop)) { // å°†windowä¸Šçš„å±æ€§è¿›è¡Œæ‹ç…§ this.windowSnapshot[prop] = window[prop]; } } Object.keys(this.modifyPropsMap).forEach(p =\u003e { window[p] = this.modifyPropsMap[p]; }); } /** * å­åº”ç”¨å¸è½½æ—¶ï¼Œéå†å½“å‰å­åº”ç”¨çš„windowå±æ€§ï¼Œå’Œä¸»åº”ç”¨çš„windowå¿«ç…§åšå¯¹æ¯” * å¦‚æœä¸ä¸€è‡´ï¼Œåšä¸¤æ­¥æ“ä½œ * 1. ä¿å­˜ ä¸ä¸€è‡´çš„windowå±æ€§ï¼Œ * 2. è¿˜åŸwindow */ inactive() { for (const prop in window) { // diff å·®å¼‚ if (window.hasOwnProperty(prop)) { // å°†ä¸Šæ¬¡æ‹ç…§çš„ç»“æœå’Œæœ¬æ¬¡windowå±æ€§åšå¯¹æ¯” if (window[prop] !== this.windowSnapshot[prop]) { // ä¿å­˜ä¿®æ”¹åçš„ç»“æœ this.modifyPropsMap[prop] = window[prop]; // è¿˜åŸwindow window[prop] = this.windowSnapshot[prop]; } } } } } 2.qiankunå®æˆ˜ i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶ åˆå§‹åŒ–ä¸»åº”ç”¨ï¼Œå¹¶æ³¨å†Œå­åº”ç”¨ ä¸»åº”ç”¨å…¥å£æ–‡ä»¶åˆå§‹åŒ–åº”ç”¨ï¼Œæ³¨å†Œå­åº”ç”¨ï¼Œæ³¨å†Œå­åº”ç”¨æ—¶æ”¯æŒä¼ å…¥å­åº”ç”¨åˆ—è¡¨ï¼Œ æ³¨å†Œå­åº”ç”¨æ—¶éœ€è¦æŒ‡æ˜ä»¥ä¸‹å‡ ä¸ªä¸»è¦å‚æ•°ï¼š\nnameï¼š å¾®åº”ç”¨çš„åç§°ï¼Œå¾®åº”ç”¨ä¹‹é—´å¿…é¡»ç¡®ä¿å”¯ä¸€ entryï¼š å­åº”ç”¨çš„è®¿é—®é“¾æ¥ã€‚ä¸»åº”ç”¨ä¼šåŠ è½½æ•´ä¸ªé¡µé¢ï¼Œä¾‹å¦‚https://qiankun.umijs.org/guide/ containerï¼šéœ€è¦æŒ‚è½½å­åº”ç”¨çš„DOMå…ƒç´  loader: å­åº”ç”¨æœªåŠ è½½æ—¶çš„ç•Œé¢ï¼Œä¸€èˆ¬ä¸ºloading activeRuleï¼š è·¯ç”±åŒ¹é…è§„åˆ™ å¼€å¯å­åº”ç”¨start(options) options.prefetchæ­¤æ—¶å¯ä»¥é€‰æ‹©æ˜¯å¦é¢„åŠ è½½å­åº”ç”¨ã€‚ options.sandboxé»˜è®¤æƒ…å†µä¸‹çš„æ²™ç®±å¯ç¡®ä¿ã€å•å®ä¾‹åœºæ™¯å­åº”ç”¨ä¹‹é—´ã€‘çš„æ ·å¼éš”ç¦»ï¼Œä½†æ— æ³•ç¡®ä¿ä¸»åº”ç”¨å’Œå­åº”ç”¨ã€æˆ–è€…å¤šå®ä¾‹åœºæ™¯çš„å­åº”ç”¨æ ·å¼éš”ç¦»ã€‚qiankunæä¾›äº†å¦å¤–ä¸¤ç§æ–¹å¼çš„éš”ç¦»ï¼Œä¾›å¼€å‘è€…é€‰æ‹©ï¼š strictStyleIsolationï¼šå½“é…ç½®ä¸º{ strictStyleIsolation: true }æ—¶è¡¨ç¤ºå¼€å¯ä¸¥æ ¼çš„æ ·å¼éš”ç¦»æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹qiankunä¼šä¸ºæ¯ä¸ªå¾®åº”ç”¨çš„å®¹å™¨åŒ…è£¹ä¸Šä¸€ä¸ªshadow domèŠ‚ç‚¹ï¼Œä»è€Œç¡®ä¿å¾®åº”ç”¨çš„æ ·å¼ä¸ä¼šå¯¹å…¨å±€é€ æˆå½±å“ experimentalStyleIsolationï¼šå½“{experimentalStyleIsolation: true}è¢«è®¾ç½®ï¼Œqiankunä¼šæ”¹å†™å­åº”ç”¨æ‰€æ·»åŠ çš„æ ·å¼ä¸ºæ‰€æœ‰æ ·å¼è§„åˆ™å¢åŠ ä¸€ä¸ªç‰¹æ®Šçš„é€‰æ‹©å™¨è§„åˆ™æ¥é™å®šå…¶å½±å“èŒƒå›´ import { registerMicroApps, start, initGlobalState } from 'qiankun'; registerMicroApps([ { name: 'react app', // app name registered entry: '//localhost:7100', container: '#yourContainer', activeRule: '/yourActiveRule', }, { name: 'vue app', entry: { scripts: ['//localhost:7100/main.js'] }, container: '#yourContainer2', activeRule: '/yourActiveRule2', }, ]); // é€šè®¯ const { onGlobalStateChange, setGlobalState } = initGlobalState({ user: 'qiankun', }); onGlobalStateChange((value, prev) =\u003e console.log('[onGlobalStateChange - master]:', value, prev)); setGlobalState({ ignore: 'master', user: { name: 'master', }, }); /** * è®¾ç½®é»˜è®¤è¿›å…¥çš„å­åº”ç”¨ */ setDefaultMountApp('/react16'); /** * å¯åŠ¨åº”ç”¨ */ start({ prefetch: true, // é¢„åŠ è½½å­åº”ç”¨ sandbox:{ strictStyleIsolation: true, // shadow domçš„æ–¹å¼å®ç°æ ·å¼éš”ç¦» // experimentalStyleIsolation: true, //æ·»åŠ ç‰¹æ®Šçš„é€‰æ‹©å™¨çš„æ–¹å¼å®ç°æ ·å¼éš”ç¦» } }); runAfterFirstMounted(() =\u003e { console.log('[MainApp] first app mounted'); }); ii.å­åº”ç”¨å¯¼å‡ºç”Ÿå‘½å‘¨æœŸé’©å­ å­åº”ç”¨éœ€åœ¨è‡ªå·±çš„å…¥å£ jså¯¼å‡ºbootstrapã€mountã€unmountä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä»¥ä¾›ä¸»åº”ç”¨åœ¨é€‚å½“çš„æ—¶æœºè°ƒç”¨\nimport React from 'react'; import ReactDOM from 'react-dom'; import App from './App'; import * as serviceWorker from './serviceWorker'; function render(props) { const { container } = props; ReactDOM.render(\u003cApp /\u003e, container ? container.querySelector('#root') : document.querySelector('#root')); } /** * å’Œä¸»åº”ç”¨é€šè®¯ */ function storeTest(props) { props.onGlobalStateChange((value, prev) =\u003e console.log(`[onGlobalStateChange - ${props.name}]:`, value, prev), true); props.setGlobalState({ ignore: props.name, user: { name: props.name, }, }); } if (!window.__POWERED_BY_QIANKUN__) { render({}); } /** * bootstrap åªä¼šåœ¨å¾®åº”ç”¨åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ï¼Œä¸‹æ¬¡å¾®åº”ç”¨é‡æ–°è¿›å…¥æ—¶ä¼šç›´æ¥è°ƒç”¨ mount é’©å­ï¼Œä¸ä¼šå†é‡å¤è§¦å‘ bootstrapã€‚ * é€šå¸¸æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›å…¨å±€å˜é‡çš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚ä¸ä¼šåœ¨ unmount é˜¶æ®µè¢«é”€æ¯çš„åº”ç”¨çº§åˆ«çš„ç¼“å­˜ç­‰ã€‚ */ export async function bootstrap() { console.log('[react16] react app bootstraped'); } /** * åº”ç”¨æ¯æ¬¡è¿›å…¥éƒ½ä¼šè°ƒç”¨ mount æ–¹æ³•ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨è¿™é‡Œè§¦å‘åº”ç”¨çš„æ¸²æŸ“æ–¹æ³• */ export async function mount(props) { console.log('[react16] props from main framework', props); storeTest(props); render(props); } /** * åº”ç”¨æ¯æ¬¡ åˆ‡å‡º/å¸è½½ ä¼šè°ƒç”¨çš„æ–¹æ³•ï¼Œé€šå¸¸åœ¨è¿™é‡Œæˆ‘ä»¬ä¼šå¸è½½å¾®åº”ç”¨çš„åº”ç”¨å®ä¾‹ */ export async function unmount(props) { const { container } = props; ReactDOM.unmountComponentAtNode(container ? container.querySelector('#root') : document.querySelector('#root')); } iii. é…ç½®æ‰“åŒ…å·¥å…· ä¸ºäº†è®©ä¸»åº”ç”¨èƒ½æ­£ç¡®è¯†åˆ«å¾®åº”ç”¨æš´éœ²å‡ºæ¥çš„ä¸€äº›å…¨å±€ä¿¡æ¯å’Œå¼€å‘ç¯å¢ƒä¸‹çš„è·¨åŸŸå…¼å®¹ï¼Œåœ¨å­åº”ç”¨ï¼ˆä»¥create-react-appå‡ºæ¥çš„reacté¡¹ç›®ä¸ºä¾‹ï¼‰å®‰è£…@rescripts/cliï¼Œå¹¶åœ¨å­åº”ç”¨ç›®å½•ä¸‹æ–°å»º.rescriptsrc.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nconst { name } = require('./package'); module.exports = { webpack: (config) =\u003e { config.output.library = `${name}-[name]`; config.output.libraryTarget = 'umd'; // ä¸ºäº†èƒ½é€šè¿‡window['app-name1']æ‹¿åˆ°å­åº”ç”¨å£°æ˜çš„ç”Ÿå‘½å‘¨æœŸ // webpack 5 éœ€è¦æŠŠ jsonpFunction æ›¿æ¢æˆ chunkLoadingGlobal config.output.jsonpFunction = `webpackJsonp_${name}`; config.output.globalObject = 'window'; return config; }, devServer: (_) =\u003e { const config = _; config.headers = { 'Access-Control-Allow-Origin': '*', }; config.historyApiFallback = true; config.hot = false; config.watchContentBase = false; config.liveReload = false; return config; }, }; iv.é¢„è§ˆ ä½¿ç”¨strictStyleIsolationï¼štrueæ–¹å¼è¿›è¡Œæ ·å¼éš”ç¦»ï¼Œä¼šç”Ÿæˆä¸€ä¸ªshadow domï¼Œè¿›è¡Œæ ·å¼çš„å®Œå…¨éš”ç¦»ï¼š\nä½¿ç”¨experimentalStyleIsolationï¼štrueçš„æ–¹å¼è¿›è¡Œæ ·å¼éš”ç¦»ï¼Œä¼šåœ¨cssé€‰æ‹©å™¨å‰æ·»åŠ ç‰¹æ®Šæ ‡è¯†ï¼š å¯ä»¥çœ‹åˆ°ï¼Œqiankunä¼šå°†å­åº”ç”¨çš„htmlæ¸²æŸ“åˆ°è‡ªå®šä¹‰çš„containerä¸­ã€‚ ä¸»åº”ç”¨åŠ è½½çš„æ˜¯å­åº”ç”¨çš„htmlï¼Œåœ¨è§£æå­åº”ç”¨çš„htmlçš„è¿‡ç¨‹ä¸­é‡åˆ°jså’Œcssä¼šè½½æ¡†æ¶å†…è¿›è¡Œæ²™ç›’å¤„ç†ï¼Œå®Œæˆcsså’Œjsçš„éš”ç¦»ï¼Œä¹‹åä¸‹è½½å¹¶æ‰§è¡Œï¼Œå®Œæˆæ•´ä¸ªå­åº”ç”¨çš„æ¸²æŸ“è¿‡ç¨‹ã€‚\n3.æ¡†æ¶ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹\nhtml entryçš„æ¥å…¥æ–¹å¼ï¼Œä¸éœ€è¦è‡ªå·±å†™loadæ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥å†™å­åº”ç”¨çš„è®¿é—®é“¾æ¥å°±å¯ä»¥ã€‚ æä¾›jsæ²™ç®± æä¾›æ ·å¼éš”ç¦»ï¼Œä¸¤ç§æ–¹å¼å¯é€‰ èµ„æºé¢„åŠ è½½ï¼Œåœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´é¢„åŠ è½½æœªæ‰“å¼€çš„å¾®åº”ç”¨èµ„æºï¼ŒåŠ é€Ÿå¾®åº”ç”¨æ‰“å¼€é€Ÿåº¦ã€‚ ç¤¾åŒºæ´»è·ƒ umi æ’ä»¶ï¼Œæä¾›äº† @umijs/plugin-qiankun ä¾› umi åº”ç”¨ä¸€é”®åˆ‡æ¢æˆå¾®å‰ç«¯æ¶æ„ç³»ç»Ÿ é™¤äº†æœ€åä¸€ç‚¹æ‹“å±•ä»¥å¤–ï¼Œå¾®å‰ç«¯æƒ³è¦è¾¾åˆ°çš„æ•ˆæœéƒ½å·²ç»è¾¾åˆ°ã€‚ åº”ç”¨é—´é€šä¿¡ç®€å•ï¼Œå…¨å±€æ³¨å…¥è·¯ç”±ä¿æŒï¼Œæµè§ˆå™¨åˆ·æ–°ã€å‰è¿›ã€åé€€ï¼Œéƒ½å¯ä»¥ä½œç”¨åˆ°å­åº”ç”¨ è·¯ç”±ä¿æŒï¼Œæµè§ˆå™¨åˆ·æ–°ã€å‰è¿›ã€åé€€ï¼Œéƒ½å¯ä»¥ä½œç”¨åˆ°å­åº”ç”¨ ç¼ºç‚¹\næ”¹é€ æˆæœ¬è¾ƒå¤§ï¼Œä» webpackã€ä»£ç ã€è·¯ç”±ç­‰ç­‰éƒ½è¦åšä¸€ç³»åˆ—çš„é€‚é… å¯¹ eval çš„äº‰è®®ï¼Œevalå‡½æ•°çš„å®‰å…¨å’Œæ€§èƒ½æ˜¯æœ‰ä¸€äº›äº‰è®®çš„ï¼šMDNçš„evalä»‹ç»ï¼› æ— æ³•åŒæ—¶æ¿€æ´»å¤šä¸ªå­åº”ç”¨ï¼Œä¹Ÿä¸æ”¯æŒå­åº”ç”¨ä¿æ´» æ— æ³•æ”¯æŒ vite ç­‰ ESM è„šæœ¬è¿è¡Œ æ¡†æ¶3: wujie wujieæ˜¯è…¾è®¯å‡ºå“ã€‚åŸºäº webcomponent å®¹å™¨ + iframe æ²™ç®±ï¼Œèƒ½å¤Ÿå®Œå–„çš„è§£å†³é€‚é…æˆæœ¬ã€æ ·å¼éš”ç¦»ã€è¿è¡Œæ€§èƒ½ã€é¡µé¢ç™½å±ã€å­åº”ç”¨é€šä¿¡ã€å­åº”ç”¨ä¿æ´»ã€å¤šåº”ç”¨æ¿€æ´»ã€vite æ¡†æ¶æ”¯æŒã€åº”ç”¨å…±äº«ç­‰ã€‚ç›®å‰ï¼ˆ2024å¹´4æœˆï¼‰github star 3.7k\n1.å®ç°æ–¹æ¡ˆ æ— ç•Œåˆ©ç”¨iframeå’Œwebcomponentæ¥æ­å»ºå¤©ç„¶çš„jséš”ç¦»æ²™ç®±å’Œcsséš”ç¦»æ²™ç®±, åˆ©ç”¨iframeçš„historyå’Œä¸»åº”ç”¨çš„historyåœ¨åŒä¸€ä¸ªtop-level browsing contextæ¥æ­å»ºå¤©ç„¶çš„è·¯ç”±åŒæ­¥æœºåˆ¶ æ”¯æŒä»¥fiberçš„å½¢å¼æ‰§è¡Œjsï¼Œç”±äºå­åº”ç”¨çš„æ‰§è¡Œä¼šé˜»å¡ä¸»åº”ç”¨çš„æ¸²æŸ“çº¿ç¨‹ï¼Œå½“fiberè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆjsæ‰§è¡Œæ—¶é‡‡å–ç±»ä¼¼react fiberçš„æ¨¡å¼æ–¹å¼é—´æ–­æ‰§è¡Œï¼Œæ¯ä¸ª js æ–‡ä»¶çš„æ‰§è¡Œéƒ½åŒ…è£¹åœ¨requestidlecallbackä¸­ï¼Œæ¯æ‰§è¡Œä¸€ä¸ªjså¯ä»¥è¿”å›å“åº”å¤–éƒ¨çš„è¾“å…¥ï¼Œä½†æ˜¯è¿™ä¸ªé¢—ç²’åº¦æ˜¯jsæ–‡ä»¶ï¼Œå¦‚æœå­åº”ç”¨å•ä¸ªjsæ–‡ä»¶è¿‡å¤§ï¼Œå¯ä»¥é€šè¿‡æ‹†åŒ…çš„æ–¹å¼é™ä½è¾¾åˆ°fiberæ¨¡å¼æ•ˆç›Šæœ€å¤§åŒ– wujieæ˜¯å¦‚ä½•æ¸²æŸ“å­åº”ç”¨çš„ï¼Ÿ wujieè·Ÿqiankunä¸€æ ·ï¼Œéƒ½æ˜¯åŸºäºhtml entryåŠ è½½çš„ï¼Œä½†ä»–ä»¬è§£æhtmlçš„è¿‡ç¨‹æ˜¯ä¸ä¸€æ ·çš„ã€‚ qiankunæ˜¯ç›´æ¥è§£æå¹¶æ‰§è¡Œjsã€cssã€htmlçš„ï¼Œè€Œwujieåˆ™æ˜¯å…ˆè§£æhtmlï¼Œæå–å‡ºscriptè„šæœ¬æ”¾å…¥ç©ºçš„iframeä¸­ï¼Œæå–å‡ºcssã€htmlæ”¾å…¥åˆ°web componentsä¸­ï¼Œå…·ä½“æ¥è¯´ï¼š\nè§£æå…¥å£ HTML ï¼Œåˆ†åˆ«å¾—åˆ°scriptã€cssã€æ¨¡ç‰ˆhtml åˆ›å»ºä¸€ä¸ªçº¯å‡€çš„ iframeï¼Œä¸ºäº†å®ç°åº”ç”¨é—´ï¼ˆiframe é—´ï¼‰é€šè®¯ï¼Œæ— ç•Œå­åº”ç”¨ iframe çš„ url ä¼šè®¾ç½®ä¸ºä¸»åº”ç”¨çš„åŸŸåï¼ˆåŒåŸŸï¼‰ï¼Œå› æ­¤ iframe çš„ location.href å¹¶ä¸æ˜¯å­åº”ç”¨çš„ urlã€‚åˆ›å»ºå¥½ååœæ­¢åŠ è½½iframeã€‚ iframeå†…æ’å…¥jsï¼Œå°†æŠ½ç¦»å‡ºæ¥çš„scriptè„šæœ¬ï¼Œæ’åˆ°iframeä¸­å»ï¼Œåœ¨iframeä¸­æ‰§è¡Œå­åº”ç”¨çš„js åˆ›å»ºweb componentï¼Œidä¸ºå­åº”ç”¨idï¼Œå°†æŠ½ç¦»å‡ºæ¥çš„htmlæ’å…¥ã€‚ ç”±äºiframeå†…çš„jsæœ‰å¯èƒ½æ“ä½œdomï¼Œä½†æ˜¯iframeå†…æ²¡æœ‰domï¼Œéšæ„wujieæ¡†æ¶å†…å¯¹iframeæ‹¦æˆªdocumentå¯¹è±¡ï¼Œç»Ÿä¸€å°†domæŒ‡å‘shadowRootï¼Œæ­¤æ—¶æ¯”å¦‚æ–°å»ºå…ƒç´ ã€å¼¹çª—æˆ–è€…å†’æ³¡ç»„ä»¶å°±å¯ä»¥æ­£å¸¸çº¦æŸåœ¨shadowRootå†…éƒ¨ã€‚ 2.wujieå®æˆ˜ wujieæ¥å…¥å¾ˆç®€å•ï¼Œä¸»åº”ç”¨å¯ä»¥è®©å¼€å‘è€…ä»¥ç»„ä»¶çš„æ–¹å¼åŠ è½½å­åº”ç”¨ã€‚å­åº”ç”¨åªéœ€è¦åšæ”¯æŒè·¨åŸŸè¯·æ±‚æ”¹é€ ï¼Œè¿™ä¸ªæ˜¯æ‰€æœ‰å¾®å‰ç«¯æ¡†æ¶è¿è¡Œçš„å‰æï¼Œé™¤æ­¤ä¹‹å¤–å­åº”ç”¨å¯ä»¥ä¸åšä»»ä½•æ”¹é€ å°±å¯ä»¥åœ¨æ— ç•Œæ¡†æ¶ä¸­è¿è¡Œï¼Œä¸è¿‡æ­¤æ—¶è¿è¡Œçš„æ–¹å¼æ˜¯é‡å»ºæ¨¡å¼ã€‚ å­åº”ç”¨ä¹Ÿå¯ä»¥é…ç½®ä¿æ´»ã€ç”Ÿå‘½å‘¨æœŸé€‚é…è¿›å…¥ä¿æ´»æ¨¡å¼æˆ–å•ä¾‹æ¨¡å¼ã€‚\ni.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶ ä¸å…¶ä»–æ¡†æ¶ä¸€æ ·ï¼Œå…ˆé…ç½®å­åº”ç”¨\n// main-react/index.js import \"react-app-polyfill/stable\"; import \"react-app-polyfill/ie11\"; import React from \"react\"; import ReactDOM from \"react-dom\"; import WujieReact from \"wujie-react\"; import \"./index.css\"; import App from \"./App\"; import hostMap from \"./hostMap\"; import credentialsFetch from \"./fetch\"; import lifecycles from \"./lifecycle\"; import plugins from \"./plugin\"; const { setupApp, preloadApp, bus } = WujieReact; const isProduction = process.env.NODE_ENV === \"production\"; bus.$on(\"click\", (msg) =\u003e window.alert(msg)); const degrade = window.localStorage.getItem(\"degrade\") === \"true\" || !window.Proxy || !window.CustomElementRegistry; /** * å¤§éƒ¨åˆ†ä¸šåŠ¡æ— éœ€è®¾ç½® attrs * æ­¤å¤„ä¿®æ­£ iframe çš„ srcï¼Œæ˜¯é˜²æ­¢github pages cspæŠ¥é”™ * å› ä¸ºé»˜è®¤æ˜¯åªæœ‰ host+portï¼Œæ²¡æœ‰æºå¸¦è·¯å¾„ */ const attrs = isProduction ? { src: hostMap(\"//localhost:7700/\") } : {}; /** * é…ç½®åº”ç”¨ï¼Œä¸»è¦æ˜¯è®¾ç½®é»˜è®¤é…ç½® * preloadAppã€startAppçš„é…ç½®ä¼šåŸºäºè¿™ä¸ªé…ç½®åšè¦†ç›– */ setupApp({ name: \"react16\", url: hostMap(\"//localhost:7600/\"), attrs, // å­åº”ç”¨iframeçš„src exec: true, // é¢„æ‰§è¡Œ fetch: credentialsFetch, // è‡ªå®šä¹‰çš„fetchæ–¹æ³• plugins, /** å­åº”ç”¨çŸ­è·¯å¾„æ›¿æ¢ï¼Œè·¯ç”±åŒæ­¥æ—¶ç”Ÿæ•ˆ */ prefix: { \"prefix-dialog\": \"/dialog\", \"prefix-location\": \"/location\" }, /** å­åº”ç”¨é‡‡ç”¨é™çº§iframeæ–¹æ¡ˆ */ degrade, ...lifecycles, }); setupApp({ name: \"vue3\", url: hostMap(\"//localhost:7300/\"), attrs, exec: true, alive: true, // å­åº”ç”¨ä¿æ´»ï¼Œstateä¸ä¼šä¸¢å¤± plugins: [{ cssExcludes: [\"https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\"] }], // å¼•å…¥äº†çš„ç¬¬ä¸‰æ–¹æ ·å¼ä¸éœ€è¦æ·»åŠ credentials fetch: (url, options) =\u003e url.includes(hostMap(\"//localhost:7300/\")) ? credentialsFetch(url, options) : window.fetch(url, options), degrade, ...lifecycles, }); if (window.localStorage.getItem(\"preload\") !== \"false\") { preloadApp({ name: \"react16\", }); if (window.Proxy) { preloadApp({ name: \"vue3\", }); } } ReactDOM.render(\u003cApp /\u003e, document.getElementById(\"root\")); å¼•å…¥å­åº”ç”¨çš„åœ°æ–¹ç›´æ¥ä»¥ç»„ä»¶å¼çš„æ–¹å¼å¼•å…¥ï¼š\nimport React from \"react\"; import hostMap from \"../hostMap\"; import WujieReact from \"wujie-react\"; import { useNavigate, useLocation } from \"react-router-dom\"; export default function React16() { const navigation = useNavigate(); const location = useLocation(); const path = location.pathname.replace(\"/react16-sub\", \"\").replace(\"/react16\", \"\").replace(\"/\",\"\"); //// const react16Url = hostMap(\"//localhost:7600/\") + path; const props = { jump: (name) =\u003e { navigation(`/${name}`); }, }; return ( // å•ä¾‹æ¨¡å¼ï¼Œnameç›¸åŒåˆ™å¤ç”¨ä¸€ä¸ªæ— ç•Œå®ä¾‹ï¼Œæ”¹å˜urlåˆ™å­åº”ç”¨é‡æ–°æ¸²æŸ“å®ä¾‹åˆ°å¯¹åº”è·¯ç”± \u003cWujieReact width=\"100%\" height=\"100%\" name=\"react16\" url={react16Url} sync={!path} props={props} \u003e\u003c/WujieReact\u003e ); } ii.é¢„è§ˆ 2.æ¡†æ¶ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š\næ¥å…¥ç®€å•ï¼Œå¯ä»¥ä»¥ç»„ä»¶çš„æ–¹å¼å¼•å…¥å­åº”ç”¨ çº¯å‡€æ— æ±¡æŸ“ æ— ç•Œåˆ©ç”¨iframeå’Œwebcomponentæ¥æ­å»ºå¤©ç„¶çš„jséš”ç¦»æ²™ç®±å’Œcsséš”ç¦»æ²™ç®± åˆ©ç”¨iframeçš„historyå’Œä¸»åº”ç”¨çš„historyåœ¨åŒä¸€ä¸ªtop-level browsing contextæ¥æ­å»ºå¤©ç„¶çš„è·¯ç”±åŒæ­¥æœºåˆ¶ å‰¯ä½œç”¨å±€é™åœ¨æ²™ç®±å†…éƒ¨ï¼Œå­åº”ç”¨åˆ‡æ¢æ— éœ€ä»»ä½•æ¸…ç†å·¥ä½œï¼Œæ²¡æœ‰é¢å¤–çš„åˆ‡æ¢æˆæœ¬ æ”¯æŒvite esmoudleåŠ è½½ï¼Œç”±äºjsæ˜¯ç‹¬ç«‹åœ¨iframeä¸­åŠ è½½çš„ï¼Œæ‰€ä»¥æ”¯æŒesmoduleåŠ è½½ æ”¯æŒé¢„åŠ è½½ æ”¯æŒåº”ç”¨ä¿æ´»ï¼Œå­åº”ç”¨çŠ¶æ€ä¿ç•™ï¼Œç”±äºæ˜¯ç‹¬ç«‹åœ¨iframeä¸­çš„ï¼Œè€Œåˆ‡æ¢åº”ç”¨æ—¶ä¸ä¼šç§»é™¤iframeï¼Œæ‰€ä»¥å­åº”ç”¨çš„çŠ¶æ€ä¼šè¢«ä¿ç•™åœ¨åŸæ¥çš„iframeä¸­ï¼Œå½“ä¸»åº”ç”¨å†æ¬¡æ¸²æŸ“å­åº”ç”¨domæ—¶ï¼Œä¼šæ˜¾ç¤ºä¹‹å‰çš„çŠ¶æ€ã€‚ å¤šåº”ç”¨åŒæ—¶æ¿€æ´»åœ¨çº¿ ç¼ºç‚¹ï¼š\niframeæ²™ç®±çš„srcè®¾ç½®äº†ä¸»åº”ç”¨çš„hostï¼Œåˆå§‹åŒ–iframeçš„æ—¶å€™éœ€è¦ç­‰å¾…iframeçš„location.orignä»â€™about:blankâ€™åˆå§‹åŒ–ä¸ºä¸»åº”ç”¨çš„hostï¼Œè¿™ä¸ªé‡‡ç”¨çš„è®¡æ—¶å™¨å»ç­‰å¾…çš„ä¸æ˜¯å¾ˆä¼˜é›…ã€‚ æ¡†æ¶4: Micro App mirco-app æ˜¯äº¬ä¸œ2021å¹´å¼€æºçš„ä¸€æ¬¾å¾®å‰ç«¯æ¡†æ¶ã€‚å®ƒå€ŸåŠ©äº†æµè§ˆå™¨å¯¹ webComponent çš„æ”¯æŒï¼Œå®ç°äº†ä¸€å¥—å¾®å‰ç«¯æ–¹æ¡ˆä½“ç³»ã€‚å¹¶ä¸”ç”±äº Shadow Dom å¯¹ react è¿™ç±»åº“çš„å…¼å®¹æ€§è¾ƒå·®ï¼Œä¾¿è‡ªå·±å®ç°äº†ç±» Shadow Dom çš„æ•ˆæœã€‚ä¸ qiankun ç›¸æ¯”ï¼Œæ¥å…¥æ›´åŠ ç®€å•ã€‚æœ€æ–°çš„ç‰ˆæœ¬ä¹Ÿæ”¯æŒiframeå®ç°jséš”ç¦»ï¼Œç±»ä¼¼wujieã€‚æˆªè‡³ç›®å‰ï¼ˆ2024å¹´4æœˆï¼‰github star 5.2k\n1.å®ç°æ–¹æ¡ˆ é¦–å…ˆmicro-appå®ç°äº†ä¸€ä¸ªåŸºäºWebComponentçš„ç»„ä»¶ï¼Œå¹¶å®ç°äº†ç±»Shadow Dom çš„æ•ˆæœï¼Œå¼€å‘è€…åªéœ€è¦ç”¨æ¥åŠ è½½å­åº”ç”¨ï¼Œæ•´ä¸ªå¯¹å­åº”ç”¨çš„åŠ è½½ã€jséš”ç¦»ã€csséš”ç¦»çš„é€»è¾‘éƒ½å°è£…åœ¨äº†web componentç»„ä»¶ä¸­ï¼Œå…·ä½“æ¥è¯´ï¼š\nå½“è°ƒç”¨microApp.start()åï¼Œä¼šæ³¨å†Œä¸€ä¸ªåä¸ºmicro-app çš„è‡ªå®šä¹‰ webComponent æ ‡ç­¾ã€‚æˆ‘ä»¬å¯ä»¥ä» ä¸­æ‹¿åˆ°å­åº”ç”¨çš„çº¿ä¸Šå…¥å£åœ°å€ã€‚ ç»„ä»¶å†…éƒ¨ï¼Œå½“åŒ¹é…åˆ°è·¯ç”±åï¼Œè·Ÿqiankunä¸€æ ·åŠ è½½htmlï¼Œå¾—åˆ°htmlå­—ç¬¦ä¸²æ¨¡ç‰ˆ åˆ†æhtmlå­—ç¬¦ä¸²ï¼Œæå–å¤´å’Œï¼Œå¹¶æ›¿æ¢ä¸ºæ¡†æ¶è‡ªå®šä¹‰æ ‡ç­¾å’Œ åœ¨å†…ï¼Œä¼šå¯¹scriptæ ‡ç­¾å’Œlinkæ ‡ç­¾çš„å†…å®¹è¿›è¡ŒåŠ è½½å¹¶æ‰§è¡Œ å°†å’Œæ’å…¥åˆ°æ ‡ç­¾å†… å†…æä¾›äº†jsæ²™ç®±æ–¹æ³•ï¼ˆv1.0ä»¥å‰è·Ÿqiankunæ²™ç®±ä¸€æ ·ï¼‰ï¼ŒæŒ‚è½½åˆ°åï¼Œå†…éƒ¨ä¼šé€ä¸€å¯¹å†…çš„scriptæ ‡ç­¾çš„jsç»‘å®šä½œç”¨åŸŸï¼Œå®ç°jséš”ç¦»ã€‚ csséš”ç¦»æ–¹æ¡ˆ é»˜è®¤ä½¿ç”¨æ­£åˆ™å°†CSSå­—ç¬¦ä¸²åˆ‡å‰²æˆæœ€å°å•å…ƒï¼Œæ¯ä¸ªå•å…ƒåŒ…å«ä¸€æ®µCSSä¿¡æ¯ï¼Œå°†æ‰€æœ‰çš„ä¿¡æ¯æ•´ç†ç”ŸæˆCSSTreeï¼Œéå†CSSTreeçš„æ¯ä¸ªè§„åˆ™ï¼Œæ·»åŠ å‰ç¼€å®ç°æ ·å¼éš”ç¦»ã€‚\njséš”ç¦»æ–¹æ¡ˆ micro-appæœ‰ä¸¤ç§æ–¹å¼å®ç°jséš”ç¦»ï¼Œé»˜è®¤æ˜¯è·Ÿqiankunä¸€æ ·é‡‡ç”¨proxyæ²™ç®±çš„æ–¹å¼éš”ç¦»ï¼Œ åœ¨v1.0å‘å¸ƒåæ”¯æŒäº†åŸºäºåŸç”Ÿiframeçš„éš”ç¦»æ–¹å¼ã€‚\n2.Micro Appå®æˆ˜ i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶ import React from 'react'; import ReactDOM from 'react-dom'; import './index.css'; import Router from './router'; import microApp from '@micro-zoe/micro-app' microApp.start() ReactDOM.render( \u003cReact.StrictMode\u003e \u003cRouter /\u003e \u003c/React.StrictMode\u003e, document.getElementById('root') ); è°ƒç”¨å­åº”ç”¨\nexport function MyPage () { return ( \u003cdiv\u003e \u003ch1\u003eå­åº”ç”¨ğŸ‘‡\u003c/h1\u003e // nameï¼šåº”ç”¨åç§°, urlï¼šåº”ç”¨åœ°å€ \u003cmicro-app name='my-app' url='http://localhost:3000/'\u003e\u003c/micro-app\u003e \u003c/div\u003e ) } ii.é¢„è§ˆ 2.æ¡†æ¶ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹\næ¥å…¥ç®€å•ï¼Œç»„ä»¶å¼å¼•å…¥å­åº”ç”¨ å›¢é˜ŸæŒç»­æ›´æ–°ç»´æŠ¤ jséš”ç¦»ã€csséš”ç¦»ã€è·¯ç”±åŒæ­¥ æ”¯æŒå­åº”ç”¨ä¿æ´», éœ€è¦å¼€å¯keep-aliveæ¨¡å¼ æ”¯æŒfiberæ¨¡å¼ï¼Œæå‡ä¸»åº”ç”¨çš„æ¸²æŸ“æ€§èƒ½ã€‚ ç¼ºç‚¹\n1.0ä¹‹å‰ä¸æ”¯æŒviteï¼Œ1.0ä¹‹åæ”¯æŒäº† é»˜è®¤csséš”ç¦»æ–¹å¼ï¼Œä¸»åº”ç”¨çš„æ ·å¼è¿˜æ˜¯ä¼šæ±¡æŸ“åˆ°å­åº”ç”¨ã€‚ å­åº”ç”¨å’Œä¸»åº”ç”¨å¿…é¡»ç›¸åŒçš„è·¯ç”±æ¨¡å¼ï¼Œè¦ä¹ˆåŒæ—¶hashæ¨¡å¼ï¼Œè¦ä¹ˆåŒæ—¶historyæ¨¡å¼ ä¾èµ–äºCustomElementså’ŒProxyä¸¤ä¸ªè¾ƒæ–°çš„APIã€‚Proxyæš‚æ—¶æ²¡æœ‰åšå…¼å®¹ï¼Œæ‰€ä»¥å¯¹äºä¸æ”¯æŒProxyçš„æµè§ˆå™¨æ— æ³•è¿è¡Œmicro-appã€‚ å‚è€ƒ æ¢æ¢å„ä¸ªå¾®å‰ç«¯æ¡†æ¶ | å¥‡èˆç²¾é€‰ æœ€åï¼Œ å¸Œæœ›å¤§å®¶æ—©æ—¥å®ç°ï¼šæˆä¸ºç¼–ç¨‹é«˜æ‰‹çš„ä¼Ÿå¤§æ¢¦æƒ³ï¼ æ¬¢è¿äº¤æµ~\næœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ›œçµæ‰€æœ‰ï¼æœªç»å…è®¸ï¼Œä¸¥ç¦è½¬è½½ï¼å¯¹éæ³•è½¬è½½è€…, åŸä½œè€…ä¿ç•™é‡‡ç”¨æ³•å¾‹æ‰‹æ®µè¿½ç©¶çš„æƒåˆ©ï¼ è‹¥éœ€è½¬è½½ï¼Œè¯·è”ç³»å¾®ä¿¡å…¬ä¼—å·ï¼šè¿å…ˆç”Ÿæœ‰çŒ«ç—…ï¼Œå¯è·å–ä½œè€…è”ç³»æ–¹å¼ï¼\n","wordCount":"8826","inLanguage":"zh","datePublished":"2024-05-15T20:37:01+08:00","dateModified":"2024-05-15T20:37:01+08:00","author":[{"@type":"Person","name":"æ›œçµ"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://lianpf.github.io/posts/frontend-develop/microfrontend_framework_compare/"},"publisher":{"@type":"Organization","name":"æ›œçµï¼ˆSUNï¼‰Site","logo":{"@type":"ImageObject","url":"https://lianpf.github.io/img-common/favicon.png"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lianpf.github.io/ accesskey=h title="æ›œçµï¼ˆSUNï¼‰Site (Alt + H)"><img src=https://lianpf.github.io/img-common/avatar.jpeg alt=logo aria-label=logo height=35>æ›œçµï¼ˆSUNï¼‰Site</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lianpf.github.io/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://lianpf.github.io/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://lianpf.github.io/archives/ title="â±ï¸ å½’æ¡£"><span>â±ï¸ å½’æ¡£</span></a></li><li><a href=https://lianpf.github.io/tags title="ğŸ§© æ ‡ç­¾"><span>ğŸ§© æ ‡ç­¾</span></a></li><li><a href=https://lianpf.github.io/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://lianpf.github.io/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://lianpf.github.io/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://lianpf.github.io/posts/frontend-develop/>ğŸ‘¨ğŸ»â€ğŸ’» å‰ç«¯</a></div><h1 class=post-title>å¾®å‰ç«¯: qiankunã€wujieå’ŒMicro Appç­‰æ¡†æ¶å¯¹æ¯”</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2024-05-15
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>8826å­—
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>18åˆ†é’Ÿ
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>æ›œçµ
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://lianpf.github.io/tags/%E5%B7%A5%E5%85%B7/ style=color:var(--secondary)!important>å·¥å…·</a></span></span></span></span>
<span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script>
<script>let url=document.documentURI,dnsUrl="https://lianpf.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:null,region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e4%b8%80iframe-vs-%e5%be%ae%e5%89%8d%e7%ab%af%e6%9e%b6%e6%9e%84 aria-label="ä¸€ã€iframe vs å¾®å‰ç«¯æ¶æ„">ä¸€ã€iframe vs å¾®å‰ç«¯æ¶æ„</a><ul><li><a href=#1iframe aria-label=1.iframe>1.iframe</a></li><li><a href=#2%e5%be%ae%e5%89%8d%e7%ab%af%e6%9e%b6%e6%9e%84 aria-label=2.å¾®å‰ç«¯æ¶æ„>2.å¾®å‰ç«¯æ¶æ„</a></li></ul></li><li><a href=#%e4%ba%8c%e5%be%ae%e5%89%8d%e7%ab%af%e6%9e%b6%e6%9e%84 aria-label=äºŒã€å¾®å‰ç«¯æ¶æ„>äºŒã€å¾®å‰ç«¯æ¶æ„</a><ul><li><a href=#%e6%a1%86%e6%9e%b61-single-spa aria-label="æ¡†æ¶1: single-spa">æ¡†æ¶1: single-spa</a><ul><li><a href=#1%e5%ae%9e%e7%8e%b0%e6%96%b9%e6%a1%88 aria-label=1.å®ç°æ–¹æ¡ˆ>1.å®ç°æ–¹æ¡ˆ</a></li><li><a href=#2single-spa%e5%ae%9e%e6%88%98 aria-label=2.single-spaå®æˆ˜>2.single-spaå®æˆ˜</a><ul><li><a href=#i%e4%b8%bb%e5%ba%94%e7%94%a8%e5%85%a5%e5%8f%a3%e6%96%87%e4%bb%b6 aria-label=i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶>i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶</a></li><li><a href=#ii%e5%ad%90%e5%ba%94%e7%94%a8%e5%af%bc%e5%87%ba%e6%96%87%e4%bb%b6 aria-label=ii.å­åº”ç”¨å¯¼å‡ºæ–‡ä»¶>ii.å­åº”ç”¨å¯¼å‡ºæ–‡ä»¶</a></li><li><a href=#iii%e6%89%93%e5%8c%85%e9%85%8d%e7%bd%ae aria-label=iii.æ‰“åŒ…é…ç½®>iii.æ‰“åŒ…é…ç½®</a></li><li><a href=#iv%e9%a2%84%e8%a7%88 aria-label=iv.é¢„è§ˆ>iv.é¢„è§ˆ</a></li></ul></li><li><a href=#3%e6%a1%86%e6%9e%b6%e4%bc%98%e7%bc%ba%e7%82%b9 aria-label=3.æ¡†æ¶ä¼˜ç¼ºç‚¹>3.æ¡†æ¶ä¼˜ç¼ºç‚¹</a></li></ul></li><li><a href=#%e6%a1%86%e6%9e%b62-qiankun aria-label="æ¡†æ¶2: qiankun">æ¡†æ¶2: qiankun</a><ul><li><a href=#1%e5%ae%9e%e7%8e%b0%e6%96%b9%e6%a1%88-1 aria-label=1.å®ç°æ–¹æ¡ˆ>1.å®ç°æ–¹æ¡ˆ</a></li><li><a href=#2qiankun%e5%ae%9e%e6%88%98 aria-label=2.qiankunå®æˆ˜>2.qiankunå®æˆ˜</a><ul><li><a href=#i%e4%b8%bb%e5%ba%94%e7%94%a8%e5%85%a5%e5%8f%a3%e6%96%87%e4%bb%b6-1 aria-label=i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶>i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶</a></li><li><a href=#ii%e5%ad%90%e5%ba%94%e7%94%a8%e5%af%bc%e5%87%ba%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e9%92%a9%e5%ad%90 aria-label=ii.å­åº”ç”¨å¯¼å‡ºç”Ÿå‘½å‘¨æœŸé’©å­>ii.å­åº”ç”¨å¯¼å‡ºç”Ÿå‘½å‘¨æœŸé’©å­</a></li><li><a href=#iii-%e9%85%8d%e7%bd%ae%e6%89%93%e5%8c%85%e5%b7%a5%e5%85%b7 aria-label="iii. é…ç½®æ‰“åŒ…å·¥å…·">iii. é…ç½®æ‰“åŒ…å·¥å…·</a></li><li><a href=#iv%e9%a2%84%e8%a7%88-1 aria-label=iv.é¢„è§ˆ>iv.é¢„è§ˆ</a></li></ul></li><li><a href=#3%e6%a1%86%e6%9e%b6%e4%bc%98%e7%bc%ba%e7%82%b9-1 aria-label=3.æ¡†æ¶ä¼˜ç¼ºç‚¹>3.æ¡†æ¶ä¼˜ç¼ºç‚¹</a></li></ul></li><li><a href=#%e6%a1%86%e6%9e%b63-wujie aria-label="æ¡†æ¶3: wujie">æ¡†æ¶3: wujie</a><ul><li><a href=#1%e5%ae%9e%e7%8e%b0%e6%96%b9%e6%a1%88-2 aria-label=1.å®ç°æ–¹æ¡ˆ>1.å®ç°æ–¹æ¡ˆ</a></li><li><a href=#2wujie%e5%ae%9e%e6%88%98 aria-label=2.wujieå®æˆ˜>2.wujieå®æˆ˜</a><ul><li><a href=#i%e4%b8%bb%e5%ba%94%e7%94%a8%e5%85%a5%e5%8f%a3%e6%96%87%e4%bb%b6-2 aria-label=i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶>i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶</a></li><li><a href=#ii%e9%a2%84%e8%a7%88 aria-label=ii.é¢„è§ˆ>ii.é¢„è§ˆ</a></li></ul></li><li><a href=#2%e6%a1%86%e6%9e%b6%e4%bc%98%e7%bc%ba%e7%82%b9 aria-label=2.æ¡†æ¶ä¼˜ç¼ºç‚¹>2.æ¡†æ¶ä¼˜ç¼ºç‚¹</a></li></ul></li><li><a href=#%e6%a1%86%e6%9e%b64-micro-app aria-label="æ¡†æ¶4: Micro App">æ¡†æ¶4: Micro App</a><ul><li><a href=#1%e5%ae%9e%e7%8e%b0%e6%96%b9%e6%a1%88-3 aria-label=1.å®ç°æ–¹æ¡ˆ>1.å®ç°æ–¹æ¡ˆ</a></li><li><a href=#2micro-app%e5%ae%9e%e6%88%98 aria-label="2.Micro Appå®æˆ˜">2.Micro Appå®æˆ˜</a><ul><li><a href=#i%e4%b8%bb%e5%ba%94%e7%94%a8%e5%85%a5%e5%8f%a3%e6%96%87%e4%bb%b6-3 aria-label=i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶>i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶</a></li><li><a href=#ii%e9%a2%84%e8%a7%88-1 aria-label=ii.é¢„è§ˆ>ii.é¢„è§ˆ</a></li></ul></li><li><a href=#2%e6%a1%86%e6%9e%b6%e4%bc%98%e7%bc%ba%e7%82%b9-1 aria-label=2.æ¡†æ¶ä¼˜ç¼ºç‚¹>2.æ¡†æ¶ä¼˜ç¼ºç‚¹</a></li></ul></li></ul></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=å‚è€ƒ>å‚è€ƒ</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>ç³»åˆ—æ–‡ç« ï¼š</p><ul><li>ç¬¬ä¸€ç¯‡ï¼š<a href=/posts/frontend-develop/microfrontend_framework_compare/>å¾®å‰ç«¯: qiankunã€wujieå’ŒMicro Appç­‰æ¡†æ¶å¯¹æ¯”</a></li></ul><p>å¾®å‰ç«¯æ¶æ„ä¸»è¦è§£å†³å•ä½“åº”ç”¨ï¼ˆå¸¸è§äºä¼ä¸šçº§ Web åº”ç”¨ï¼‰åœ¨ä¸€ä¸ªç›¸å¯¹é•¿çš„æ—¶é—´è·¨åº¦ä¸‹ï¼Œç”±äºå‚ä¸çš„äººå‘˜ã€å›¢é˜Ÿçš„å¢å¤šã€å˜è¿ï¼Œä»ä¸€ä¸ªæ™®é€šåº”ç”¨æ¼”å˜æˆä¸€ä¸ª <strong><font color=Tomato>å·¨çŸ³åº”ç”¨(Frontend Monolith)</font></strong> åï¼Œåº”ç”¨ä¸å¯ç»´æŠ¤çš„é—®é¢˜ã€‚</p><p>åœ¨å„å¤§å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆå‡ºç°å‰ï¼Œé€šå¸¸ç”¨<code>iframe</code>è§£å†³è¿™ç±»é—®é¢˜ã€‚æœ¬æ–‡é¦–å…ˆä»<code>iframe</code>å’Œ<code>å¾®å‰ç«¯æ¶æ„</code>çš„è§†è§’ï¼Œå»å¯¹æ¯”ä¸‹åŸç†ã€‚å…¶æ¬¡ï¼Œå¯¹æ¯”ç°æœ‰çš„å„å¤§å¾®å‰ç«¯æ¡†æ¶</p><hr><h2 id=ä¸€iframe-vs-å¾®å‰ç«¯æ¶æ„>ä¸€ã€iframe vs å¾®å‰ç«¯æ¶æ„<a hidden class=anchor aria-hidden=true href=#ä¸€iframe-vs-å¾®å‰ç«¯æ¶æ„>#</a></h2><h3 id=1iframe>1.iframe<a hidden class=anchor aria-hidden=true href=#1iframe>#</a></h3><p><strong><font color=Tomato><code>iframe</code>æä¾›äº†æµè§ˆå™¨åŸç”Ÿçš„ç¡¬éš”ç¦»æ–¹æ¡ˆ</font></strong> ï¼Œä¸è®ºæ˜¯ã€å·¨çŸ³åº”ç”¨ã€‘çš„æ ·å¼éš”ç¦»ã€jséš”ç¦»é—®é¢˜éƒ½èƒ½è¢«å®Œç¾è§£å†³ã€‚<br>ä½†æœ€å¤§é—®é¢˜ä¹Ÿåœ¨äº<code>iframe</code>çš„éš”ç¦»æ€§æ— æ³•è¢«çªç ´ï¼Œå¯¼è‡´<strong>åº”ç”¨é—´ä¸Šä¸‹æ–‡æ— æ³•è¢«å…±äº«</strong>ï¼Œå¸¦æ¥å¼€å‘å’Œäº§å“ä½“éªŒçš„é—®é¢˜ï¼š</p><ol><li><code>url</code>ä¸åŒæ­¥: æµè§ˆå™¨åˆ·æ–°<code>iframe url</code>çŠ¶æ€ä¸¢å¤±ã€åé€€å‰è¿›æŒ‰é’®æ— æ³•ä½¿ç”¨</li><li><code>UI</code>ä¸åŒæ­¥: <code>DOM</code>ç»“æ„ä¸å…±äº«ï¼Œå¼¹çª—åªèƒ½åœ¨<code>iframe</code>å†…éƒ¨å±•ç¤ºï¼Œæ— æ³•è¦†ç›–å…¨å±€</li><li>éš”ç¦»é—®é¢˜: å…¨å±€ä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»ï¼Œå†…å­˜å˜é‡ä¸å…±äº«ï¼Œiframeå†…å¤–ç³»ç»Ÿçš„é€šä¿¡ã€æ•°æ®åŒæ­¥ç­‰éœ€æ±‚ï¼Œä¸»åº”ç”¨çš„<code>cookie</code>è¦é€ä¼ åˆ°æ ¹åŸŸåéƒ½ä¸åŒçš„å­åº”ç”¨ä¸­å®ç°å…ç™»æ•ˆæœ</li><li>æ…¢: æ¯æ¬¡å­åº”ç”¨è¿›å…¥éƒ½æ˜¯ä¸€æ¬¡æµè§ˆå™¨ä¸Šä¸‹æ–‡é‡å»ºã€èµ„æºé‡æ–°åŠ è½½çš„è¿‡ç¨‹</li></ol><h3 id=2å¾®å‰ç«¯æ¶æ„>2.å¾®å‰ç«¯æ¶æ„<a hidden class=anchor aria-hidden=true href=#2å¾®å‰ç«¯æ¶æ„>#</a></h3><p>å¾®å‰ç«¯æ¡†æ¶å†…çš„å„ä¸ªåº”ç”¨éƒ½æ”¯æŒç‹¬ç«‹å¼€å‘éƒ¨ç½²ã€ä¸é™æŠ€æœ¯æ¡†æ¶ã€æ”¯æŒç‹¬ç«‹è¿è¡Œã€åº”ç”¨çŠ¶æ€éš”ç¦»ä½†ä¹Ÿå¯å…±äº«ç­‰ç‰¹å¾ã€‚</p><hr><h2 id=äºŒå¾®å‰ç«¯æ¶æ„>äºŒã€å¾®å‰ç«¯æ¶æ„<a hidden class=anchor aria-hidden=true href=#äºŒå¾®å‰ç«¯æ¶æ„>#</a></h2><h3 id=æ¡†æ¶1-single-spa>æ¡†æ¶1: single-spa<a hidden class=anchor aria-hidden=true href=#æ¡†æ¶1-single-spa>#</a></h3><p><a href=https://github.com/single-spa/single-spa>single-spa</a>æ˜¯æœ€æ—©çš„å¾®å‰ç«¯æ¡†æ¶ï¼Œå…¼å®¹å¤šç§å‰ç«¯æŠ€æœ¯æ ˆï¼Œæ”¯æŒå°†å¤šä¸ªå•é¡µé¢åº”ç”¨èšåˆä¸ºä¸€ä¸ªæ•´ä½“åº”ç”¨çš„ã€‚</p><blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯ã€èšåˆã€‘ï¼Œè¯¥åº“å¯è®©ä½ çš„åº”ç”¨ä½¿ç”¨å¤šä¸ªä¸åŒçš„æŠ€æœ¯æ ˆï¼ˆvueã€reactã€angularç­‰)è¿›è¡ŒåŒæ­¥å¼€å‘ï¼Œæœ€åä½¿ç”¨ä¸€ä¸ªå…¬ç”¨çš„è·¯ç”±å»å®ç°å®Œç¾çš„åˆ‡æ¢</p></blockquote><h4 id=1å®ç°æ–¹æ¡ˆ>1.å®ç°æ–¹æ¡ˆ<a hidden class=anchor aria-hidden=true href=#1å®ç°æ–¹æ¡ˆ>#</a></h4><p><code>single-spa</code>å®ç°äº†ä¸€å¥— <strong>ã€ç”Ÿå‘½å‘¨æœŸã€‘</strong>ï¼Œå¼€å‘è€…éœ€åœ¨ç›¸åº”çš„æ—¶æœºè‡ªå·±å»åŠ è½½å¯¹åº”çš„å­åº”ç”¨ã€‚å®ƒåšçš„äº‹æƒ…å°±æ˜¯ï¼šæ³¨å†Œå­åº”ç”¨ã€ç›‘å¬URLå˜åŒ–ï¼Œç„¶ååŠ è½½å¯¹åº”çš„å­åº”ç”¨jsï¼Œæ‰§è¡Œå¯¹åº”å­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸæµç¨‹ã€‚</p><ol><li>æä¾›<code>registerApplication</code>æ–¹æ³•ï¼Œç”¨æ¥æ³¨å†Œå­åº”ç”¨åˆ—è¡¨</li><li>æä¾›<code>activeWhen</code>ï¼Œç”±å¼€å‘è€…æŒ‡å®šè·¯ç”±æ»¡è¶³æ¡ä»¶æ—¶ï¼Œæ¿€æ´»ï¼ˆæŒ‚è½½ï¼‰å­åº”ç”¨çš„jsã€cssã€‚</li><li>jséš”ç¦»ç”±<code>single-spa-leaked-globals</code>å®ç°<br>æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ mount A å­åº”ç”¨æ—¶ï¼Œæ­£å¸¸æ·»åŠ å…¨å±€å˜é‡ï¼Œæ¯”å¦‚ jQuery çš„ $, lodash çš„ _ã€‚åœ¨ unmount A å­åº”ç”¨æ—¶ï¼Œç”¨ä¸€ä¸ªå¯¹è±¡è®°å½•ä¹‹å‰ç»™ window æ·»åŠ çš„å…¨å±€å˜é‡ï¼Œå¹¶æŠŠ A åº”ç”¨é‡Œæ·»åŠ  window çš„å˜é‡éƒ½åˆ æ‰ã€‚ä¸‹ä¸€æ¬¡å† mount A åº”ç”¨æ—¶ï¼ŒæŠŠè®°å½•çš„å…¨å±€å˜é‡é‡æ–°åŠ å›æ¥ã€‚</li><li>csséš”ç¦»ï¼š<ul><li>å­åº”ç”¨ä¹‹é—´é€šè¿‡<code>single-spa-css</code>æ’ä»¶æä¾›çš„cssç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œåšåˆ°å­åº”ç”¨mountæ—¶åŠ è½½cssï¼Œå­åº”ç”¨unmountæ—¶å°†css unmountæ‰</li><li>ä¸»åº”ç”¨ä¸å­åº”ç”¨ä¹‹é—´å¯é€šè¿‡<code>PostCSSPrefix Selector</code>ç»™æ ·å¼è‡ªåŠ¨åŠ å‰ç¼€çš„æ–¹å¼ï¼Œæˆ–<code>Shadow DOM</code>çš„å½¢å¼å»è§£å†³ã€‚</li></ul></li></ol><h4 id=2single-spaå®æˆ˜>2.single-spaå®æˆ˜<a hidden class=anchor aria-hidden=true href=#2single-spaå®æˆ˜>#</a></h4><h5 id=iä¸»åº”ç”¨å…¥å£æ–‡ä»¶>i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#iä¸»åº”ç”¨å…¥å£æ–‡ä»¶>#</a></h5><p>ä¸»è¦é€šè¿‡<code>single-spa</code>æä¾›çš„<code>registerApplication</code>æ–¹æ³•æ³¨å†Œå­åº”ç”¨ï¼Œå­åº”ç”¨éœ€è¦æŒ‡å®šåŠ è½½å­åº”ç”¨çš„æ–¹æ³•ã€å’Œè·¯ç”±æ¡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Vue</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;vue&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>App</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./App.vue&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>router</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./router&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>registerApplication</span>, <span style=color:#a6e22e>start</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;single-spa&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Vue</span>.<span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>productionTip</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è¿œç¨‹åŠ è½½å­åº”ç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createScript</span>(<span style=color:#a6e22e>url</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>script</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;script&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>script</span>.<span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>script</span>.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>resolve</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>script</span>.<span style=color:#a6e22e>onerror</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>reject</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>firstScript</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByTagName</span>(<span style=color:#e6db74>&#39;script&#39;</span>)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>firstScript</span>.<span style=color:#a6e22e>parentNode</span>.<span style=color:#a6e22e>insertBefore</span>(<span style=color:#a6e22e>script</span>, <span style=color:#a6e22e>firstScript</span>)
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// åŠ è½½å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª promise
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>loadApp</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>globalVar</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// æ”¯æŒè¿œç¨‹åŠ è½½å­åº”ç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>createScript</span>(<span style=color:#a6e22e>url</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;/js/chunk-vendors.js&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>createScript</span>(<span style=color:#a6e22e>url</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;/js/app.js&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è¿™é‡Œçš„returnå¾ˆé‡è¦ï¼Œéœ€è¦ä»è¿™ä¸ªå…¨å±€å¯¹è±¡ä¸­æ‹¿åˆ°å­åº”ç”¨æš´éœ²å‡ºæ¥çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> window[<span style=color:#a6e22e>globalVar</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å­åº”ç”¨åˆ—è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>apps</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å­åº”ç”¨åç§°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app1&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å­åº”ç”¨åŠ è½½å‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªpromise
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>app</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>loadApp</span>(<span style=color:#e6db74>&#39;http://localhost:8081&#39;</span>, <span style=color:#e6db74>&#39;app1&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å½“è·¯ç”±æ»¡è¶³æ¡ä»¶æ—¶ï¼ˆè¿”å›trueï¼‰ï¼Œæ¿€æ´»ï¼ˆæŒ‚è½½ï¼‰å­åº”ç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>activeWhen</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>location</span> =&gt; <span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>pathname</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#39;/app1&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¼ é€’ç»™å­åº”ç”¨çš„å¯¹è±¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>customProps</span><span style=color:#f92672>:</span> {}
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>app</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>loadApp</span>(<span style=color:#e6db74>&#39;http://localhost:8082&#39;</span>, <span style=color:#e6db74>&#39;app2&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>activeWhen</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>location</span> =&gt; <span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>pathname</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#39;/app2&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>customProps</span><span style=color:#f92672>:</span> {}
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å­åº”ç”¨åç§°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app3&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å­åº”ç”¨åŠ è½½å‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªpromise
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>app</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>loadApp</span>(<span style=color:#e6db74>&#39;http://localhost:3000&#39;</span>, <span style=color:#e6db74>&#39;app3&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å½“è·¯ç”±æ»¡è¶³æ¡ä»¶æ—¶ï¼ˆè¿”å›trueï¼‰ï¼Œæ¿€æ´»ï¼ˆæŒ‚è½½ï¼‰å­åº”ç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>activeWhen</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>location</span> =&gt; <span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>pathname</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#39;/app3&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¼ é€’ç»™å­åº”ç”¨çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œè¯¥é…ç½®å‘Šè¯‰reactå­åº”ç”¨è‡ªå·±çš„å®¹å™¨å…ƒç´ æ˜¯ä»€ä¹ˆï¼Œè¿™å—å„¿å’Œvueå­åº”ç”¨çš„é›†æˆä¸ä¸€æ ·ï¼Œå®˜ç½‘å¹¶æ²¡æœ‰è¯´è¿™éƒ¨åˆ†ï¼Œæˆ–è€…æˆ‘æ²¡æ‰¾åˆ°ï¼Œæ˜¯é€šè¿‡çœ‹single-spa-reactæºç çŸ¥é“çš„
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>customProps</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>domElement</span><span style=color:#f92672>:</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;microApp&#39;</span>),
</span></span><span style=display:flex><span>      <span style=color:#75715e>// æ·»åŠ  name å±æ€§æ˜¯ä¸ºäº†å…¼å®¹è‡ªå·±å†™çš„lyn-single-spaï¼ŒåŸç”Ÿçš„ä¸éœ€è¦ï¼Œå½“ç„¶åŠ äº†ä¹Ÿä¸å½±å“
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app3&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ³¨å†Œå­åº”ç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>apps</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>--</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>registerApplication</span>(<span style=color:#a6e22e>apps</span>[<span style=color:#a6e22e>i</span>])
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Vue</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>router</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mounted</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>start</span>()
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>render</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>h</span> =&gt; <span style=color:#a6e22e>h</span>(<span style=color:#a6e22e>App</span>)
</span></span><span style=display:flex><span>}).<span style=color:#a6e22e>$mount</span>(<span style=color:#e6db74>&#39;#app&#39;</span>)
</span></span></code></pre></div><h5 id=iiå­åº”ç”¨å¯¼å‡ºæ–‡ä»¶>ii.å­åº”ç”¨å¯¼å‡ºæ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#iiå­åº”ç”¨å¯¼å‡ºæ–‡ä»¶>#</a></h5><ul><li>å­åº”ç”¨éœ€è¦å®‰è£…single-spa-reactæˆ–è€…single-spa-vueï¼Œ</li><li>å°†å­åº”ç”¨ä¼ é€’ç»™single-spa-reactï¼Œå¾—åˆ°å­åº”ç”¨è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸï¼Œ</li><li>å­åº”ç”¨å°†ç”Ÿå‘½å‘¨æœŸå¯¼å‡ºåˆ°å…¨å±€ï¼Œ</li><li>åœ¨ä¸»åº”ç”¨å¯ä»¥è·å–å­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ReactDOM</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-dom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#39;./index.css&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>BrowserRouter</span>, <span style=color:#a6e22e>Link</span>, <span style=color:#a6e22e>Route</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-router-dom&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>singleSpaReact</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;single-spa-react&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å­åº”ç”¨ç‹¬ç«‹è¿è¡Œ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>window.<span style=color:#a6e22e>singleSpaNavigate</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ReactDOM</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>rootComponent</span>(), document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;root&#39;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ç”Ÿå‘½å‘¨æœŸa
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>reactLifecycles</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>singleSpaReact</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>React</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ReactDOM</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rootComponent</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>errorBoundary</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>info</span>, <span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>This</span> <span style=color:#a6e22e>renders</span> <span style=color:#a6e22e>when</span> <span style=color:#a6e22e>a</span> <span style=color:#a6e22e>catastrophic</span> <span style=color:#a6e22e>error</span> <span style=color:#a6e22e>occurs</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è¿™é‡Œå’Œvueä¸ä¸€æ ·ï¼Œpropså¿…é¡»å‘ä¸‹ä¼ é€’
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bootstrap</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>props</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;app3 bootstrap&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>reactLifecycles</span>.<span style=color:#a6e22e>bootstrap</span>(<span style=color:#a6e22e>props</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mount</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>props</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;app3 mount&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>reactLifecycles</span>.<span style=color:#a6e22e>mount</span>(<span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>unmount</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>props</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;app3 unmount&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>reactLifecycles</span>.<span style=color:#a6e22e>unmount</span>(<span style=color:#a6e22e>props</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ ¹ç»„ä»¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>rootComponent</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>StrictMode</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>BrowserRouter</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Link</span> <span style=color:#a6e22e>to</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/app3&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Home</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Link&gt; |</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Link</span> <span style=color:#a6e22e>to</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/app3/about&#34;</span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>About</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Link&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Route</span> <span style=color:#a6e22e>exact</span> <span style=color:#a6e22e>path</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/app3&#34;</span> <span style=color:#a6e22e>component</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>Home</span>} <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Route</span> <span style=color:#a6e22e>exact</span> <span style=color:#a6e22e>path</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/app3/about&#34;</span> <span style=color:#a6e22e>component</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>About</span>} <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/BrowserRouter&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/React.StrictMode&gt;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// home ç»„ä»¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Home</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>h1</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>app3</span> <span style=color:#a6e22e>home</span> <span style=color:#a6e22e>page</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/h1&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// about ç»„ä»¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>About</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>h1</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>app3</span> <span style=color:#a6e22e>about</span> <span style=color:#a6e22e>page</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/h1&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=iiiæ‰“åŒ…é…ç½®>iii.æ‰“åŒ…é…ç½®<a hidden class=anchor aria-hidden=true href=#iiiæ‰“åŒ…é…ç½®>#</a></h5><p>å°†å­åº”ç”¨å¯¼å‡ºæ¨¡å¼è®¾ç½®ä¸ºumd</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>package</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./package.json&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// å‘Šè¯‰å­åº”ç”¨åœ¨è¿™ä¸ªåœ°å€åŠ è½½é™æ€èµ„æºï¼Œå¦åˆ™ä¼šå»åŸºåº§åº”ç”¨çš„åŸŸåä¸‹åŠ è½½
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>publicPath</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;//localhost:8082&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#75715e>// å¼€å‘æœåŠ¡å™¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>devServer</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>port</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>8082</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>configureWebpack</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯¼å‡ºumdæ ¼å¼çš„åŒ…ï¼Œåœ¨å…¨å±€å¯¹è±¡ä¸ŠæŒ‚è½½å±æ€§package.nameï¼ŒåŸºåº§åº”ç”¨éœ€è¦é€šè¿‡è¿™ä¸ªå…¨å±€å¯¹è±¡è·å–ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚å­åº”ç”¨å¯¼å‡ºçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>output</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// libraryçš„å€¼åœ¨æ‰€æœ‰å­åº”ç”¨ä¸­éœ€è¦å”¯ä¸€
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>library</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>package</span>.<span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>libraryTarget</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;umd&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=ivé¢„è§ˆ>iv.é¢„è§ˆ<a hidden class=anchor aria-hidden=true href=#ivé¢„è§ˆ>#</a></h5><img src=https://cdn.jsdelivr.net/gh/lianpf/image-bed@main/blog/2024/20240515-001.webp width=800><p>å¯ä»¥çœ‹åˆ°å®ƒæ˜¯åŠ¨æ€åŠ è½½çš„å­åº”ç”¨çš„jsï¼Œå¹¶æ‰§è¡Œjsï¼Œå°†å†…å®¹æ¸²æŸ“åˆ°äº†ä¸»åº”ç”¨çš„ç›’å­å†…ã€‚</p><h4 id=3æ¡†æ¶ä¼˜ç¼ºç‚¹>3.æ¡†æ¶ä¼˜ç¼ºç‚¹<a hidden class=anchor aria-hidden=true href=#3æ¡†æ¶ä¼˜ç¼ºç‚¹>#</a></h4><p>ä¼˜ç‚¹ï¼š</p><ul><li>æ•æ·æ€§ - ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ï¼Œå¾®åº”ç”¨ä»“åº“ç‹¬ç«‹ï¼Œå‰åç«¯å¯ç‹¬ç«‹å¼€å‘ï¼Œéƒ¨ç½²å®Œæˆåä¸»æ¡†æ¶è‡ªåŠ¨å®ŒæˆåŒæ­¥æ›´æ–°ï¼›</li><li>æŠ€æœ¯æ ˆæ— å…³ï¼Œä¸»æ¡†æ¶ä¸é™åˆ¶æ¥å…¥åº”ç”¨çš„æŠ€æœ¯æ ˆï¼Œå¾®åº”ç”¨å…·å¤‡å®Œå…¨è‡ªä¸»æƒï¼›</li><li>å¢é‡å‡çº§ï¼Œåœ¨é¢å¯¹å„ç§å¤æ‚åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å¾ˆéš¾å¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç³»ç»Ÿåšå…¨é‡çš„æŠ€æœ¯æ ˆå‡çº§æˆ–é‡æ„ï¼Œè€Œå¾®å‰ç«¯æ˜¯ä¸€ç§éå¸¸å¥½çš„å®æ–½æ¸è¿›å¼é‡æ„çš„æ‰‹æ®µå’Œç­–ç•¥</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>éœ€è¦è‡ªå·±å»åŠ è½½å­åº”ç”¨</li><li>ä¸æ”¯æŒJavascriptæ²™ç®±éš”ç¦»ï¼Œéœ€è¦è‡ªå·±å»ä½¿ç”¨single-spa-leaked-globalsä¹‹ç±»çš„åº“å»éš”ç¦»</li><li>ä¸æ”¯æŒcsséš”ç¦»ï¼Œéœ€è¦è‡ªå·±ä½¿ç”¨single-spa-cssåº“æˆ–è€…postcssç­‰å»è§£å†³æ ·å¼å†²çªé—®é¢˜</li><li>æ— æ³•é¢„åŠ è½½</li></ul><h3 id=æ¡†æ¶2-qiankun>æ¡†æ¶2: qiankun<a hidden class=anchor aria-hidden=true href=#æ¡†æ¶2-qiankun>#</a></h3><p>é˜¿é‡Œçš„<code>qiankun</code>æ˜¯åŸºäº<code>single-spa</code>çš„å¾®å‰ç«¯å®ç°åº“ï¼Œå­µåŒ–è‡ªèš‚èšï¼Œèƒ½æ›´ç®€å•ã€æ— ç—›çš„æ„å»ºä¸€ä¸ªç”Ÿäº§å¯ç”¨å¾®å‰ç«¯æ¶æ„ç³»ç»Ÿã€‚ç›®å‰(2024å¹´4æœˆ) github star 15.4kã€‚</p><h4 id=1å®ç°æ–¹æ¡ˆ-1>1.å®ç°æ–¹æ¡ˆ<a hidden class=anchor aria-hidden=true href=#1å®ç°æ–¹æ¡ˆ-1>#</a></h4><ul><li>single-spaæ˜¯åŸºäºjs-entryæ–¹æ¡ˆï¼Œè€Œqiankun æ˜¯åŸºäºhtml-entry åŠæ²™ç®±è®¾è®¡ï¼Œä½¿å¾—å¾®åº”ç”¨çš„æ¥å…¥ åƒä½¿ç”¨ iframe ä¸€æ ·ç®€å•ã€‚</li><li>ä¸»åº”ç”¨ç›‘å¬è·¯ç”±ï¼ŒåŠ è½½å¯¹åº”å­åº”ç”¨çš„htmlï¼ŒæŒ‚è½½åˆ°ä¸»åº”ç”¨çš„å…ƒç´ å†…ï¼Œç„¶åè§£æå­åº”ç”¨çš„htmlï¼Œä»ä¸­åˆ†æå‡ºcssã€jså†å»æ²™ç›’åŒ–ååŠ è½½æ‰§è¡Œï¼Œæœ€ç»ˆå°†å­åº”ç”¨çš„å†…å®¹æ¸²æŸ“å‡ºæ¥ã€‚</li><li>qiankunå®ç°æ ·å¼éš”ç¦»æœ‰ä¸¤ç§æ¨¡å¼å¯ä¾›å¼€å‘è€…é€‰æ‹©ï¼š<ul><li>strictStyleIsolationï¼š è¿™ç§æ¨¡å¼ä¸‹ qiankun ä¼šä¸ºæ¯ä¸ªå¾®åº”ç”¨çš„å®¹å™¨åŒ…è£¹ä¸Šä¸€ä¸ª shadow dom èŠ‚ç‚¹ï¼Œä»è€Œç¡®ä¿å¾®åº”ç”¨çš„æ ·å¼ä¸ä¼šå¯¹å…¨å±€é€ æˆå½±å“ã€‚</li><li>experimentalStyleIsolationï¼š å½“ experimentalStyleIsolation è¢«è®¾ç½®ä¸º true æ—¶ï¼Œqiankun ä¼šæ”¹å†™å­åº”ç”¨æ‰€æ·»åŠ çš„æ ·å¼ï¼Œä¼šä¸ºæ‰€æœ‰æ ·å¼è§„åˆ™å¢åŠ ä¸€ä¸ªç‰¹æ®Šçš„é€‰æ‹©å™¨è§„åˆ™ï¼Œæ¥é™å®šå…¶å½±å“èŒƒå›´</li></ul></li><li>qiankunå®ç°jséš”ç¦»ï¼Œé‡‡ç”¨äº†ä¸¤ç§æ²™ç®±ï¼Œåˆ†åˆ«ä¸ºåŸºäºProxyå®ç°çš„æ²™ç®±å’Œå¿«ç…§æ²™ç®±ï¼Œå½“æµè§ˆå™¨ä¸æ”¯æŒProxyä¼šé™çº§ä¸ºå¿«ç…§æ²™ç®±</li></ul><p><code>Proxyæ²™ç®±æœºåˆ¶</code>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// ä¼ªä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProxySandbox</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>rawWindow</span> <span style=color:#f92672>=</span> window;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fakeWindow</span> <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>proxy</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Proxy(<span style=color:#a6e22e>fakeWindow</span>, {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>target</span>, <span style=color:#a6e22e>p</span>, <span style=color:#a6e22e>value</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>target</span>[<span style=color:#a6e22e>p</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>target</span>, <span style=color:#a6e22e>p</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>target</span>[<span style=color:#a6e22e>p</span>] <span style=color:#f92672>||</span> <span style=color:#a6e22e>rawWindow</span>[<span style=color:#a6e22e>p</span>];
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>proxy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>proxy</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>sandbox1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ProxySandbox</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>sandbox2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ProxySandbox</span>();
</span></span><span style=display:flex><span>window.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// ä¼ªä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>((window) =&gt; {
</span></span><span style=display:flex><span>    window.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;hello&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(window.<span style=color:#a6e22e>a</span>) <span style=color:#75715e>// hello
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>})(<span style=color:#a6e22e>sandbox1</span>.<span style=color:#a6e22e>proxy</span>);
</span></span><span style=display:flex><span>((window) =&gt; {
</span></span><span style=display:flex><span>    window.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;world&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(window.<span style=color:#a6e22e>a</span>) <span style=color:#75715e>// world
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>})(<span style=color:#a6e22e>sandbox2</span>.<span style=color:#a6e22e>proxy</span>);
</span></span></code></pre></div><p><strong>å¿«ç…§æ²™ç®±</strong>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// ä¼ªä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SnapshotSandbox</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>proxy</span> <span style=color:#f92672>=</span> window; 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modifyPropsMap</span> <span style=color:#f92672>=</span> {}; <span style=color:#75715e>// ä¿®æ”¹äº†é‚£äº›å±æ€§
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>active</span>(); <span style=color:#75715e>// è°ƒç”¨activeä¿å­˜ä¸»åº”ç”¨windowå¿«ç…§
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**1. åˆå§‹åŒ–æ—¶ï¼Œåœ¨å­åº”ç”¨å³å°†mountå‰ï¼Œå…ˆè°ƒç”¨activeï¼Œä¿å­˜å½“å‰ä¸»åº”ç”¨çš„windowå¿«ç…§*/</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>active</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>windowSnapshot</span> <span style=color:#f92672>=</span> {}; <span style=color:#75715e>// windowå¯¹è±¡çš„å¿«ç…§
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>prop</span> <span style=color:#66d9ef>in</span> window) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (window.<span style=color:#a6e22e>hasOwnProperty</span>(<span style=color:#a6e22e>prop</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// å°†windowä¸Šçš„å±æ€§è¿›è¡Œæ‹ç…§
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>windowSnapshot</span>[<span style=color:#a6e22e>prop</span>] <span style=color:#f92672>=</span> window[<span style=color:#a6e22e>prop</span>];
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        Object.<span style=color:#a6e22e>keys</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modifyPropsMap</span>).<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>p</span> =&gt; {
</span></span><span style=display:flex><span>            window[<span style=color:#a6e22e>p</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modifyPropsMap</span>[<span style=color:#a6e22e>p</span>];
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * å­åº”ç”¨å¸è½½æ—¶ï¼Œéå†å½“å‰å­åº”ç”¨çš„windowå±æ€§ï¼Œå’Œä¸»åº”ç”¨çš„windowå¿«ç…§åšå¯¹æ¯”
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * å¦‚æœä¸ä¸€è‡´ï¼Œåšä¸¤æ­¥æ“ä½œ 
</span></span></span><span style=display:flex><span><span style=color:#75715e>    *     1. ä¿å­˜ ä¸ä¸€è‡´çš„windowå±æ€§ï¼Œ
</span></span></span><span style=display:flex><span><span style=color:#75715e>    *     2. è¿˜åŸwindow
</span></span></span><span style=display:flex><span><span style=color:#75715e>    */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>inactive</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>prop</span> <span style=color:#66d9ef>in</span> window) { <span style=color:#75715e>// diff å·®å¼‚
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (window.<span style=color:#a6e22e>hasOwnProperty</span>(<span style=color:#a6e22e>prop</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// å°†ä¸Šæ¬¡æ‹ç…§çš„ç»“æœå’Œæœ¬æ¬¡windowå±æ€§åšå¯¹æ¯”
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> (window[<span style=color:#a6e22e>prop</span>] <span style=color:#f92672>!==</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>windowSnapshot</span>[<span style=color:#a6e22e>prop</span>]) {
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// ä¿å­˜ä¿®æ”¹åçš„ç»“æœ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modifyPropsMap</span>[<span style=color:#a6e22e>prop</span>] <span style=color:#f92672>=</span> window[<span style=color:#a6e22e>prop</span>]; 
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// è¿˜åŸwindow
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    window[<span style=color:#a6e22e>prop</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>windowSnapshot</span>[<span style=color:#a6e22e>prop</span>]; 
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=2qiankunå®æˆ˜>2.qiankunå®æˆ˜<a hidden class=anchor aria-hidden=true href=#2qiankunå®æˆ˜>#</a></h4><h5 id=iä¸»åº”ç”¨å…¥å£æ–‡ä»¶-1>i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#iä¸»åº”ç”¨å…¥å£æ–‡ä»¶-1>#</a></h5><p><strong>åˆå§‹åŒ–ä¸»åº”ç”¨ï¼Œå¹¶æ³¨å†Œå­åº”ç”¨</strong><br>ä¸»åº”ç”¨å…¥å£æ–‡ä»¶åˆå§‹åŒ–åº”ç”¨ï¼Œæ³¨å†Œå­åº”ç”¨ï¼Œæ³¨å†Œå­åº”ç”¨æ—¶æ”¯æŒä¼ å…¥å­åº”ç”¨åˆ—è¡¨ï¼Œ æ³¨å†Œå­åº”ç”¨æ—¶éœ€è¦æŒ‡æ˜ä»¥ä¸‹å‡ ä¸ªä¸»è¦å‚æ•°ï¼š</p><ul><li>nameï¼š å¾®åº”ç”¨çš„åç§°ï¼Œå¾®åº”ç”¨ä¹‹é—´å¿…é¡»ç¡®ä¿å”¯ä¸€</li><li>entryï¼š å­åº”ç”¨çš„è®¿é—®é“¾æ¥ã€‚ä¸»åº”ç”¨ä¼šåŠ è½½æ•´ä¸ªé¡µé¢ï¼Œä¾‹å¦‚https://qiankun.umijs.org/guide/</li><li>containerï¼šéœ€è¦æŒ‚è½½å­åº”ç”¨çš„DOMå…ƒç´ </li><li>loader: å­åº”ç”¨æœªåŠ è½½æ—¶çš„ç•Œé¢ï¼Œä¸€èˆ¬ä¸ºloading</li><li>activeRuleï¼š è·¯ç”±åŒ¹é…è§„åˆ™</li></ul><p><strong>å¼€å¯å­åº”ç”¨start(options)</strong><br></p><ul><li><code>options.prefetch</code>æ­¤æ—¶å¯ä»¥é€‰æ‹©æ˜¯å¦é¢„åŠ è½½å­åº”ç”¨ã€‚</li><li><code>options.sandbox</code>é»˜è®¤æƒ…å†µä¸‹çš„æ²™ç®±å¯ç¡®ä¿ã€å•å®ä¾‹åœºæ™¯å­åº”ç”¨ä¹‹é—´ã€‘çš„æ ·å¼éš”ç¦»ï¼Œä½†æ— æ³•ç¡®ä¿ä¸»åº”ç”¨å’Œå­åº”ç”¨ã€æˆ–è€…å¤šå®ä¾‹åœºæ™¯çš„å­åº”ç”¨æ ·å¼éš”ç¦»ã€‚qiankunæä¾›äº†å¦å¤–ä¸¤ç§æ–¹å¼çš„éš”ç¦»ï¼Œä¾›å¼€å‘è€…é€‰æ‹©ï¼š<ul><li><code>strictStyleIsolation</code>ï¼šå½“é…ç½®ä¸º<code>{ strictStyleIsolation: true }</code>æ—¶è¡¨ç¤ºå¼€å¯ä¸¥æ ¼çš„æ ·å¼éš”ç¦»æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹<code>qiankun</code>ä¼šä¸ºæ¯ä¸ªå¾®åº”ç”¨çš„å®¹å™¨åŒ…è£¹ä¸Šä¸€ä¸ª<code>shadow dom</code>èŠ‚ç‚¹ï¼Œä»è€Œç¡®ä¿å¾®åº”ç”¨çš„æ ·å¼ä¸ä¼šå¯¹å…¨å±€é€ æˆå½±å“</li><li><code>experimentalStyleIsolation</code>ï¼šå½“<code>{experimentalStyleIsolation: true}</code>è¢«è®¾ç½®ï¼Œqiankunä¼šæ”¹å†™å­åº”ç”¨æ‰€æ·»åŠ çš„æ ·å¼ä¸ºæ‰€æœ‰æ ·å¼è§„åˆ™å¢åŠ ä¸€ä¸ªç‰¹æ®Šçš„é€‰æ‹©å™¨è§„åˆ™æ¥é™å®šå…¶å½±å“èŒƒå›´</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>registerMicroApps</span>, <span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>initGlobalState</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;qiankun&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>registerMicroApps</span>([
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;react app&#39;</span>, <span style=color:#75715e>// app name registered
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>entry</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;//localhost:7100&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>container</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;#yourContainer&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>activeRule</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/yourActiveRule&#39;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;vue app&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entry</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>scripts</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;//localhost:7100/main.js&#39;</span>] },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>container</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;#yourContainer2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>activeRule</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/yourActiveRule2&#39;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// é€šè®¯
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>onGlobalStateChange</span>, <span style=color:#a6e22e>setGlobalState</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>initGlobalState</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>user</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;qiankun&#39;</span>,
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>onGlobalStateChange</span>((<span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>prev</span>) =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;[onGlobalStateChange - master]:&#39;</span>, <span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>prev</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>setGlobalState</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ignore</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;master&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>user</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;master&#39;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * è®¾ç½®é»˜è®¤è¿›å…¥çš„å­åº”ç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>setDefaultMountApp</span>(<span style=color:#e6db74>&#39;/react16&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * å¯åŠ¨åº”ç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>start</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>prefetch</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>, <span style=color:#75715e>// é¢„åŠ è½½å­åº”ç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>sandbox</span><span style=color:#f92672>:</span>{
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>strictStyleIsolation</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>, <span style=color:#75715e>//  shadow domçš„æ–¹å¼å®ç°æ ·å¼éš”ç¦»
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// experimentalStyleIsolation: true, //æ·»åŠ ç‰¹æ®Šçš„é€‰æ‹©å™¨çš„æ–¹å¼å®ç°æ ·å¼éš”ç¦»
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>runAfterFirstMounted</span>(() =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;[MainApp] first app mounted&#39;</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h5 id=iiå­åº”ç”¨å¯¼å‡ºç”Ÿå‘½å‘¨æœŸé’©å­>ii.å­åº”ç”¨å¯¼å‡ºç”Ÿå‘½å‘¨æœŸé’©å­<a hidden class=anchor aria-hidden=true href=#iiå­åº”ç”¨å¯¼å‡ºç”Ÿå‘½å‘¨æœŸé’©å­>#</a></h5><p>å­åº”ç”¨éœ€åœ¨è‡ªå·±çš„å…¥å£ jså¯¼å‡º<code>bootstrap</code>ã€<code>mount</code>ã€<code>unmount</code>ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä»¥ä¾›ä¸»åº”ç”¨åœ¨é€‚å½“çš„æ—¶æœºè°ƒç”¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ReactDOM</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-dom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>App</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./App&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>serviceWorker</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./serviceWorker&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>container</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>props</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ReactDOM</span>.<span style=color:#a6e22e>render</span>(&lt;<span style=color:#f92672>App</span> /&gt;, <span style=color:#a6e22e>container</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#root&#39;</span>) <span style=color:#f92672>:</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#root&#39;</span>));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>* å’Œä¸»åº”ç”¨é€šè®¯
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>storeTest</span>(<span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>onGlobalStateChange</span>((<span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>prev</span>) =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`[onGlobalStateChange - </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>]:`</span>, <span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>prev</span>), <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>setGlobalState</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ignore</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>user</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>window.<span style=color:#a6e22e>__POWERED_BY_QIANKUN__</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>render</span>({});
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * bootstrap åªä¼šåœ¨å¾®åº”ç”¨åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ï¼Œä¸‹æ¬¡å¾®åº”ç”¨é‡æ–°è¿›å…¥æ—¶ä¼šç›´æ¥è°ƒç”¨ mount é’©å­ï¼Œä¸ä¼šå†é‡å¤è§¦å‘ bootstrapã€‚
</span></span></span><span style=display:flex><span><span style=color:#75715e> * é€šå¸¸æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›å…¨å±€å˜é‡çš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚ä¸ä¼šåœ¨ unmount é˜¶æ®µè¢«é”€æ¯çš„åº”ç”¨çº§åˆ«çš„ç¼“å­˜ç­‰ã€‚
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>bootstrap</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;[react16] react app bootstraped&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * åº”ç”¨æ¯æ¬¡è¿›å…¥éƒ½ä¼šè°ƒç”¨ mount æ–¹æ³•ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨è¿™é‡Œè§¦å‘åº”ç”¨çš„æ¸²æŸ“æ–¹æ³•
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>mount</span>(<span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;[react16] props from main framework&#39;</span>, <span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>storeTest</span>(<span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * åº”ç”¨æ¯æ¬¡ åˆ‡å‡º/å¸è½½ ä¼šè°ƒç”¨çš„æ–¹æ³•ï¼Œé€šå¸¸åœ¨è¿™é‡Œæˆ‘ä»¬ä¼šå¸è½½å¾®åº”ç”¨çš„åº”ç”¨å®ä¾‹
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>unmount</span>(<span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>container</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>props</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ReactDOM</span>.<span style=color:#a6e22e>unmountComponentAtNode</span>(<span style=color:#a6e22e>container</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#root&#39;</span>) <span style=color:#f92672>:</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#root&#39;</span>));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=iii-é…ç½®æ‰“åŒ…å·¥å…·>iii. é…ç½®æ‰“åŒ…å·¥å…·<a hidden class=anchor aria-hidden=true href=#iii-é…ç½®æ‰“åŒ…å·¥å…·>#</a></h5><p>ä¸ºäº†è®©ä¸»åº”ç”¨èƒ½æ­£ç¡®è¯†åˆ«å¾®åº”ç”¨æš´éœ²å‡ºæ¥çš„ä¸€äº›å…¨å±€ä¿¡æ¯å’Œå¼€å‘ç¯å¢ƒä¸‹çš„è·¨åŸŸå…¼å®¹ï¼Œåœ¨å­åº”ç”¨ï¼ˆä»¥create-react-appå‡ºæ¥çš„reacté¡¹ç›®ä¸ºä¾‹ï¼‰å®‰è£…<code>@rescripts/cli</code>ï¼Œå¹¶åœ¨å­åº”ç”¨ç›®å½•ä¸‹æ–°å»º<code>.rescriptsrc.js</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>name</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./package&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>webpack</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>config</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>library</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-[name]`</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>libraryTarget</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;umd&#39;</span>; <span style=color:#75715e>// ä¸ºäº†èƒ½é€šè¿‡window[&#39;app-name1&#39;]æ‹¿åˆ°å­åº”ç”¨å£°æ˜çš„ç”Ÿå‘½å‘¨æœŸ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// webpack 5 éœ€è¦æŠŠ jsonpFunction æ›¿æ¢æˆ chunkLoadingGlobal
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>jsonpFunction</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`webpackJsonp_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>; 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>globalObject</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;window&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>config</span>;
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>devServer</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>_</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>headers</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Access-Control-Allow-Origin&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;*&#39;</span>,
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>historyApiFallback</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>hot</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>watchContentBase</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>liveReload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>config</span>;
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h5 id=ivé¢„è§ˆ-1>iv.é¢„è§ˆ<a hidden class=anchor aria-hidden=true href=#ivé¢„è§ˆ-1>#</a></h5><p>ä½¿ç”¨<code>strictStyleIsolationï¼štrue</code>æ–¹å¼è¿›è¡Œæ ·å¼éš”ç¦»ï¼Œä¼šç”Ÿæˆä¸€ä¸ª<code>shadow dom</code>ï¼Œè¿›è¡Œæ ·å¼çš„å®Œå…¨éš”ç¦»ï¼š</p><img src=https://cdn.jsdelivr.net/gh/lianpf/image-bed@main/blog/2024/20240515-002.webp width=800><p>ä½¿ç”¨<code>experimentalStyleIsolationï¼štrue</code>çš„æ–¹å¼è¿›è¡Œæ ·å¼éš”ç¦»ï¼Œä¼šåœ¨cssé€‰æ‹©å™¨å‰æ·»åŠ ç‰¹æ®Šæ ‡è¯†ï¼š
<img src=https://cdn.jsdelivr.net/gh/lianpf/image-bed@main/blog/2024/20240515-003.webp width=800></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>qiankun</code>ä¼šå°†å­åº”ç”¨çš„htmlæ¸²æŸ“åˆ°è‡ªå®šä¹‰çš„containerä¸­ã€‚ ä¸»åº”ç”¨åŠ è½½çš„æ˜¯å­åº”ç”¨çš„htmlï¼Œåœ¨è§£æå­åº”ç”¨çš„htmlçš„è¿‡ç¨‹ä¸­é‡åˆ°jså’Œcssä¼šè½½æ¡†æ¶å†…è¿›è¡Œæ²™ç›’å¤„ç†ï¼Œå®Œæˆcsså’Œjsçš„éš”ç¦»ï¼Œä¹‹åä¸‹è½½å¹¶æ‰§è¡Œï¼Œå®Œæˆæ•´ä¸ªå­åº”ç”¨çš„æ¸²æŸ“è¿‡ç¨‹ã€‚</p><h4 id=3æ¡†æ¶ä¼˜ç¼ºç‚¹-1>3.æ¡†æ¶ä¼˜ç¼ºç‚¹<a hidden class=anchor aria-hidden=true href=#3æ¡†æ¶ä¼˜ç¼ºç‚¹-1>#</a></h4><p><strong>ä¼˜ç‚¹</strong></p><ul><li>html entryçš„æ¥å…¥æ–¹å¼ï¼Œä¸éœ€è¦è‡ªå·±å†™loadæ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥å†™å­åº”ç”¨çš„è®¿é—®é“¾æ¥å°±å¯ä»¥ã€‚</li><li>æä¾›jsæ²™ç®±</li><li>æä¾›æ ·å¼éš”ç¦»ï¼Œä¸¤ç§æ–¹å¼å¯é€‰</li><li>èµ„æºé¢„åŠ è½½ï¼Œåœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´é¢„åŠ è½½æœªæ‰“å¼€çš„å¾®åº”ç”¨èµ„æºï¼ŒåŠ é€Ÿå¾®åº”ç”¨æ‰“å¼€é€Ÿåº¦ã€‚</li><li>ç¤¾åŒºæ´»è·ƒ</li><li>umi æ’ä»¶ï¼Œæä¾›äº† @umijs/plugin-qiankun ä¾› umi åº”ç”¨ä¸€é”®åˆ‡æ¢æˆå¾®å‰ç«¯æ¶æ„ç³»ç»Ÿ é™¤äº†æœ€åä¸€ç‚¹æ‹“å±•ä»¥å¤–ï¼Œå¾®å‰ç«¯æƒ³è¦è¾¾åˆ°çš„æ•ˆæœéƒ½å·²ç»è¾¾åˆ°ã€‚</li><li>åº”ç”¨é—´é€šä¿¡ç®€å•ï¼Œå…¨å±€æ³¨å…¥è·¯ç”±ä¿æŒï¼Œæµè§ˆå™¨åˆ·æ–°ã€å‰è¿›ã€åé€€ï¼Œéƒ½å¯ä»¥ä½œç”¨åˆ°å­åº”ç”¨</li><li>è·¯ç”±ä¿æŒï¼Œæµè§ˆå™¨åˆ·æ–°ã€å‰è¿›ã€åé€€ï¼Œéƒ½å¯ä»¥ä½œç”¨åˆ°å­åº”ç”¨</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>æ”¹é€ æˆæœ¬è¾ƒå¤§ï¼Œä» webpackã€ä»£ç ã€è·¯ç”±ç­‰ç­‰éƒ½è¦åšä¸€ç³»åˆ—çš„é€‚é…</li><li>å¯¹ eval çš„äº‰è®®ï¼Œevalå‡½æ•°çš„å®‰å…¨å’Œæ€§èƒ½æ˜¯æœ‰ä¸€äº›äº‰è®®çš„ï¼šMDNçš„evalä»‹ç»ï¼›</li><li>æ— æ³•åŒæ—¶æ¿€æ´»å¤šä¸ªå­åº”ç”¨ï¼Œä¹Ÿä¸æ”¯æŒå­åº”ç”¨ä¿æ´»</li><li>æ— æ³•æ”¯æŒ vite ç­‰ ESM è„šæœ¬è¿è¡Œ</li></ul><h3 id=æ¡†æ¶3-wujie>æ¡†æ¶3: wujie<a hidden class=anchor aria-hidden=true href=#æ¡†æ¶3-wujie>#</a></h3><p>wujieæ˜¯è…¾è®¯å‡ºå“ã€‚åŸºäº webcomponent å®¹å™¨ + iframe æ²™ç®±ï¼Œèƒ½å¤Ÿå®Œå–„çš„è§£å†³é€‚é…æˆæœ¬ã€æ ·å¼éš”ç¦»ã€è¿è¡Œæ€§èƒ½ã€é¡µé¢ç™½å±ã€å­åº”ç”¨é€šä¿¡ã€å­åº”ç”¨ä¿æ´»ã€å¤šåº”ç”¨æ¿€æ´»ã€vite æ¡†æ¶æ”¯æŒã€åº”ç”¨å…±äº«ç­‰ã€‚ç›®å‰ï¼ˆ2024å¹´4æœˆï¼‰github star 3.7k</p><h4 id=1å®ç°æ–¹æ¡ˆ-2>1.å®ç°æ–¹æ¡ˆ<a hidden class=anchor aria-hidden=true href=#1å®ç°æ–¹æ¡ˆ-2>#</a></h4><ul><li>æ— ç•Œåˆ©ç”¨iframeå’Œwebcomponentæ¥æ­å»ºå¤©ç„¶çš„jséš”ç¦»æ²™ç®±å’Œcsséš”ç¦»æ²™ç®±,</li><li>åˆ©ç”¨iframeçš„historyå’Œä¸»åº”ç”¨çš„historyåœ¨åŒä¸€ä¸ªtop-level browsing contextæ¥æ­å»ºå¤©ç„¶çš„è·¯ç”±åŒæ­¥æœºåˆ¶</li><li>æ”¯æŒä»¥fiberçš„å½¢å¼æ‰§è¡Œjsï¼Œç”±äºå­åº”ç”¨çš„æ‰§è¡Œä¼šé˜»å¡ä¸»åº”ç”¨çš„æ¸²æŸ“çº¿ç¨‹ï¼Œå½“fiberè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆjsæ‰§è¡Œæ—¶é‡‡å–ç±»ä¼¼react fiberçš„æ¨¡å¼æ–¹å¼é—´æ–­æ‰§è¡Œï¼Œæ¯ä¸ª js æ–‡ä»¶çš„æ‰§è¡Œéƒ½åŒ…è£¹åœ¨requestidlecallbackä¸­ï¼Œæ¯æ‰§è¡Œä¸€ä¸ªjså¯ä»¥è¿”å›å“åº”å¤–éƒ¨çš„è¾“å…¥ï¼Œä½†æ˜¯è¿™ä¸ªé¢—ç²’åº¦æ˜¯jsæ–‡ä»¶ï¼Œå¦‚æœå­åº”ç”¨å•ä¸ªjsæ–‡ä»¶è¿‡å¤§ï¼Œå¯ä»¥é€šè¿‡æ‹†åŒ…çš„æ–¹å¼é™ä½è¾¾åˆ°fiberæ¨¡å¼æ•ˆç›Šæœ€å¤§åŒ–</li></ul><p><strong>wujieæ˜¯å¦‚ä½•æ¸²æŸ“å­åº”ç”¨çš„ï¼Ÿ</strong><br>wujieè·Ÿqiankunä¸€æ ·ï¼Œéƒ½æ˜¯åŸºäºhtml entryåŠ è½½çš„ï¼Œä½†ä»–ä»¬è§£æhtmlçš„è¿‡ç¨‹æ˜¯ä¸ä¸€æ ·çš„ã€‚ qiankunæ˜¯ç›´æ¥è§£æå¹¶æ‰§è¡Œjsã€cssã€htmlçš„ï¼Œè€Œwujieåˆ™æ˜¯å…ˆè§£æhtmlï¼Œæå–å‡ºscriptè„šæœ¬æ”¾å…¥ç©ºçš„iframeä¸­ï¼Œæå–å‡ºcssã€htmlæ”¾å…¥åˆ°web componentsä¸­ï¼Œå…·ä½“æ¥è¯´ï¼š</p><ol><li>è§£æå…¥å£ HTML ï¼Œåˆ†åˆ«å¾—åˆ°scriptã€cssã€æ¨¡ç‰ˆhtml</li><li>åˆ›å»ºä¸€ä¸ªçº¯å‡€çš„ iframeï¼Œä¸ºäº†å®ç°åº”ç”¨é—´ï¼ˆiframe é—´ï¼‰é€šè®¯ï¼Œæ— ç•Œå­åº”ç”¨ iframe çš„ url ä¼šè®¾ç½®ä¸ºä¸»åº”ç”¨çš„åŸŸåï¼ˆåŒåŸŸï¼‰ï¼Œå› æ­¤ iframe çš„ location.href å¹¶ä¸æ˜¯å­åº”ç”¨çš„ urlã€‚åˆ›å»ºå¥½ååœæ­¢åŠ è½½iframeã€‚</li><li>iframeå†…æ’å…¥jsï¼Œå°†æŠ½ç¦»å‡ºæ¥çš„scriptè„šæœ¬ï¼Œæ’åˆ°iframeä¸­å»ï¼Œåœ¨iframeä¸­æ‰§è¡Œå­åº”ç”¨çš„js</li><li>åˆ›å»ºweb componentï¼Œidä¸ºå­åº”ç”¨idï¼Œå°†æŠ½ç¦»å‡ºæ¥çš„htmlæ’å…¥ã€‚</li><li>ç”±äºiframeå†…çš„jsæœ‰å¯èƒ½æ“ä½œdomï¼Œä½†æ˜¯iframeå†…æ²¡æœ‰domï¼Œéšæ„wujieæ¡†æ¶å†…å¯¹iframeæ‹¦æˆªdocumentå¯¹è±¡ï¼Œç»Ÿä¸€å°†domæŒ‡å‘shadowRootï¼Œæ­¤æ—¶æ¯”å¦‚æ–°å»ºå…ƒç´ ã€å¼¹çª—æˆ–è€…å†’æ³¡ç»„ä»¶å°±å¯ä»¥æ­£å¸¸çº¦æŸåœ¨shadowRootå†…éƒ¨ã€‚</li></ol><h4 id=2wujieå®æˆ˜>2.wujieå®æˆ˜<a hidden class=anchor aria-hidden=true href=#2wujieå®æˆ˜>#</a></h4><p>wujieæ¥å…¥å¾ˆç®€å•ï¼Œä¸»åº”ç”¨å¯ä»¥è®©å¼€å‘è€…ä»¥ç»„ä»¶çš„æ–¹å¼åŠ è½½å­åº”ç”¨ã€‚å­åº”ç”¨åªéœ€è¦åšæ”¯æŒè·¨åŸŸè¯·æ±‚æ”¹é€ ï¼Œè¿™ä¸ªæ˜¯æ‰€æœ‰å¾®å‰ç«¯æ¡†æ¶è¿è¡Œçš„å‰æï¼Œé™¤æ­¤ä¹‹å¤–å­åº”ç”¨å¯ä»¥ä¸åšä»»ä½•æ”¹é€ å°±å¯ä»¥åœ¨æ— ç•Œæ¡†æ¶ä¸­è¿è¡Œï¼Œä¸è¿‡æ­¤æ—¶è¿è¡Œçš„æ–¹å¼æ˜¯é‡å»ºæ¨¡å¼ã€‚ å­åº”ç”¨ä¹Ÿå¯ä»¥é…ç½®ä¿æ´»ã€ç”Ÿå‘½å‘¨æœŸé€‚é…è¿›å…¥ä¿æ´»æ¨¡å¼æˆ–å•ä¾‹æ¨¡å¼ã€‚</p><h5 id=iä¸»åº”ç”¨å…¥å£æ–‡ä»¶-2>i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#iä¸»åº”ç”¨å…¥å£æ–‡ä»¶-2>#</a></h5><p>ä¸å…¶ä»–æ¡†æ¶ä¸€æ ·ï¼Œå…ˆé…ç½®å­åº”ç”¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#75715e>// main-react/index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#34;react-app-polyfill/stable&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#34;react-app-polyfill/ie11&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ReactDOM</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react-dom&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>WujieReact</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;wujie-react&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#34;./index.css&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>App</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./App&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>hostMap</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./hostMap&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>credentialsFetch</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./fetch&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>lifecycles</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./lifecycle&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>plugins</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./plugin&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>setupApp</span>, <span style=color:#a6e22e>preloadApp</span>, <span style=color:#a6e22e>bus</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>WujieReact</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isProduction</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>NODE_ENV</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;production&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>bus</span>.<span style=color:#a6e22e>$on</span>(<span style=color:#e6db74>&#34;click&#34;</span>, (<span style=color:#a6e22e>msg</span>) =&gt; window.<span style=color:#a6e22e>alert</span>(<span style=color:#a6e22e>msg</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>degrade</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>localStorage</span>.<span style=color:#a6e22e>getItem</span>(<span style=color:#e6db74>&#34;degrade&#34;</span>) <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span>window.Proxy <span style=color:#f92672>||</span> <span style=color:#f92672>!</span>window.<span style=color:#a6e22e>CustomElementRegistry</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * å¤§éƒ¨åˆ†ä¸šåŠ¡æ— éœ€è®¾ç½® attrs
</span></span></span><span style=display:flex><span><span style=color:#75715e> * æ­¤å¤„ä¿®æ­£ iframe çš„ srcï¼Œæ˜¯é˜²æ­¢github pages cspæŠ¥é”™
</span></span></span><span style=display:flex><span><span style=color:#75715e> * å› ä¸ºé»˜è®¤æ˜¯åªæœ‰ host+portï¼Œæ²¡æœ‰æºå¸¦è·¯å¾„
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>attrs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>isProduction</span> <span style=color:#f92672>?</span> { <span style=color:#a6e22e>src</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>hostMap</span>(<span style=color:#e6db74>&#34;//localhost:7700/&#34;</span>) } <span style=color:#f92672>:</span> {};
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * é…ç½®åº”ç”¨ï¼Œä¸»è¦æ˜¯è®¾ç½®é»˜è®¤é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#75715e> * preloadAppã€startAppçš„é…ç½®ä¼šåŸºäºè¿™ä¸ªé…ç½®åšè¦†ç›–
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>setupApp</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;react16&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>url</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>hostMap</span>(<span style=color:#e6db74>&#34;//localhost:7600/&#34;</span>),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>attrs</span>, <span style=color:#75715e>// å­åº”ç”¨iframeçš„src
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>exec</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>, <span style=color:#75715e>// é¢„æ‰§è¡Œ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fetch</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>credentialsFetch</span>, <span style=color:#75715e>// è‡ªå®šä¹‰çš„fetchæ–¹æ³•
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>plugins</span>,
</span></span><span style=display:flex><span>  <span style=color:#75715e>/** å­åº”ç”¨çŸ­è·¯å¾„æ›¿æ¢ï¼Œè·¯ç”±åŒæ­¥æ—¶ç”Ÿæ•ˆ */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>prefix</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#34;prefix-dialog&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/dialog&#34;</span>, <span style=color:#e6db74>&#34;prefix-location&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/location&#34;</span> },
</span></span><span style=display:flex><span>   <span style=color:#75715e>/** å­åº”ç”¨é‡‡ç”¨é™çº§iframeæ–¹æ¡ˆ */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>degrade</span>,
</span></span><span style=display:flex><span>  ...<span style=color:#a6e22e>lifecycles</span>,
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>setupApp</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;vue3&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>url</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>hostMap</span>(<span style=color:#e6db74>&#34;//localhost:7300/&#34;</span>),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>attrs</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>exec</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>alive</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>, <span style=color:#75715e>// å­åº”ç”¨ä¿æ´»ï¼Œstateä¸ä¼šä¸¢å¤±
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>plugins</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>cssExcludes</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css&#34;</span>] }],
</span></span><span style=display:flex><span>  <span style=color:#75715e>// å¼•å…¥äº†çš„ç¬¬ä¸‰æ–¹æ ·å¼ä¸éœ€è¦æ·»åŠ credentials
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fetch</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>options</span>) =&gt;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>hostMap</span>(<span style=color:#e6db74>&#34;//localhost:7300/&#34;</span>)) <span style=color:#f92672>?</span> <span style=color:#a6e22e>credentialsFetch</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>options</span>) <span style=color:#f92672>:</span> window.<span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>options</span>),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>degrade</span>,
</span></span><span style=display:flex><span>  ...<span style=color:#a6e22e>lifecycles</span>,
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (window.<span style=color:#a6e22e>localStorage</span>.<span style=color:#a6e22e>getItem</span>(<span style=color:#e6db74>&#34;preload&#34;</span>) <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#34;false&#34;</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>preloadApp</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;react16&#34;</span>,
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (window.Proxy) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>preloadApp</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;vue3&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ReactDOM</span>.<span style=color:#a6e22e>render</span>(&lt;<span style=color:#f92672>App</span> /&gt;, document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;root&#34;</span>));
</span></span></code></pre></div><p>å¼•å…¥å­åº”ç”¨çš„åœ°æ–¹ç›´æ¥ä»¥ç»„ä»¶å¼çš„æ–¹å¼å¼•å…¥ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>hostMap</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;../hostMap&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>WujieReact</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;wujie-react&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useNavigate</span>, <span style=color:#a6e22e>useLocation</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react-router-dom&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>React16</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>navigation</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useNavigate</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>location</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useLocation</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>pathname</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;/react16-sub&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;/react16&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;/&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>); <span style=color:#75715e>////
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>react16Url</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hostMap</span>(<span style=color:#e6db74>&#34;//localhost:7600/&#34;</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>path</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>props</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jump</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>name</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>navigation</span>(<span style=color:#e6db74>`/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å•ä¾‹æ¨¡å¼ï¼Œnameç›¸åŒåˆ™å¤ç”¨ä¸€ä¸ªæ— ç•Œå®ä¾‹ï¼Œæ”¹å˜urlåˆ™å­åº”ç”¨é‡æ–°æ¸²æŸ“å®ä¾‹åˆ°å¯¹åº”è·¯ç”±
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    &lt;<span style=color:#f92672>WujieReact</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>width</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;100%&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>height</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;100%&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;react16&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>url</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>react16Url</span>}
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>sync</span><span style=color:#f92672>=</span>{<span style=color:#f92672>!</span><span style=color:#a6e22e>path</span>}
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>props</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>props</span>}
</span></span><span style=display:flex><span>    &gt;&lt;/<span style=color:#f92672>WujieReact</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=iié¢„è§ˆ>ii.é¢„è§ˆ<a hidden class=anchor aria-hidden=true href=#iié¢„è§ˆ>#</a></h5><img src=https://cdn.jsdelivr.net/gh/lianpf/image-bed@main/blog/2024/20240515-004.webp width=800><h4 id=2æ¡†æ¶ä¼˜ç¼ºç‚¹>2.æ¡†æ¶ä¼˜ç¼ºç‚¹<a hidden class=anchor aria-hidden=true href=#2æ¡†æ¶ä¼˜ç¼ºç‚¹>#</a></h4><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ¥å…¥ç®€å•ï¼Œå¯ä»¥ä»¥ç»„ä»¶çš„æ–¹å¼å¼•å…¥å­åº”ç”¨</li><li>çº¯å‡€æ— æ±¡æŸ“<ul><li>æ— ç•Œåˆ©ç”¨iframeå’Œwebcomponentæ¥æ­å»ºå¤©ç„¶çš„jséš”ç¦»æ²™ç®±å’Œcsséš”ç¦»æ²™ç®±</li><li>åˆ©ç”¨iframeçš„historyå’Œä¸»åº”ç”¨çš„historyåœ¨åŒä¸€ä¸ªtop-level browsing contextæ¥æ­å»ºå¤©ç„¶çš„è·¯ç”±åŒæ­¥æœºåˆ¶</li><li>å‰¯ä½œç”¨å±€é™åœ¨æ²™ç®±å†…éƒ¨ï¼Œå­åº”ç”¨åˆ‡æ¢æ— éœ€ä»»ä½•æ¸…ç†å·¥ä½œï¼Œæ²¡æœ‰é¢å¤–çš„åˆ‡æ¢æˆæœ¬</li></ul></li><li>æ”¯æŒvite esmoudleåŠ è½½ï¼Œç”±äºjsæ˜¯ç‹¬ç«‹åœ¨iframeä¸­åŠ è½½çš„ï¼Œæ‰€ä»¥æ”¯æŒesmoduleåŠ è½½</li><li>æ”¯æŒé¢„åŠ è½½</li><li>æ”¯æŒåº”ç”¨ä¿æ´»ï¼Œå­åº”ç”¨çŠ¶æ€ä¿ç•™ï¼Œç”±äºæ˜¯ç‹¬ç«‹åœ¨iframeä¸­çš„ï¼Œè€Œåˆ‡æ¢åº”ç”¨æ—¶ä¸ä¼šç§»é™¤iframeï¼Œæ‰€ä»¥å­åº”ç”¨çš„çŠ¶æ€ä¼šè¢«ä¿ç•™åœ¨åŸæ¥çš„iframeä¸­ï¼Œå½“ä¸»åº”ç”¨å†æ¬¡æ¸²æŸ“å­åº”ç”¨domæ—¶ï¼Œä¼šæ˜¾ç¤ºä¹‹å‰çš„çŠ¶æ€ã€‚</li><li>å¤šåº”ç”¨åŒæ—¶æ¿€æ´»åœ¨çº¿</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>iframeæ²™ç®±çš„srcè®¾ç½®äº†ä¸»åº”ç”¨çš„hostï¼Œåˆå§‹åŒ–iframeçš„æ—¶å€™éœ€è¦ç­‰å¾…iframeçš„location.orignä»&rsquo;about:blank&rsquo;åˆå§‹åŒ–ä¸ºä¸»åº”ç”¨çš„hostï¼Œè¿™ä¸ªé‡‡ç”¨çš„è®¡æ—¶å™¨å»ç­‰å¾…çš„ä¸æ˜¯å¾ˆä¼˜é›…ã€‚</li></ul><h3 id=æ¡†æ¶4-micro-app>æ¡†æ¶4: Micro App<a hidden class=anchor aria-hidden=true href=#æ¡†æ¶4-micro-app>#</a></h3><p>mirco-app æ˜¯äº¬ä¸œ2021å¹´å¼€æºçš„ä¸€æ¬¾å¾®å‰ç«¯æ¡†æ¶ã€‚å®ƒå€ŸåŠ©äº†æµè§ˆå™¨å¯¹ webComponent çš„æ”¯æŒï¼Œå®ç°äº†ä¸€å¥—å¾®å‰ç«¯æ–¹æ¡ˆä½“ç³»ã€‚å¹¶ä¸”ç”±äº Shadow Dom å¯¹ react è¿™ç±»åº“çš„å…¼å®¹æ€§è¾ƒå·®ï¼Œä¾¿è‡ªå·±å®ç°äº†ç±» Shadow Dom çš„æ•ˆæœã€‚ä¸ qiankun ç›¸æ¯”ï¼Œæ¥å…¥æ›´åŠ ç®€å•ã€‚æœ€æ–°çš„ç‰ˆæœ¬ä¹Ÿæ”¯æŒiframeå®ç°jséš”ç¦»ï¼Œç±»ä¼¼wujieã€‚æˆªè‡³ç›®å‰ï¼ˆ2024å¹´4æœˆï¼‰github star 5.2k</p><h4 id=1å®ç°æ–¹æ¡ˆ-3>1.å®ç°æ–¹æ¡ˆ<a hidden class=anchor aria-hidden=true href=#1å®ç°æ–¹æ¡ˆ-3>#</a></h4><p>é¦–å…ˆmicro-appå®ç°äº†ä¸€ä¸ªåŸºäºWebComponentçš„ç»„ä»¶ï¼Œå¹¶å®ç°äº†ç±»Shadow Dom çš„æ•ˆæœï¼Œå¼€å‘è€…åªéœ€è¦ç”¨<code>&lt;micro-app name="xx" url="xx" baseroute="/xxx/xxx"></code>æ¥åŠ è½½å­åº”ç”¨ï¼Œæ•´ä¸ªå¯¹å­åº”ç”¨çš„åŠ è½½ã€jséš”ç¦»ã€csséš”ç¦»çš„é€»è¾‘éƒ½å°è£…åœ¨äº†web componentç»„ä»¶<code>&lt;micro-app></code>ä¸­ï¼Œå…·ä½“æ¥è¯´ï¼š</p><ol><li>å½“è°ƒç”¨microApp.start()åï¼Œä¼šæ³¨å†Œä¸€ä¸ªåä¸ºmicro-app çš„è‡ªå®šä¹‰ webComponent æ ‡ç­¾ã€‚æˆ‘ä»¬å¯ä»¥ä» <code>&lt;micro-app name='app1' url='xx' baseroute='/my-page'>&lt;/micro-app> </code>ä¸­æ‹¿åˆ°å­åº”ç”¨çš„çº¿ä¸Šå…¥å£åœ°å€ã€‚</li><li><code>&lt;micro-app></code>ç»„ä»¶å†…éƒ¨ï¼Œå½“åŒ¹é…åˆ°è·¯ç”±åï¼Œè·Ÿqiankunä¸€æ ·åŠ è½½htmlï¼Œå¾—åˆ°htmlå­—ç¬¦ä¸²æ¨¡ç‰ˆ</li><li>åˆ†æhtmlå­—ç¬¦ä¸²ï¼Œæå–<code>&lt;head>å¤´å’Œ&lt;body></code>ï¼Œå¹¶æ›¿æ¢ä¸ºæ¡†æ¶è‡ªå®šä¹‰æ ‡ç­¾<code>&lt;micro-app-head>å’Œ&lt;micro-app-body></code></li><li>åœ¨<code>&lt;micro-app-head></code>å†…ï¼Œä¼šå¯¹scriptæ ‡ç­¾å’Œlinkæ ‡ç­¾çš„å†…å®¹è¿›è¡ŒåŠ è½½å¹¶æ‰§è¡Œ</li><li>å°†<code>&lt;micro-app-head></code>å’Œ<code>&lt;micro-app-body></code>æ’å…¥åˆ°<code>&lt;micro-app></code>æ ‡ç­¾å†…</li><li><code>&lt;micro-app></code>å†…æä¾›äº†jsæ²™ç®±æ–¹æ³•ï¼ˆv1.0ä»¥å‰è·Ÿqiankunæ²™ç®±ä¸€æ ·ï¼‰ï¼Œ<code>&lt;micro-app-head></code>æŒ‚è½½åˆ°<code>&lt;micro-app></code>åï¼Œå†…éƒ¨ä¼šé€ä¸€å¯¹<code>&lt;micro-app-head></code>å†…çš„scriptæ ‡ç­¾çš„jsç»‘å®šä½œç”¨åŸŸï¼Œå®ç°jséš”ç¦»ã€‚</li></ol><p><strong>csséš”ç¦»æ–¹æ¡ˆ</strong>
é»˜è®¤ä½¿ç”¨æ­£åˆ™å°†CSSå­—ç¬¦ä¸²åˆ‡å‰²æˆæœ€å°å•å…ƒï¼Œæ¯ä¸ªå•å…ƒåŒ…å«ä¸€æ®µCSSä¿¡æ¯ï¼Œå°†æ‰€æœ‰çš„ä¿¡æ¯æ•´ç†ç”ŸæˆCSSTreeï¼Œéå†CSSTreeçš„æ¯ä¸ªè§„åˆ™ï¼Œæ·»åŠ å‰ç¼€å®ç°æ ·å¼éš”ç¦»ã€‚</p><img src=https://cdn.jsdelivr.net/gh/lianpf/image-bed@main/blog/2024/20240515-005.webp width=800><p><strong>jséš”ç¦»æ–¹æ¡ˆ</strong>
micro-appæœ‰ä¸¤ç§æ–¹å¼å®ç°jséš”ç¦»ï¼Œé»˜è®¤æ˜¯è·Ÿqiankunä¸€æ ·é‡‡ç”¨proxyæ²™ç®±çš„æ–¹å¼éš”ç¦»ï¼Œ åœ¨v1.0å‘å¸ƒåæ”¯æŒäº†åŸºäºåŸç”Ÿiframeçš„éš”ç¦»æ–¹å¼ã€‚</p><h4 id=2micro-appå®æˆ˜>2.Micro Appå®æˆ˜<a hidden class=anchor aria-hidden=true href=#2micro-appå®æˆ˜>#</a></h4><h5 id=iä¸»åº”ç”¨å…¥å£æ–‡ä»¶-3>i.ä¸»åº”ç”¨å…¥å£æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#iä¸»åº”ç”¨å…¥å£æ–‡ä»¶-3>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ReactDOM</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-dom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#39;./index.css&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Router</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./router&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>microApp</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@micro-zoe/micro-app&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>microApp</span>.<span style=color:#a6e22e>start</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ReactDOM</span>.<span style=color:#a6e22e>render</span>(
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>React.StrictMode</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>Router</span> /&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>React.StrictMode</span>&gt;,
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;root&#39;</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><p><strong>è°ƒç”¨å­åº”ç”¨</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>MyPage</span> () {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>h1</span>&gt;<span style=color:#a6e22e>å­åº”ç”¨</span><span style=color:#960050;background-color:#1e0010>ğŸ‘‡</span>&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>      <span style=color:#75715e>// nameï¼šåº”ç”¨åç§°, urlï¼šåº”ç”¨åœ°å€
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      &lt;<span style=color:#f92672>micro</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>app</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;my-app&#39;</span> <span style=color:#a6e22e>url</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;http://localhost:3000/&#39;</span>&gt;<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/micro-app&gt;</span>
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=iié¢„è§ˆ-1>ii.é¢„è§ˆ<a hidden class=anchor aria-hidden=true href=#iié¢„è§ˆ-1>#</a></h5><img src=https://cdn.jsdelivr.net/gh/lianpf/image-bed@main/blog/2024/20240515-006.webp width=800><h4 id=2æ¡†æ¶ä¼˜ç¼ºç‚¹-1>2.æ¡†æ¶ä¼˜ç¼ºç‚¹<a hidden class=anchor aria-hidden=true href=#2æ¡†æ¶ä¼˜ç¼ºç‚¹-1>#</a></h4><p><strong>ä¼˜ç‚¹</strong></p><ul><li>æ¥å…¥ç®€å•ï¼Œç»„ä»¶å¼å¼•å…¥å­åº”ç”¨</li><li>å›¢é˜ŸæŒç»­æ›´æ–°ç»´æŠ¤</li><li>jséš”ç¦»ã€csséš”ç¦»ã€è·¯ç”±åŒæ­¥</li><li>æ”¯æŒå­åº”ç”¨ä¿æ´», éœ€è¦å¼€å¯keep-aliveæ¨¡å¼</li><li>æ”¯æŒfiberæ¨¡å¼ï¼Œæå‡ä¸»åº”ç”¨çš„æ¸²æŸ“æ€§èƒ½ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>1.0ä¹‹å‰ä¸æ”¯æŒviteï¼Œ1.0ä¹‹åæ”¯æŒäº†</li><li>é»˜è®¤csséš”ç¦»æ–¹å¼ï¼Œä¸»åº”ç”¨çš„æ ·å¼è¿˜æ˜¯ä¼šæ±¡æŸ“åˆ°å­åº”ç”¨ã€‚</li><li>å­åº”ç”¨å’Œä¸»åº”ç”¨å¿…é¡»ç›¸åŒçš„è·¯ç”±æ¨¡å¼ï¼Œè¦ä¹ˆåŒæ—¶hashæ¨¡å¼ï¼Œè¦ä¹ˆåŒæ—¶historyæ¨¡å¼</li><li>ä¾èµ–äºCustomElementså’ŒProxyä¸¤ä¸ªè¾ƒæ–°çš„APIã€‚Proxyæš‚æ—¶æ²¡æœ‰åšå…¼å®¹ï¼Œæ‰€ä»¥å¯¹äºä¸æ”¯æŒProxyçš„æµè§ˆå™¨æ— æ³•è¿è¡Œmicro-appã€‚</li></ul><hr><h2 id=å‚è€ƒ>å‚è€ƒ<a hidden class=anchor aria-hidden=true href=#å‚è€ƒ>#</a></h2><ul><li><a href=https://mp.weixin.qq.com/s/997pVVxdgpOH6ZsDsFAh2g>æ¢æ¢å„ä¸ªå¾®å‰ç«¯æ¡†æ¶ | å¥‡èˆç²¾é€‰</a></li></ul><hr><p><strong>æœ€åï¼Œ å¸Œæœ›å¤§å®¶æ—©æ—¥å®ç°ï¼šæˆä¸ºç¼–ç¨‹é«˜æ‰‹çš„ä¼Ÿå¤§æ¢¦æƒ³ï¼</strong><br><strong>æ¬¢è¿äº¤æµ~</strong></p><img src=/img-common/weChatPublic.jpg alt=å¾®ä¿¡å…¬ä¼—å· width=600 height=286><p><strong>æœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ›œçµæ‰€æœ‰ï¼æœªç»å…è®¸ï¼Œä¸¥ç¦è½¬è½½ï¼å¯¹éæ³•è½¬è½½è€…, åŸä½œè€…ä¿ç•™é‡‡ç”¨æ³•å¾‹æ‰‹æ®µè¿½ç©¶çš„æƒåˆ©ï¼</strong><br><strong>è‹¥éœ€è½¬è½½ï¼Œè¯·è”ç³»å¾®ä¿¡å…¬ä¼—å·ï¼šè¿å…ˆç”Ÿæœ‰çŒ«ç—…ï¼Œå¯è·å–ä½œè€…è”ç³»æ–¹å¼ï¼</strong></p></div><footer class=post-footer><nav class=paginav><a class=next href=https://lianpf.github.io/posts/frontend-develop/ts-codefragment/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>å¸¸è§é—®é¢˜&ä»£ç ç‰‡æ®µ: TS</span></a></nav></footer></div><script src=https://utteranc.es/client.js repo=lianpf/lianpf.github.io issue-term=title label=comments theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>Copyright
&copy;
2016-2024
<a href=https://lianpf.github.io/ style=color:#939393>æ›œçµï¼ˆSUNï¼‰Site</a>.
åŸºäº Hugo å¼•æ“å’Œ PaperMod ä¸»é¢˜</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href,s=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>