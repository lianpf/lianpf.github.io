<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>npm åˆ° pnpmï¼šè¡¥ä¸åŒ…ï¼ˆpatchï¼‰è¿ç§» | æ›œçµï¼ˆSUNï¼‰Site</title><meta name=keywords content="Node,npm,pnpm"><meta name=description content="æœ¬æ–‡ä¸»è¦å¥—è·¯åœ¨npmè¿ç§»åˆ°pnpmæ—¶ï¼ŒpatchåŒ…ä¸å…¼å®¹çš„ä¸€äº›é—®é¢˜&mldr;"><meta name=author content="æ›œçµ"><link rel=canonical href=https://lianpf.github.io/posts/frontend-develop/pnpm-patch/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lianpf.github.io/img-common/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://lianpf.github.io/img-common/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://lianpf.github.io/img-common/favicon.png><link rel=apple-touch-icon href=https://lianpf.github.io/img-common/avatar.jpeg><link rel=mask-icon href=https://lianpf.github.io/img-common/avatar.jpeg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><style>.fa-commenting-o,#post_meta_style_8,#comment_count,.comment-count,.comment-icon,svg[class*=comment],a[aria-label*=comment]{display:none!important}</style><meta property="og:title" content="npm åˆ° pnpmï¼šè¡¥ä¸åŒ…ï¼ˆpatchï¼‰è¿ç§»"><meta property="og:description" content="æœ¬æ–‡ä¸»è¦å¥—è·¯åœ¨npmè¿ç§»åˆ°pnpmæ—¶ï¼ŒpatchåŒ…ä¸å…¼å®¹çš„ä¸€äº›é—®é¢˜&mldr;"><meta property="og:type" content="article"><meta property="og:url" content="https://lianpf.github.io/posts/frontend-develop/pnpm-patch/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-15T20:35:35+08:00"><meta property="article:modified_time" content="2025-07-16T09:35:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="npm åˆ° pnpmï¼šè¡¥ä¸åŒ…ï¼ˆpatchï¼‰è¿ç§»"><meta name=twitter:description content="æœ¬æ–‡ä¸»è¦å¥—è·¯åœ¨npmè¿ç§»åˆ°pnpmæ—¶ï¼ŒpatchåŒ…ä¸å…¼å®¹çš„ä¸€äº›é—®é¢˜&mldr;"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://lianpf.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» å‰ç«¯","item":"https://lianpf.github.io/posts/frontend-develop/"},{"@type":"ListItem","position":3,"name":"npm åˆ° pnpmï¼šè¡¥ä¸åŒ…ï¼ˆpatchï¼‰è¿ç§»","item":"https://lianpf.github.io/posts/frontend-develop/pnpm-patch/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"npm åˆ° pnpmï¼šè¡¥ä¸åŒ…ï¼ˆpatchï¼‰è¿ç§»","name":"npm åˆ° pnpmï¼šè¡¥ä¸åŒ…ï¼ˆpatchï¼‰è¿ç§»","description":"æœ¬æ–‡ä¸»è¦å¥—è·¯åœ¨npmè¿ç§»åˆ°pnpmæ—¶ï¼ŒpatchåŒ…ä¸å…¼å®¹çš„ä¸€äº›é—®é¢˜\u0026hellip;\n","keywords":["Node","npm","pnpm"],"articleBody":"æœ¬æ–‡ä¸»è¦å¥—è·¯åœ¨npmè¿ç§»åˆ°pnpmæ—¶ï¼ŒpatchåŒ…ä¸å…¼å®¹çš„ä¸€äº›é—®é¢˜â€¦\nå‰è¨€ åœ¨å‰ç«¯é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä¿®æ”¹ node_modules ä¸­ç¬¬ä¸‰æ–¹åŒ…çš„ä»£ç æ¥ä¿®å¤ bug æˆ–æ·»åŠ åŠŸèƒ½ã€‚npm ç”Ÿæ€ä¸­çš„ patch-package æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä½†å½“é¡¹ç›®è¿ç§»åˆ° pnpm æ—¶ï¼Œä¼šé‡åˆ°è¡¥ä¸åŒ…ä¸å…¼å®¹çš„é—®é¢˜ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ pnpm ç¯å¢ƒä¸‹å¤„ç†è¿™ç§å…¼å®¹æ€§é—®é¢˜ã€‚\nç›¸å…³æ–‡ç« ï¼š\nã€ŠNPMè¡¥ä¸åŒ…: patch-packageçš„ä½¿ç”¨åŠè¡¥ä¸åŒ…ç®¡ç†ã€‹ èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆéœ€è¦è¡¥ä¸åŒ…ï¼Ÿ åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œéœ€è¦ä¿®æ”¹ @vant/cli çš„ gen-package-entry.js æ–‡ä»¶ï¼Œæ·»åŠ è‡ªå®šä¹‰å‡½æ•° initMobileUI çš„å¯¼å‡ºé€»è¾‘ã€‚è¿™ä¸ªä¿®æ”¹åœ¨æ¯æ¬¡ npm install åéƒ½ä¼šä¸¢å¤±ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨è¡¥ä¸åŒ…æ¥æŒä¹…åŒ–è¿™äº›ä¿®æ”¹ã€‚\nä¸€ã€pnpm patch åŸç”Ÿæµç¨‹ 1.1 åˆ›å»ºè¡¥ä¸ pnpm æä¾›äº†åŸç”Ÿçš„è¡¥ä¸åŠŸèƒ½ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼š\n# åˆ›å»ºè¡¥ä¸çš„ä¸´æ—¶å·¥ä½œç›®å½• $ pnpm patch # å¦‚ï¼špnpm patch @vant/cli@5.1.0 æ‰§è¡Œåï¼Œpnpm ä¼šè¾“å‡ºç±»ä¼¼ä¿¡æ¯ï¼š\nYou can now edit the following folder: /private/var/folders/.../T/xxxxx Once you're done with your changes, run \"pnpm patch-commit \" 1.2 ä¿®æ”¹ä»£ç  è¿›å…¥ä¸´æ—¶ç›®å½•ä¿®æ”¹éœ€è¦çš„æ–‡ä»¶ï¼š\ncd /private/var/folders/.../T/xxxxx # ç¼–è¾‘éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ vim lib/compiler/gen-package-entry.js åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œéœ€è¦æ·»åŠ ä»¥ä¸‹ä¿®æ”¹ï¼š\n// åœ¨ genPackageEntry å‡½æ•°ä¸­æ·»åŠ  const components = names.map(pascalize); // æ·»åŠ å¯¹ utils çš„å¯¼å…¥ï¼Œç‰¹åˆ«æ˜¯ initMobileUI const utilsImport = `import { initMobileUI } from '${getPathByName('utils', pathResolver)}';`; const content = `${genImports(names, pathResolver, namedExport)} ${utilsImport} // ... å…¶ä»–ä»£ç  // åœ¨å¯¼å‡ºéƒ¨åˆ†æ·»åŠ  ${genExports(names, pathResolver, namedExport)} export { initMobileUI }; 1.3 æäº¤è¡¥ä¸ ä¿®æ”¹å®Œæˆåï¼Œå›åˆ°é¡¹ç›®æ ¹ç›®å½•æäº¤è¡¥ä¸ï¼š\npnpm patch-commit '/private/var/folders/.../T/xxxxx' è¿™ä¼šåœ¨ patches/ ç›®å½•ä¸‹ç”Ÿæˆ @vant__cli@5.1.0.patch æ–‡ä»¶ï¼ˆæ³¨æ„æ˜¯åŒä¸‹åˆ’çº¿ï¼‰ã€‚\n1.4 è¡¥ä¸æ–‡ä»¶æ ¼å¼ pnpm ç”Ÿæˆçš„è¡¥ä¸æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š\ndiff --git a/lib/compiler/gen-package-entry.js b/lib/compiler/gen-package-entry.js index d07e0a7..b5b9200 100644 --- a/lib/compiler/gen-package-entry.js +++ b/lib/compiler/gen-package-entry.js @@ -47,7 +47,11 @@ export function genPackageEntry({ outputPath, pathResolver, }) { const skipInstall = (((_b = vantConfig.build) === null || _b === void 0 ? void 0 : _b.skipInstall) || []).map(pascalize); const version = process.env.PACKAGE_VERSION || getPackageJson().version; const components = names.map(pascalize); + + // æ·»åŠ å¯¹ utils çš„å¯¼å…¥ï¼Œç‰¹åˆ«æ˜¯ initMobileUI + const utilsImport = `import { initMobileUI } from '${getPathByName('utils', pathResolver)}';`; const content = `${genImports(names, pathResolver, namedExport)} +${utilsImport} const version = '${version}'; äºŒã€npm patch-package å…¼å®¹æ€§é—®é¢˜ 2.1 é—®é¢˜æè¿° å½“é¡¹ç›®ä» npm è¿ç§»åˆ° pnpm æ—¶ï¼ŒåŸæœ‰çš„ patch-package è¡¥ä¸æ–‡ä»¶ï¼ˆæ ¼å¼ä¸º @vant+cli+5.1.0.patchï¼Œä½¿ç”¨åŠ å·ï¼‰æ— æ³•è¢« pnpm è¯†åˆ«å’Œåº”ç”¨ã€‚\n2.2 ä¸¤ç§è¡¥ä¸æ ¼å¼çš„åŒºåˆ« ç‰¹æ€§ npm (patch-package) pnpm (åŸç”Ÿ) æ–‡ä»¶å‘½å @vant+cli+5.1.0.patch @vant__cli@5.1.0.patch åˆ†éš”ç¬¦ åŠ å· + åŒä¸‹åˆ’çº¿ __ åº”ç”¨æ—¶æœº æ‰‹åŠ¨æˆ– postinstall è‡ªåŠ¨åº”ç”¨ è·¯å¾„å‰ç¼€ node_modules/ ç›¸å¯¹è·¯å¾„ 2.3 ç›´æ¥è¿ç§»çš„é—®é¢˜ å¦‚æœç›´æ¥ä½¿ç”¨ pnpmï¼ŒåŸæœ‰çš„å†å²è¡¥ä¸æ–‡ä»¶å°†æ— æ³•åº”ç”¨ï¼Œå¯¼è‡´ï¼š\nå†å²åŠŸèƒ½ä¿®æ”¹ä¸¢å¤± éœ€è¦é‡æ–°åˆ›å»ºæ‰€æœ‰è¡¥ä¸ å¯èƒ½å½±å“é¡¹ç›®çš„æ­£å¸¸è¿è¡Œ ä¸‰ã€å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ 3.1 æ–¹æ¡ˆè®¾è®¡æ€è·¯ ä¸ºäº†åŒæ—¶æ”¯æŒå†å²è¡¥ä¸å’Œæ–°çš„ pnpm è¡¥ä¸ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†æ··åˆæ–¹æ¡ˆï¼š\npnpm åŸç”Ÿè¡¥ä¸ï¼šå¤„ç†æ–°çš„ä¿®æ”¹ï¼ˆå¦‚ initMobileUI å¯¼å‡ºï¼‰ è‡ªå®šä¹‰è„šæœ¬ï¼šåº”ç”¨å†å²çš„ npm è¡¥ä¸æ–‡ä»¶ postinstall é’©å­ï¼šç¡®ä¿è¡¥ä¸åœ¨ä¾èµ–å®‰è£…åè‡ªåŠ¨åº”ç”¨ 3.2 å®ç°æ­¥éª¤ æ­¥éª¤1ï¼šåˆ›å»ºè¡¥ä¸åº”ç”¨è„šæœ¬ åˆ›å»º apply-patches.js æ–‡ä»¶ï¼š\nconst { execSync } = require('child_process'); const fs = require('fs'); console.log('åº”ç”¨è‡ªå®šä¹‰è¡¥ä¸...'); try { // åº”ç”¨å†å²çš„ npm è¡¥ä¸æ–‡ä»¶ console.log('åº”ç”¨ vant-cli å†å²è¡¥ä¸...'); try { execSync('patch -p1 -i patches/@vant+cli+5.1.0.patch --forward --reject-file=-', { stdio: 'inherit' }); } catch (error) { console.log('è¡¥ä¸å¯èƒ½å·²ç»åº”ç”¨è¿‡ï¼Œç»§ç»­æ‰§è¡Œ...'); } console.log('âœ… è¡¥ä¸åº”ç”¨å®Œæˆ'); } catch (error) { console.error('âŒ è¡¥ä¸åº”ç”¨å¤±è´¥:', error.message); process.exit(1); } æ­¥éª¤2ï¼šé…ç½® package.json åœ¨ package.json ä¸­æ·»åŠ ç›¸å…³è„šæœ¬ï¼š\n{ \"scripts\": { \"patch\": \"node apply-patches.js\", \"postinstall\": \"node apply-patches.js\" } } æ­¥éª¤3ï¼šè¡¥ä¸æ–‡ä»¶ç®¡ç† é¡¹ç›®ä¸­ä¼šåŒæ—¶å­˜åœ¨ä¸¤ç§è¡¥ä¸æ–‡ä»¶ï¼š\npatches/ â”œâ”€â”€ @vant+cli+5.1.0.patch # npm æ ¼å¼ï¼ŒåŒ…å«å†å²ä¿®æ”¹ â””â”€â”€ @vant__cli@5.1.0.patch # pnpm æ ¼å¼ï¼ŒåŒ…å«æ–°ä¿®æ”¹ 3.3 å·¥ä½œæµç¨‹ å®Œæ•´çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\n# 1. å®‰è£…ä¾èµ– pnpm install # â†’ pnpm è‡ªåŠ¨åº”ç”¨ @vant__cli@5.1.0.patch # â†’ postinstall é’©å­æ‰§è¡Œ apply-patches.js # â†’ è„šæœ¬åº”ç”¨ @vant+cli+5.1.0.patch # 2. æ„å»ºé¡¹ç›® npm run build # â†’ æ‰€æœ‰è¡¥ä¸éƒ½å·²ç”Ÿæ•ˆï¼Œæ„å»ºæˆåŠŸ å››ã€å®é™…æ¡ˆä¾‹ï¼šè§£å†³ initMobileUI å¯¼å‡ºé—®é¢˜ 4.1 é—®é¢˜èƒŒæ™¯ æˆ‘ä»¬éœ€è¦åœ¨ @vant/cli çš„æ„å»ºäº§ç‰©ä¸­å¯¼å‡ºè‡ªå®šä¹‰çš„ initMobileUI å‡½æ•°ï¼Œä½†è¯¥å‡½æ•°åœ¨æ¯æ¬¡æ„å»ºåéƒ½ä¼šä¸¢å¤±ã€‚\n4.2 è§£å†³è¿‡ç¨‹ åˆ›å»º pnpm è¡¥ä¸ï¼š\npnpm patch @vant/cli@5.1.0 # ä¿®æ”¹ gen-package-entry.js æ·»åŠ  initMobileUI å¯¼å‡ºé€»è¾‘ pnpm patch-commit '/path/to/temp/dir' ä¿ç•™å†å²è¡¥ä¸ï¼š\nä¿æŒåŸæœ‰çš„ @vant+cli+5.1.0.patch æ–‡ä»¶ é€šè¿‡ apply-patches.js è„šæœ¬åº”ç”¨ éªŒè¯ç»“æœï¼š\n# æ£€æŸ¥æ„å»ºäº§ç‰© grep -n \"initMobileUI\" es/index.js lib/index.js # è¾“å‡ºï¼š # es/index.js:110:import { initMobileUI } from \"./utils\"; # es/index.js:348: initMobileUI, # lib/index.js:22: initMobileUI: () =\u003e import_utils.initMobileUI, 4.3 ç±»å‹å£°æ˜é—®é¢˜è§£å†³ åœ¨è¿ç§»è¿‡ç¨‹ä¸­è¿˜é‡åˆ°äº† TypeScript ç±»å‹å£°æ˜é—®é¢˜ï¼š\n# é”™è¯¯ï¼šCannot find name 'process'. Do you need to install type definitions for node? # è§£å†³ï¼šå®‰è£…ç±»å‹å®šä¹‰ pnpm add -D @types/node # é”™è¯¯ï¼šCannot find module 'postcss' # è§£å†³ï¼šå®‰è£…ä¾èµ– pnpm add -D postcss äº”ã€æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹ 5.1 æœ€ä½³å®è·µ è¡¥ä¸æ–‡ä»¶åˆ†ç¦»ï¼š\næ–°åŠŸèƒ½ä½¿ç”¨ pnpm åŸç”Ÿè¡¥ä¸ å†å²ä¿®æ”¹ä¿æŒ npm æ ¼å¼è¡¥ä¸ é€šè¿‡è„šæœ¬ç»Ÿä¸€ç®¡ç† è‡ªåŠ¨åŒ–åº”ç”¨ï¼š\nä½¿ç”¨ postinstall é’©å­ç¡®ä¿è¡¥ä¸è‡ªåŠ¨åº”ç”¨ è„šæœ¬ä¸­æ·»åŠ é”™è¯¯å¤„ç†ï¼Œé¿å…é‡å¤åº”ç”¨ ç‰ˆæœ¬æ§åˆ¶ï¼š\nå°†è¡¥ä¸æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ è¡¥ä¸è„šæœ¬ä¹Ÿè¦çº³å…¥ç‰ˆæœ¬æ§åˆ¶ 5.2 æ³¨æ„äº‹é¡¹ è¡¥ä¸å†²çªï¼š\næ³¨æ„ä¸¤ç§è¡¥ä¸æ–‡ä»¶ä¸è¦ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€éƒ¨åˆ† å¦‚æœ‰å†²çªï¼Œä¼˜å…ˆä½¿ç”¨ pnpm åŸç”Ÿè¡¥ä¸ è·¯å¾„é—®é¢˜ï¼š\nnpm è¡¥ä¸ä½¿ç”¨ node_modules/ å‰ç¼€ pnpm è¡¥ä¸ä½¿ç”¨ç›¸å¯¹è·¯å¾„ é”™è¯¯å¤„ç†ï¼š\nè¡¥ä¸åº”ç”¨å¤±è´¥æ—¶ä¸è¦ä¸­æ–­æ•´ä¸ªæ„å»ºè¿‡ç¨‹ æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®® 5.3 æ•…éšœæ’é™¤ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š\n# é—®é¢˜1ï¼šè¡¥ä¸æ–‡ä»¶æ ¼å¼é”™è¯¯ # è§£å†³ï¼šæ£€æŸ¥è¡¥ä¸æ–‡ä»¶çš„è·¯å¾„å‰ç¼€å’Œæ ¼å¼ # é—®é¢˜2ï¼šè¡¥ä¸å·²ç»åº”ç”¨è¿‡ # è§£å†³ï¼šä½¿ç”¨ --forward å‚æ•°å¿½ç•¥å·²åº”ç”¨çš„è¡¥ä¸ # é—®é¢˜3ï¼šæƒé™é—®é¢˜ # è§£å†³ï¼šç¡®ä¿å¯¹ node_modules æœ‰å†™æƒé™ å…­ã€æ€»ç»“ é€šè¿‡æœ¬æ–‡ä»‹ç»çš„æ··åˆæ–¹æ¡ˆï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†ä» npm åˆ° pnpm è¿ç§»è¿‡ç¨‹ä¸­çš„è¡¥ä¸åŒ…å…¼å®¹æ€§é—®é¢˜ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿åœ¨äºï¼š\nå‘åå…¼å®¹ï¼šä¿æŒå†å²è¡¥ä¸çš„æœ‰æ•ˆæ€§ å‘å‰å‘å±•ï¼šåˆ©ç”¨ pnpm çš„åŸç”Ÿè¡¥ä¸åŠŸèƒ½ è‡ªåŠ¨åŒ–ï¼šé€šè¿‡è„šæœ¬å’Œé’©å­å®ç°è‡ªåŠ¨åº”ç”¨ å¯ç»´æŠ¤æ€§ï¼šæ¸…æ™°çš„æ–‡ä»¶ç»“æ„å’Œé”™è¯¯å¤„ç† è¿™ç§æ–¹æ³•ä¸ä»…é€‚ç”¨äº @vant/cli çš„ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥æ¨å¹¿åˆ°å…¶ä»–éœ€è¦è¡¥ä¸åŒ…çš„åœºæ™¯ä¸­ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå»ºè®®æ ¹æ®å…·ä½“éœ€æ±‚è°ƒæ•´è„šæœ¬é€»è¾‘ï¼Œä½†æ ¸å¿ƒæ€è·¯ä¿æŒä¸å˜ã€‚\nå¸Œæœ›è¿™ä¸ªæ–¹æ¡ˆèƒ½å¸®åŠ©åˆ°å…¶ä»–é‡åˆ°ç±»ä¼¼é—®é¢˜çš„å¼€å‘è€…ï¼Œè®©é¡¹ç›®è¿ç§»è¿‡ç¨‹æ›´åŠ é¡ºç•…ã€‚\né™„å½•ï¼šå®Œæ•´ä»£ç ç¤ºä¾‹ apply-patches.js å®Œæ•´ä»£ç  const { execSync } = require('child_process'); const fs = require('fs'); console.log('åº”ç”¨è‡ªå®šä¹‰è¡¥ä¸...'); try { // 1. åº”ç”¨åŸæœ‰çš„è¡¥ä¸æ–‡ä»¶ console.log('åº”ç”¨ vant-cli å†å²è¡¥ä¸...'); try { execSync('patch -p1 -i patches/@vant+cli+5.1.0.patch --forward --reject-file=-', { stdio: 'inherit' }); } catch (error) { console.log('è¡¥ä¸å¯èƒ½å·²ç»åº”ç”¨è¿‡ï¼Œç»§ç»­æ‰§è¡Œ...'); } console.log('âœ… è¡¥ä¸åº”ç”¨å®Œæˆ'); } catch (error) { console.error('âŒ è¡¥ä¸åº”ç”¨å¤±è´¥:', error.message); process.exit(1); } package.json é…ç½®ç¤ºä¾‹ { \"name\": \"@zto/mzui\", \"version\": \"v3.12.0\", \"scripts\": { \"patch\": \"node apply-patches.js\", \"postinstall\": \"node apply-patches.js\", \"build\": \"vant-cli build \u0026\u0026 npm run build:rem\", \"build:rem\": \"node ./build-rem.js\" }, \"devDependencies\": { \"@types/node\": \"^24.0.14\", \"postcss\": \"^8.5.6\", \"patch-package\": \"^6.4.7\" } } ç›®å½•ç»“æ„ç¤ºä¾‹ project/ â”œâ”€â”€ patches/ â”‚ â”œâ”€â”€ @vant+cli+5.1.0.patch # npm æ ¼å¼è¡¥ä¸ â”‚ â””â”€â”€ @vant__cli@5.1.0.patch # pnpm æ ¼å¼è¡¥ä¸ â”œâ”€â”€ apply-patches.js # è¡¥ä¸åº”ç”¨è„šæœ¬ â”œâ”€â”€ package.json # é¡¹ç›®é…ç½® â””â”€â”€ src/ â””â”€â”€ utils/ â””â”€â”€ global-config.ts # initMobileUI å‡½æ•°å®šä¹‰ æœ€åï¼Œ å¸Œæœ›å¤§å®¶æ—©æ—¥å®ç°ï¼šæˆä¸ºç¼–ç¨‹é«˜æ‰‹çš„ä¼Ÿå¤§æ¢¦æƒ³ï¼ æ¬¢è¿äº¤æµ~\næœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ›œçµæ‰€æœ‰ï¼æœªç»å…è®¸ï¼Œä¸¥ç¦è½¬è½½ï¼å¯¹éæ³•è½¬è½½è€…, åŸä½œè€…ä¿ç•™é‡‡ç”¨æ³•å¾‹æ‰‹æ®µè¿½ç©¶çš„æƒåˆ©ï¼ è‹¥éœ€è½¬è½½ï¼Œè¯·è”ç³»å¾®ä¿¡å…¬ä¼—å·ï¼šè¿å…ˆç”Ÿæœ‰çŒ«ç—…ï¼Œå¯è·å–ä½œè€…è”ç³»æ–¹å¼ï¼\n","wordCount":"2551","inLanguage":"zh","datePublished":"2025-07-15T20:35:35+08:00","dateModified":"2025-07-16T09:35:35+08:00","author":[{"@type":"Person","name":"æ›œçµ"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://lianpf.github.io/posts/frontend-develop/pnpm-patch/"},"publisher":{"@type":"Organization","name":"æ›œçµï¼ˆSUNï¼‰Site","logo":{"@type":"ImageObject","url":"https://lianpf.github.io/img-common/favicon.png"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lianpf.github.io/ accesskey=h title="æ›œçµï¼ˆSUNï¼‰Site (Alt + H)"><img src=https://lianpf.github.io/img-common/avatar.jpeg alt=logo aria-label=logo height=35>æ›œçµï¼ˆSUNï¼‰Site</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lianpf.github.io/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://lianpf.github.io/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://lianpf.github.io/archives/ title="â±ï¸ å½’æ¡£"><span>â±ï¸ å½’æ¡£</span></a></li><li><a href=https://lianpf.github.io/tags title="ğŸ§© æ ‡ç­¾"><span>ğŸ§© æ ‡ç­¾</span></a></li><li><a href=https://lianpf.github.io/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://lianpf.github.io/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://lianpf.github.io/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://lianpf.github.io/posts/frontend-develop/>ğŸ‘¨ğŸ»â€ğŸ’» å‰ç«¯</a></div><h1 class=post-title>npm åˆ° pnpmï¼šè¡¥ä¸åŒ…ï¼ˆpatchï¼‰è¿ç§»</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>&nbsp;åˆ›å»º&nbsp;2025-07-15
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_2><span class="fa fa-calendar-plus-o"></span>
<span>&nbsp;æ›´æ–°&nbsp;2025-07-16
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>æ›œçµ
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://lianpf.github.io/tags/node/ style=color:var(--secondary)!important>Node</a>
&nbsp;<a href=https://lianpf.github.io/tags/npm/ style=color:var(--secondary)!important>npm</a>
&nbsp;<a href=https://lianpf.github.io/tags/pnpm/ style=color:var(--secondary)!important>pnpm</a></span></span></span></span>
<span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;</span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#%e8%83%8c%e6%99%af%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e8%a1%a5%e4%b8%81%e5%8c%85 aria-label=èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆéœ€è¦è¡¥ä¸åŒ…ï¼Ÿ>èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆéœ€è¦è¡¥ä¸åŒ…ï¼Ÿ</a></li><li><a href=#%e4%b8%80pnpm-patch-%e5%8e%9f%e7%94%9f%e6%b5%81%e7%a8%8b aria-label="ä¸€ã€pnpm patch åŸç”Ÿæµç¨‹">ä¸€ã€pnpm patch åŸç”Ÿæµç¨‹</a><ul><li><a href=#11-%e5%88%9b%e5%bb%ba%e8%a1%a5%e4%b8%81 aria-label="1.1 åˆ›å»ºè¡¥ä¸">1.1 åˆ›å»ºè¡¥ä¸</a></li><li><a href=#12-%e4%bf%ae%e6%94%b9%e4%bb%a3%e7%a0%81 aria-label="1.2 ä¿®æ”¹ä»£ç ">1.2 ä¿®æ”¹ä»£ç </a></li><li><a href=#13-%e6%8f%90%e4%ba%a4%e8%a1%a5%e4%b8%81 aria-label="1.3 æäº¤è¡¥ä¸">1.3 æäº¤è¡¥ä¸</a></li><li><a href=#14-%e8%a1%a5%e4%b8%81%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f aria-label="1.4 è¡¥ä¸æ–‡ä»¶æ ¼å¼">1.4 è¡¥ä¸æ–‡ä»¶æ ¼å¼</a></li></ul></li><li><a href=#%e4%ba%8cnpm-patch-package-%e5%85%bc%e5%ae%b9%e6%80%a7%e9%97%ae%e9%a2%98 aria-label="äºŒã€npm patch-package å…¼å®¹æ€§é—®é¢˜">äºŒã€npm patch-package å…¼å®¹æ€§é—®é¢˜</a><ul><li><a href=#21-%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0 aria-label="2.1 é—®é¢˜æè¿°">2.1 é—®é¢˜æè¿°</a></li><li><a href=#22-%e4%b8%a4%e7%a7%8d%e8%a1%a5%e4%b8%81%e6%a0%bc%e5%bc%8f%e7%9a%84%e5%8c%ba%e5%88%ab aria-label="2.2 ä¸¤ç§è¡¥ä¸æ ¼å¼çš„åŒºåˆ«">2.2 ä¸¤ç§è¡¥ä¸æ ¼å¼çš„åŒºåˆ«</a></li><li><a href=#23-%e7%9b%b4%e6%8e%a5%e8%bf%81%e7%a7%bb%e7%9a%84%e9%97%ae%e9%a2%98 aria-label="2.3 ç›´æ¥è¿ç§»çš„é—®é¢˜">2.3 ç›´æ¥è¿ç§»çš„é—®é¢˜</a></li></ul></li><li><a href=#%e4%b8%89%e5%85%bc%e5%ae%b9%e6%80%a7%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88 aria-label=ä¸‰ã€å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ>ä¸‰ã€å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ</a><ul><li><a href=#31-%e6%96%b9%e6%a1%88%e8%ae%be%e8%ae%a1%e6%80%9d%e8%b7%af aria-label="3.1 æ–¹æ¡ˆè®¾è®¡æ€è·¯">3.1 æ–¹æ¡ˆè®¾è®¡æ€è·¯</a></li><li><a href=#32-%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4 aria-label="3.2 å®ç°æ­¥éª¤">3.2 å®ç°æ­¥éª¤</a><ul><li><a href=#%e6%ad%a5%e9%aa%a41%e5%88%9b%e5%bb%ba%e8%a1%a5%e4%b8%81%e5%ba%94%e7%94%a8%e8%84%9a%e6%9c%ac aria-label=æ­¥éª¤1ï¼šåˆ›å»ºè¡¥ä¸åº”ç”¨è„šæœ¬>æ­¥éª¤1ï¼šåˆ›å»ºè¡¥ä¸åº”ç”¨è„šæœ¬</a></li><li><a href=#%e6%ad%a5%e9%aa%a42%e9%85%8d%e7%bd%ae-packagejson aria-label="æ­¥éª¤2ï¼šé…ç½® package.json">æ­¥éª¤2ï¼šé…ç½® package.json</a></li><li><a href=#%e6%ad%a5%e9%aa%a43%e8%a1%a5%e4%b8%81%e6%96%87%e4%bb%b6%e7%ae%a1%e7%90%86 aria-label=æ­¥éª¤3ï¼šè¡¥ä¸æ–‡ä»¶ç®¡ç†>æ­¥éª¤3ï¼šè¡¥ä¸æ–‡ä»¶ç®¡ç†</a></li></ul></li><li><a href=#33-%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b aria-label="3.3 å·¥ä½œæµç¨‹">3.3 å·¥ä½œæµç¨‹</a></li></ul></li><li><a href=#%e5%9b%9b%e5%ae%9e%e9%99%85%e6%a1%88%e4%be%8b%e8%a7%a3%e5%86%b3-initmobileui-%e5%af%bc%e5%87%ba%e9%97%ae%e9%a2%98 aria-label="å››ã€å®é™…æ¡ˆä¾‹ï¼šè§£å†³ initMobileUI å¯¼å‡ºé—®é¢˜">å››ã€å®é™…æ¡ˆä¾‹ï¼šè§£å†³ initMobileUI å¯¼å‡ºé—®é¢˜</a><ul><li><a href=#41-%e9%97%ae%e9%a2%98%e8%83%8c%e6%99%af aria-label="4.1 é—®é¢˜èƒŒæ™¯">4.1 é—®é¢˜èƒŒæ™¯</a></li><li><a href=#42-%e8%a7%a3%e5%86%b3%e8%bf%87%e7%a8%8b aria-label="4.2 è§£å†³è¿‡ç¨‹">4.2 è§£å†³è¿‡ç¨‹</a></li><li><a href=#43-%e7%b1%bb%e5%9e%8b%e5%a3%b0%e6%98%8e%e9%97%ae%e9%a2%98%e8%a7%a3%e5%86%b3 aria-label="4.3 ç±»å‹å£°æ˜é—®é¢˜è§£å†³">4.3 ç±»å‹å£°æ˜é—®é¢˜è§£å†³</a></li></ul></li><li><a href=#%e4%ba%94%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%e5%92%8c%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 aria-label=äº”ã€æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹>äº”ã€æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹</a><ul><li><a href=#51-%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5 aria-label="5.1 æœ€ä½³å®è·µ">5.1 æœ€ä½³å®è·µ</a></li><li><a href=#52-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 aria-label="5.2 æ³¨æ„äº‹é¡¹">5.2 æ³¨æ„äº‹é¡¹</a></li><li><a href=#53-%e6%95%85%e9%9a%9c%e6%8e%92%e9%99%a4 aria-label="5.3 æ•…éšœæ’é™¤">5.3 æ•…éšœæ’é™¤</a></li></ul></li><li><a href=#%e5%85%ad%e6%80%bb%e7%bb%93 aria-label=å…­ã€æ€»ç»“>å…­ã€æ€»ç»“</a></li><li><a href=#%e9%99%84%e5%bd%95%e5%ae%8c%e6%95%b4%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b aria-label=é™„å½•ï¼šå®Œæ•´ä»£ç ç¤ºä¾‹>é™„å½•ï¼šå®Œæ•´ä»£ç ç¤ºä¾‹</a><ul><li><a href=#apply-patchesjs-%e5%ae%8c%e6%95%b4%e4%bb%a3%e7%a0%81 aria-label="apply-patches.js å®Œæ•´ä»£ç ">apply-patches.js å®Œæ•´ä»£ç </a></li><li><a href=#packagejson-%e9%85%8d%e7%bd%ae%e7%a4%ba%e4%be%8b aria-label="package.json é…ç½®ç¤ºä¾‹">package.json é…ç½®ç¤ºä¾‹</a></li><li><a href=#%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84%e7%a4%ba%e4%be%8b aria-label=ç›®å½•ç»“æ„ç¤ºä¾‹>ç›®å½•ç»“æ„ç¤ºä¾‹</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>æœ¬æ–‡ä¸»è¦å¥—è·¯åœ¨<code>npm</code>è¿ç§»åˆ°<code>pnpm</code>æ—¶ï¼Œ<code>patchåŒ…</code>ä¸å…¼å®¹çš„ä¸€äº›é—®é¢˜&mldr;</p><hr><h2 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><p>åœ¨å‰ç«¯é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä¿®æ”¹ <code>node_modules</code> ä¸­ç¬¬ä¸‰æ–¹åŒ…çš„ä»£ç æ¥ä¿®å¤ bug æˆ–æ·»åŠ åŠŸèƒ½ã€‚<strong><font color=Tomato>npm ç”Ÿæ€ä¸­çš„ <code>patch-package</code> æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä½†å½“é¡¹ç›®è¿ç§»åˆ° pnpm æ—¶ï¼Œä¼šé‡åˆ°è¡¥ä¸åŒ…ä¸å…¼å®¹çš„é—®é¢˜</font></strong>ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ pnpm ç¯å¢ƒä¸‹å¤„ç†è¿™ç§å…¼å®¹æ€§é—®é¢˜ã€‚</p><p><strong>ç›¸å…³æ–‡ç« ï¼š</strong></p><ul><li><a href=/posts/frontend-develop/npm-package-patch/>ã€ŠNPMè¡¥ä¸åŒ…: patch-packageçš„ä½¿ç”¨åŠè¡¥ä¸åŒ…ç®¡ç†ã€‹</a></li></ul><h2 id=èƒŒæ™¯ä¸ºä»€ä¹ˆéœ€è¦è¡¥ä¸åŒ…>èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆéœ€è¦è¡¥ä¸åŒ…ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#èƒŒæ™¯ä¸ºä»€ä¹ˆéœ€è¦è¡¥ä¸åŒ…>#</a></h2><p>åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œéœ€è¦ä¿®æ”¹ <code>@vant/cli</code> çš„ <code>gen-package-entry.js</code> æ–‡ä»¶ï¼Œæ·»åŠ è‡ªå®šä¹‰å‡½æ•° <code>initMobileUI</code> çš„å¯¼å‡ºé€»è¾‘ã€‚è¿™ä¸ªä¿®æ”¹åœ¨æ¯æ¬¡ <code>npm install</code> åéƒ½ä¼šä¸¢å¤±ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨è¡¥ä¸åŒ…æ¥æŒä¹…åŒ–è¿™äº›ä¿®æ”¹ã€‚</p><h2 id=ä¸€pnpm-patch-åŸç”Ÿæµç¨‹>ä¸€ã€pnpm patch åŸç”Ÿæµç¨‹<a hidden class=anchor aria-hidden=true href=#ä¸€pnpm-patch-åŸç”Ÿæµç¨‹>#</a></h2><h3 id=11-åˆ›å»ºè¡¥ä¸>1.1 åˆ›å»ºè¡¥ä¸<a hidden class=anchor aria-hidden=true href=#11-åˆ›å»ºè¡¥ä¸>#</a></h3><p>pnpm æä¾›äº†åŸç”Ÿçš„è¡¥ä¸åŠŸèƒ½ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºè¡¥ä¸çš„ä¸´æ—¶å·¥ä½œç›®å½•</span>
</span></span><span style=display:flex><span>$ pnpm patch &lt;package-name@ç‰ˆæœ¬å·&gt; <span style=color:#75715e># å¦‚ï¼špnpm patch @vant/cli@5.1.0</span>
</span></span></code></pre></div><p>æ‰§è¡Œåï¼Œpnpm ä¼šè¾“å‡ºç±»ä¼¼ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>You can now edit the following folder: /private/var/folders/.../T/xxxxx
</span></span><span style=display:flex><span>Once you&#39;re done with your changes, run &#34;pnpm patch-commit &lt;path&gt;&#34;
</span></span></code></pre></div><h3 id=12-ä¿®æ”¹ä»£ç >1.2 ä¿®æ”¹ä»£ç <a hidden class=anchor aria-hidden=true href=#12-ä¿®æ”¹ä»£ç >#</a></h3><p>è¿›å…¥ä¸´æ—¶ç›®å½•ä¿®æ”¹éœ€è¦çš„æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /private/var/folders/.../T/xxxxx
</span></span><span style=display:flex><span><span style=color:#75715e># ç¼–è¾‘éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶</span>
</span></span><span style=display:flex><span>vim lib/compiler/gen-package-entry.js
</span></span></code></pre></div><p>åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œéœ€è¦æ·»åŠ ä»¥ä¸‹ä¿®æ”¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// åœ¨ genPackageEntry å‡½æ•°ä¸­æ·»åŠ 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>components</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>names</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>pascalize</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ·»åŠ å¯¹ utils çš„å¯¼å…¥ï¼Œç‰¹åˆ«æ˜¯ initMobileUI
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>utilsImport</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`import { initMobileUI } from &#39;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>getPathByName</span>(<span style=color:#e6db74>&#39;utils&#39;</span>, <span style=color:#a6e22e>pathResolver</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;;`</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>genImports</span>(<span style=color:#a6e22e>names</span>, <span style=color:#a6e22e>pathResolver</span>, <span style=color:#a6e22e>namedExport</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>utilsImport</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>// ... å…¶ä»–ä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>// åœ¨å¯¼å‡ºéƒ¨åˆ†æ·»åŠ 
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>genExports</span>(<span style=color:#a6e22e>names</span>, <span style=color:#a6e22e>pathResolver</span>, <span style=color:#a6e22e>namedExport</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>export { initMobileUI };
</span></span></span></code></pre></div><h3 id=13-æäº¤è¡¥ä¸>1.3 æäº¤è¡¥ä¸<a hidden class=anchor aria-hidden=true href=#13-æäº¤è¡¥ä¸>#</a></h3><p>ä¿®æ”¹å®Œæˆåï¼Œå›åˆ°é¡¹ç›®æ ¹ç›®å½•æäº¤è¡¥ä¸ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pnpm patch-commit <span style=color:#e6db74>&#39;/private/var/folders/.../T/xxxxx&#39;</span>
</span></span></code></pre></div><p>è¿™ä¼šåœ¨ <code>patches/</code> ç›®å½•ä¸‹ç”Ÿæˆ <code>@vant__cli@5.1.0.patch</code> æ–‡ä»¶ï¼ˆæ³¨æ„æ˜¯åŒä¸‹åˆ’çº¿ï¼‰ã€‚</p><h3 id=14-è¡¥ä¸æ–‡ä»¶æ ¼å¼>1.4 è¡¥ä¸æ–‡ä»¶æ ¼å¼<a hidden class=anchor aria-hidden=true href=#14-è¡¥ä¸æ–‡ä»¶æ ¼å¼>#</a></h3><p>pnpm ç”Ÿæˆçš„è¡¥ä¸æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>diff --git a/lib/compiler/gen-package-entry.js b/lib/compiler/gen-package-entry.js
</span></span><span style=display:flex><span>index d07e0a7..b5b9200 100644
</span></span><span style=display:flex><span><span style=color:#f92672>--- a/lib/compiler/gen-package-entry.js
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+++ b/lib/compiler/gen-package-entry.js
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span><span style=color:#75715e>@@ -47,7 +47,11 @@ export function genPackageEntry({ outputPath, pathResolver, }) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     const skipInstall = (((_b = vantConfig.build) === null || _b === void 0 ? void 0 : _b.skipInstall) || []).map(pascalize);
</span></span><span style=display:flex><span>     const version = process.env.PACKAGE_VERSION || getPackageJson().version;
</span></span><span style=display:flex><span>     const components = names.map(pascalize);
</span></span><span style=display:flex><span><span style=color:#a6e22e>+    
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+    // æ·»åŠ å¯¹ utils çš„å¯¼å…¥ï¼Œç‰¹åˆ«æ˜¯ initMobileUI
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+    const utilsImport = `import { initMobileUI } from &#39;${getPathByName(&#39;utils&#39;, pathResolver)}&#39;;`;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>     const content = `${genImports(names, pathResolver, namedExport)}
</span></span><span style=display:flex><span><span style=color:#a6e22e>+${utilsImport}
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span> 
</span></span><span style=display:flex><span> const version = &#39;${version}&#39;;
</span></span></code></pre></div><h2 id=äºŒnpm-patch-package-å…¼å®¹æ€§é—®é¢˜>äºŒã€npm patch-package å…¼å®¹æ€§é—®é¢˜<a hidden class=anchor aria-hidden=true href=#äºŒnpm-patch-package-å…¼å®¹æ€§é—®é¢˜>#</a></h2><h3 id=21-é—®é¢˜æè¿°>2.1 é—®é¢˜æè¿°<a hidden class=anchor aria-hidden=true href=#21-é—®é¢˜æè¿°>#</a></h3><p>å½“é¡¹ç›®ä» npm è¿ç§»åˆ° pnpm æ—¶ï¼ŒåŸæœ‰çš„ <code>patch-package</code> è¡¥ä¸æ–‡ä»¶ï¼ˆæ ¼å¼ä¸º <code>@vant+cli+5.1.0.patch</code>ï¼Œä½¿ç”¨åŠ å·ï¼‰æ— æ³•è¢« pnpm è¯†åˆ«å’Œåº”ç”¨ã€‚</p><h3 id=22-ä¸¤ç§è¡¥ä¸æ ¼å¼çš„åŒºåˆ«>2.2 ä¸¤ç§è¡¥ä¸æ ¼å¼çš„åŒºåˆ«<a hidden class=anchor aria-hidden=true href=#22-ä¸¤ç§è¡¥ä¸æ ¼å¼çš„åŒºåˆ«>#</a></h3><table><thead><tr><th>ç‰¹æ€§</th><th>npm (patch-package)</th><th>pnpm (åŸç”Ÿ)</th></tr></thead><tbody><tr><td>æ–‡ä»¶å‘½å</td><td><code>@vant+cli+5.1.0.patch</code></td><td><code>@vant__cli@5.1.0.patch</code></td></tr><tr><td>åˆ†éš”ç¬¦</td><td>åŠ å· <code>+</code></td><td>åŒä¸‹åˆ’çº¿ <code>__</code></td></tr><tr><td>åº”ç”¨æ—¶æœº</td><td>æ‰‹åŠ¨æˆ– postinstall</td><td>è‡ªåŠ¨åº”ç”¨</td></tr><tr><td>è·¯å¾„å‰ç¼€</td><td><code>node_modules/</code></td><td>ç›¸å¯¹è·¯å¾„</td></tr></tbody></table><h3 id=23-ç›´æ¥è¿ç§»çš„é—®é¢˜>2.3 ç›´æ¥è¿ç§»çš„é—®é¢˜<a hidden class=anchor aria-hidden=true href=#23-ç›´æ¥è¿ç§»çš„é—®é¢˜>#</a></h3><p>å¦‚æœç›´æ¥ä½¿ç”¨ pnpmï¼ŒåŸæœ‰çš„å†å²è¡¥ä¸æ–‡ä»¶å°†æ— æ³•åº”ç”¨ï¼Œå¯¼è‡´ï¼š</p><ul><li>å†å²åŠŸèƒ½ä¿®æ”¹ä¸¢å¤±</li><li>éœ€è¦é‡æ–°åˆ›å»ºæ‰€æœ‰è¡¥ä¸</li><li>å¯èƒ½å½±å“é¡¹ç›®çš„æ­£å¸¸è¿è¡Œ</li></ul><h2 id=ä¸‰å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ>ä¸‰ã€å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ<a hidden class=anchor aria-hidden=true href=#ä¸‰å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ>#</a></h2><h3 id=31-æ–¹æ¡ˆè®¾è®¡æ€è·¯>3.1 æ–¹æ¡ˆè®¾è®¡æ€è·¯<a hidden class=anchor aria-hidden=true href=#31-æ–¹æ¡ˆè®¾è®¡æ€è·¯>#</a></h3><p>ä¸ºäº†åŒæ—¶æ”¯æŒå†å²è¡¥ä¸å’Œæ–°çš„ pnpm è¡¥ä¸ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†æ··åˆæ–¹æ¡ˆï¼š</p><ol><li><strong>pnpm åŸç”Ÿè¡¥ä¸</strong>ï¼šå¤„ç†æ–°çš„ä¿®æ”¹ï¼ˆå¦‚ <code>initMobileUI</code> å¯¼å‡ºï¼‰</li><li><strong>è‡ªå®šä¹‰è„šæœ¬</strong>ï¼šåº”ç”¨å†å²çš„ npm è¡¥ä¸æ–‡ä»¶</li><li><strong>postinstall é’©å­</strong>ï¼šç¡®ä¿è¡¥ä¸åœ¨ä¾èµ–å®‰è£…åè‡ªåŠ¨åº”ç”¨</li></ol><h3 id=32-å®ç°æ­¥éª¤>3.2 å®ç°æ­¥éª¤<a hidden class=anchor aria-hidden=true href=#32-å®ç°æ­¥éª¤>#</a></h3><h4 id=æ­¥éª¤1åˆ›å»ºè¡¥ä¸åº”ç”¨è„šæœ¬>æ­¥éª¤1ï¼šåˆ›å»ºè¡¥ä¸åº”ç”¨è„šæœ¬<a hidden class=anchor aria-hidden=true href=#æ­¥éª¤1åˆ›å»ºè¡¥ä¸åº”ç”¨è„šæœ¬>#</a></h4><p>åˆ›å»º <code>apply-patches.js</code> æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>execSync</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;child_process&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;åº”ç”¨è‡ªå®šä¹‰è¡¥ä¸...&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// åº”ç”¨å†å²çš„ npm è¡¥ä¸æ–‡ä»¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;åº”ç”¨ vant-cli å†å²è¡¥ä¸...&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>execSync</span>(<span style=color:#e6db74>&#39;patch -p1 -i patches/@vant+cli+5.1.0.patch --forward --reject-file=-&#39;</span>, { 
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>stdio</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;inherit&#39;</span> 
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;è¡¥ä¸å¯èƒ½å·²ç»åº”ç”¨è¿‡ï¼Œç»§ç»­æ‰§è¡Œ...&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;âœ… è¡¥ä¸åº”ç”¨å®Œæˆ&#39;</span>);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;âŒ è¡¥ä¸åº”ç”¨å¤±è´¥:&#39;</span>, <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=æ­¥éª¤2é…ç½®-packagejson>æ­¥éª¤2ï¼šé…ç½® package.json<a hidden class=anchor aria-hidden=true href=#æ­¥éª¤2é…ç½®-packagejson>#</a></h4><p>åœ¨ <code>package.json</code> ä¸­æ·»åŠ ç›¸å…³è„šæœ¬ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;scripts&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;patch&#34;</span>: <span style=color:#e6db74>&#34;node apply-patches.js&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;postinstall&#34;</span>: <span style=color:#e6db74>&#34;node apply-patches.js&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=æ­¥éª¤3è¡¥ä¸æ–‡ä»¶ç®¡ç†>æ­¥éª¤3ï¼šè¡¥ä¸æ–‡ä»¶ç®¡ç†<a hidden class=anchor aria-hidden=true href=#æ­¥éª¤3è¡¥ä¸æ–‡ä»¶ç®¡ç†>#</a></h4><p>é¡¹ç›®ä¸­ä¼šåŒæ—¶å­˜åœ¨ä¸¤ç§è¡¥ä¸æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>patches/
</span></span><span style=display:flex><span>â”œâ”€â”€ @vant+cli+5.1.0.patch      # npm æ ¼å¼ï¼ŒåŒ…å«å†å²ä¿®æ”¹
</span></span><span style=display:flex><span>â””â”€â”€ @vant__cli@5.1.0.patch     # pnpm æ ¼å¼ï¼ŒåŒ…å«æ–°ä¿®æ”¹
</span></span></code></pre></div><h3 id=33-å·¥ä½œæµç¨‹>3.3 å·¥ä½œæµç¨‹<a hidden class=anchor aria-hidden=true href=#33-å·¥ä½œæµç¨‹>#</a></h3><p>å®Œæ•´çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. å®‰è£…ä¾èµ–</span>
</span></span><span style=display:flex><span>pnpm install
</span></span><span style=display:flex><span><span style=color:#75715e># â†’ pnpm è‡ªåŠ¨åº”ç”¨ @vant__cli@5.1.0.patch</span>
</span></span><span style=display:flex><span><span style=color:#75715e># â†’ postinstall é’©å­æ‰§è¡Œ apply-patches.js</span>
</span></span><span style=display:flex><span><span style=color:#75715e># â†’ è„šæœ¬åº”ç”¨ @vant+cli+5.1.0.patch</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. æ„å»ºé¡¹ç›®</span>
</span></span><span style=display:flex><span>npm run build
</span></span><span style=display:flex><span><span style=color:#75715e># â†’ æ‰€æœ‰è¡¥ä¸éƒ½å·²ç”Ÿæ•ˆï¼Œæ„å»ºæˆåŠŸ</span>
</span></span></code></pre></div><h2 id=å››å®é™…æ¡ˆä¾‹è§£å†³-initmobileui-å¯¼å‡ºé—®é¢˜>å››ã€å®é™…æ¡ˆä¾‹ï¼šè§£å†³ initMobileUI å¯¼å‡ºé—®é¢˜<a hidden class=anchor aria-hidden=true href=#å››å®é™…æ¡ˆä¾‹è§£å†³-initmobileui-å¯¼å‡ºé—®é¢˜>#</a></h2><h3 id=41-é—®é¢˜èƒŒæ™¯>4.1 é—®é¢˜èƒŒæ™¯<a hidden class=anchor aria-hidden=true href=#41-é—®é¢˜èƒŒæ™¯>#</a></h3><p>æˆ‘ä»¬éœ€è¦åœ¨ <code>@vant/cli</code> çš„æ„å»ºäº§ç‰©ä¸­å¯¼å‡ºè‡ªå®šä¹‰çš„ <code>initMobileUI</code> å‡½æ•°ï¼Œä½†è¯¥å‡½æ•°åœ¨æ¯æ¬¡æ„å»ºåéƒ½ä¼šä¸¢å¤±ã€‚</p><h3 id=42-è§£å†³è¿‡ç¨‹>4.2 è§£å†³è¿‡ç¨‹<a hidden class=anchor aria-hidden=true href=#42-è§£å†³è¿‡ç¨‹>#</a></h3><ol><li><p><strong>åˆ›å»º pnpm è¡¥ä¸</strong>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pnpm patch @vant/cli@5.1.0
</span></span><span style=display:flex><span><span style=color:#75715e># ä¿®æ”¹ gen-package-entry.js æ·»åŠ  initMobileUI å¯¼å‡ºé€»è¾‘</span>
</span></span><span style=display:flex><span>pnpm patch-commit <span style=color:#e6db74>&#39;/path/to/temp/dir&#39;</span>
</span></span></code></pre></div></li><li><p><strong>ä¿ç•™å†å²è¡¥ä¸</strong>ï¼š</p><ul><li>ä¿æŒåŸæœ‰çš„ <code>@vant+cli+5.1.0.patch</code> æ–‡ä»¶</li><li>é€šè¿‡ <code>apply-patches.js</code> è„šæœ¬åº”ç”¨</li></ul></li><li><p><strong>éªŒè¯ç»“æœ</strong>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æ„å»ºäº§ç‰©</span>
</span></span><span style=display:flex><span>grep -n <span style=color:#e6db74>&#34;initMobileUI&#34;</span> es/index.js lib/index.js
</span></span><span style=display:flex><span><span style=color:#75715e># è¾“å‡ºï¼š</span>
</span></span><span style=display:flex><span><span style=color:#75715e># es/index.js:110:import { initMobileUI } from &#34;./utils&#34;;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># es/index.js:348:  initMobileUI,</span>
</span></span><span style=display:flex><span><span style=color:#75715e># lib/index.js:22:  initMobileUI: () =&gt; import_utils.initMobileUI,</span>
</span></span></code></pre></div></li></ol><h3 id=43-ç±»å‹å£°æ˜é—®é¢˜è§£å†³>4.3 ç±»å‹å£°æ˜é—®é¢˜è§£å†³<a hidden class=anchor aria-hidden=true href=#43-ç±»å‹å£°æ˜é—®é¢˜è§£å†³>#</a></h3><p>åœ¨è¿ç§»è¿‡ç¨‹ä¸­è¿˜é‡åˆ°äº† TypeScript ç±»å‹å£°æ˜é—®é¢˜ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># é”™è¯¯ï¼šCannot find name &#39;process&#39;. Do you need to install type definitions for node?</span>
</span></span><span style=display:flex><span><span style=color:#75715e># è§£å†³ï¼šå®‰è£…ç±»å‹å®šä¹‰</span>
</span></span><span style=display:flex><span>pnpm add -D @types/node
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é”™è¯¯ï¼šCannot find module &#39;postcss&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># è§£å†³ï¼šå®‰è£…ä¾èµ–</span>
</span></span><span style=display:flex><span>pnpm add -D postcss
</span></span></code></pre></div><h2 id=äº”æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹>äº”ã€æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹<a hidden class=anchor aria-hidden=true href=#äº”æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹>#</a></h2><h3 id=51-æœ€ä½³å®è·µ>5.1 æœ€ä½³å®è·µ<a hidden class=anchor aria-hidden=true href=#51-æœ€ä½³å®è·µ>#</a></h3><ol><li><p><strong>è¡¥ä¸æ–‡ä»¶åˆ†ç¦»</strong>ï¼š</p><ul><li>æ–°åŠŸèƒ½ä½¿ç”¨ pnpm åŸç”Ÿè¡¥ä¸</li><li>å†å²ä¿®æ”¹ä¿æŒ npm æ ¼å¼è¡¥ä¸</li><li>é€šè¿‡è„šæœ¬ç»Ÿä¸€ç®¡ç†</li></ul></li><li><p><strong>è‡ªåŠ¨åŒ–åº”ç”¨</strong>ï¼š</p><ul><li>ä½¿ç”¨ postinstall é’©å­ç¡®ä¿è¡¥ä¸è‡ªåŠ¨åº”ç”¨</li><li>è„šæœ¬ä¸­æ·»åŠ é”™è¯¯å¤„ç†ï¼Œé¿å…é‡å¤åº”ç”¨</li></ul></li><li><p><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼š</p><ul><li>å°†è¡¥ä¸æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶</li><li>è¡¥ä¸è„šæœ¬ä¹Ÿè¦çº³å…¥ç‰ˆæœ¬æ§åˆ¶</li></ul></li></ol><h3 id=52-æ³¨æ„äº‹é¡¹>5.2 æ³¨æ„äº‹é¡¹<a hidden class=anchor aria-hidden=true href=#52-æ³¨æ„äº‹é¡¹>#</a></h3><ol><li><p><strong>è¡¥ä¸å†²çª</strong>ï¼š</p><ul><li>æ³¨æ„ä¸¤ç§è¡¥ä¸æ–‡ä»¶ä¸è¦ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€éƒ¨åˆ†</li><li>å¦‚æœ‰å†²çªï¼Œä¼˜å…ˆä½¿ç”¨ pnpm åŸç”Ÿè¡¥ä¸</li></ul></li><li><p><strong>è·¯å¾„é—®é¢˜</strong>ï¼š</p><ul><li>npm è¡¥ä¸ä½¿ç”¨ <code>node_modules/</code> å‰ç¼€</li><li>pnpm è¡¥ä¸ä½¿ç”¨ç›¸å¯¹è·¯å¾„</li></ul></li><li><p><strong>é”™è¯¯å¤„ç†</strong>ï¼š</p><ul><li>è¡¥ä¸åº”ç”¨å¤±è´¥æ—¶ä¸è¦ä¸­æ–­æ•´ä¸ªæ„å»ºè¿‡ç¨‹</li><li>æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®</li></ul></li></ol><h3 id=53-æ•…éšœæ’é™¤>5.3 æ•…éšœæ’é™¤<a hidden class=anchor aria-hidden=true href=#53-æ•…éšœæ’é™¤>#</a></h3><p>å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># é—®é¢˜1ï¼šè¡¥ä¸æ–‡ä»¶æ ¼å¼é”™è¯¯</span>
</span></span><span style=display:flex><span><span style=color:#75715e># è§£å†³ï¼šæ£€æŸ¥è¡¥ä¸æ–‡ä»¶çš„è·¯å¾„å‰ç¼€å’Œæ ¼å¼</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é—®é¢˜2ï¼šè¡¥ä¸å·²ç»åº”ç”¨è¿‡</span>
</span></span><span style=display:flex><span><span style=color:#75715e># è§£å†³ï¼šä½¿ç”¨ --forward å‚æ•°å¿½ç•¥å·²åº”ç”¨çš„è¡¥ä¸</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é—®é¢˜3ï¼šæƒé™é—®é¢˜</span>
</span></span><span style=display:flex><span><span style=color:#75715e># è§£å†³ï¼šç¡®ä¿å¯¹ node_modules æœ‰å†™æƒé™</span>
</span></span></code></pre></div><h2 id=å…­æ€»ç»“>å…­ã€æ€»ç»“<a hidden class=anchor aria-hidden=true href=#å…­æ€»ç»“>#</a></h2><p>é€šè¿‡æœ¬æ–‡ä»‹ç»çš„æ··åˆæ–¹æ¡ˆï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†ä» npm åˆ° pnpm è¿ç§»è¿‡ç¨‹ä¸­çš„è¡¥ä¸åŒ…å…¼å®¹æ€§é—®é¢˜ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿åœ¨äºï¼š</p><ol><li><strong>å‘åå…¼å®¹</strong>ï¼šä¿æŒå†å²è¡¥ä¸çš„æœ‰æ•ˆæ€§</li><li><strong>å‘å‰å‘å±•</strong>ï¼šåˆ©ç”¨ pnpm çš„åŸç”Ÿè¡¥ä¸åŠŸèƒ½</li><li><strong>è‡ªåŠ¨åŒ–</strong>ï¼šé€šè¿‡è„šæœ¬å’Œé’©å­å®ç°è‡ªåŠ¨åº”ç”¨</li><li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šæ¸…æ™°çš„æ–‡ä»¶ç»“æ„å’Œé”™è¯¯å¤„ç†</li></ol><p>è¿™ç§æ–¹æ³•ä¸ä»…é€‚ç”¨äº <code>@vant/cli</code> çš„ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥æ¨å¹¿åˆ°å…¶ä»–éœ€è¦è¡¥ä¸åŒ…çš„åœºæ™¯ä¸­ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå»ºè®®æ ¹æ®å…·ä½“éœ€æ±‚è°ƒæ•´è„šæœ¬é€»è¾‘ï¼Œä½†æ ¸å¿ƒæ€è·¯ä¿æŒä¸å˜ã€‚</p><p>å¸Œæœ›è¿™ä¸ªæ–¹æ¡ˆèƒ½å¸®åŠ©åˆ°å…¶ä»–é‡åˆ°ç±»ä¼¼é—®é¢˜çš„å¼€å‘è€…ï¼Œè®©é¡¹ç›®è¿ç§»è¿‡ç¨‹æ›´åŠ é¡ºç•…ã€‚</p><hr><h2 id=é™„å½•å®Œæ•´ä»£ç ç¤ºä¾‹>é™„å½•ï¼šå®Œæ•´ä»£ç ç¤ºä¾‹<a hidden class=anchor aria-hidden=true href=#é™„å½•å®Œæ•´ä»£ç ç¤ºä¾‹>#</a></h2><h3 id=apply-patchesjs-å®Œæ•´ä»£ç >apply-patches.js å®Œæ•´ä»£ç <a hidden class=anchor aria-hidden=true href=#apply-patchesjs-å®Œæ•´ä»£ç >#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>execSync</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;child_process&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;åº”ç”¨è‡ªå®šä¹‰è¡¥ä¸...&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 1. åº”ç”¨åŸæœ‰çš„è¡¥ä¸æ–‡ä»¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;åº”ç”¨ vant-cli å†å²è¡¥ä¸...&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>execSync</span>(<span style=color:#e6db74>&#39;patch -p1 -i patches/@vant+cli+5.1.0.patch --forward --reject-file=-&#39;</span>, { 
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>stdio</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;inherit&#39;</span> 
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;è¡¥ä¸å¯èƒ½å·²ç»åº”ç”¨è¿‡ï¼Œç»§ç»­æ‰§è¡Œ...&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;âœ… è¡¥ä¸åº”ç”¨å®Œæˆ&#39;</span>);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;âŒ è¡¥ä¸åº”ç”¨å¤±è´¥:&#39;</span>, <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=packagejson-é…ç½®ç¤ºä¾‹>package.json é…ç½®ç¤ºä¾‹<a hidden class=anchor aria-hidden=true href=#packagejson-é…ç½®ç¤ºä¾‹>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;@zto/mzui&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;v3.12.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;scripts&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;patch&#34;</span>: <span style=color:#e6db74>&#34;node apply-patches.js&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;postinstall&#34;</span>: <span style=color:#e6db74>&#34;node apply-patches.js&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;build&#34;</span>: <span style=color:#e6db74>&#34;vant-cli build &amp;&amp; npm run build:rem&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;build:rem&#34;</span>: <span style=color:#e6db74>&#34;node ./build-rem.js&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;devDependencies&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;@types/node&#34;</span>: <span style=color:#e6db74>&#34;^24.0.14&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;postcss&#34;</span>: <span style=color:#e6db74>&#34;^8.5.6&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;patch-package&#34;</span>: <span style=color:#e6db74>&#34;^6.4.7&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=ç›®å½•ç»“æ„ç¤ºä¾‹>ç›®å½•ç»“æ„ç¤ºä¾‹<a hidden class=anchor aria-hidden=true href=#ç›®å½•ç»“æ„ç¤ºä¾‹>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>project/
</span></span><span style=display:flex><span>â”œâ”€â”€ patches/
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ @vant+cli+5.1.0.patch      <span style=color:#75715e># npm æ ¼å¼è¡¥ä¸</span>
</span></span><span style=display:flex><span>â”‚   â””â”€â”€ @vant__cli@5.1.0.patch     <span style=color:#75715e># pnpm æ ¼å¼è¡¥ä¸</span>
</span></span><span style=display:flex><span>â”œâ”€â”€ apply-patches.js                <span style=color:#75715e># è¡¥ä¸åº”ç”¨è„šæœ¬</span>
</span></span><span style=display:flex><span>â”œâ”€â”€ package.json                    <span style=color:#75715e># é¡¹ç›®é…ç½®</span>
</span></span><span style=display:flex><span>â””â”€â”€ src/
</span></span><span style=display:flex><span>    â””â”€â”€ utils/
</span></span><span style=display:flex><span>        â””â”€â”€ global-config.ts        <span style=color:#75715e># initMobileUI å‡½æ•°å®šä¹‰</span>
</span></span></code></pre></div><hr><p><strong>æœ€åï¼Œ å¸Œæœ›å¤§å®¶æ—©æ—¥å®ç°ï¼šæˆä¸ºç¼–ç¨‹é«˜æ‰‹çš„ä¼Ÿå¤§æ¢¦æƒ³ï¼</strong><br><strong>æ¬¢è¿äº¤æµ~</strong></p><img src=/img-common/weChatPublic.jpg alt=å¾®ä¿¡å…¬ä¼—å· width=600 height=286><p><strong>æœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ›œçµæ‰€æœ‰ï¼æœªç»å…è®¸ï¼Œä¸¥ç¦è½¬è½½ï¼å¯¹éæ³•è½¬è½½è€…, åŸä½œè€…ä¿ç•™é‡‡ç”¨æ³•å¾‹æ‰‹æ®µè¿½ç©¶çš„æƒåˆ©ï¼</strong><br><strong>è‹¥éœ€è½¬è½½ï¼Œè¯·è”ç³»å¾®ä¿¡å…¬ä¼—å·ï¼šè¿å…ˆç”Ÿæœ‰çŒ«ç—…ï¼Œå¯è·å–ä½œè€…è”ç³»æ–¹å¼ï¼</strong></p></div><footer class=post-footer><nav class=paginav><a class=next href=https://lianpf.github.io/posts/other/google-gemini-cli-use/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>AIï¼šGoogle Gemini Cli</span></a></nav></footer></div></article></main><footer class=footer><span>Copyright
&copy;
2016-2025
<a href=https://lianpf.github.io/ style=color:#939393>æ›œçµï¼ˆSUNï¼‰Site</a>.
åŸºäº Hugo å¼•æ“å’Œ PaperMod ä¸»é¢˜</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href,s=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>