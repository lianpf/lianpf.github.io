<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Node: Apræ¡†æ¶å¼€å‘ | æ›œçµï¼ˆSUNï¼‰Site</title><meta name=keywords content="Node,npm"><meta name=description content="åœ¨ä½ä»£ç å¹³å°å¼€å‘è¿‡ç¨‹ï¼Œç”±äºç‰©æ–™ç®¡ç†ç³»ç»Ÿä»¥åŠNode Server ä¸­é—´å±‚çš„æ­å»ºä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¾ˆå¤šé€šç”¨çš„åº“å’Œé…ç½®å¯ä»¥&mldr;"><meta name=author content="æ›œçµ"><link rel=canonical href=https://lianpf.github.io/posts/backend-develop/11.apr-framework-develop/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lianpf.github.io/img-common/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://lianpf.github.io/img-common/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://lianpf.github.io/img-common/favicon.png><link rel=apple-touch-icon href=https://lianpf.github.io/img-common/avatar.jpeg><link rel=mask-icon href=https://lianpf.github.io/img-common/avatar.jpeg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="Node: Apræ¡†æ¶å¼€å‘"><meta property="og:description" content="åœ¨ä½ä»£ç å¹³å°å¼€å‘è¿‡ç¨‹ï¼Œç”±äºç‰©æ–™ç®¡ç†ç³»ç»Ÿä»¥åŠNode Server ä¸­é—´å±‚çš„æ­å»ºä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¾ˆå¤šé€šç”¨çš„åº“å’Œé…ç½®å¯ä»¥&mldr;"><meta property="og:type" content="article"><meta property="og:url" content="https://lianpf.github.io/posts/backend-develop/11.apr-framework-develop/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-12T17:37:09+08:00"><meta property="article:modified_time" content="2021-04-12T17:37:09+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Node: Apræ¡†æ¶å¼€å‘"><meta name=twitter:description content="åœ¨ä½ä»£ç å¹³å°å¼€å‘è¿‡ç¨‹ï¼Œç”±äºç‰©æ–™ç®¡ç†ç³»ç»Ÿä»¥åŠNode Server ä¸­é—´å±‚çš„æ­å»ºä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¾ˆå¤šé€šç”¨çš„åº“å’Œé…ç½®å¯ä»¥&mldr;"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://lianpf.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ§± åç«¯å¼€å‘","item":"https://lianpf.github.io/posts/backend-develop/"},{"@type":"ListItem","position":3,"name":"Node: Apræ¡†æ¶å¼€å‘","item":"https://lianpf.github.io/posts/backend-develop/11.apr-framework-develop/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Node: Apræ¡†æ¶å¼€å‘","name":"Node: Apræ¡†æ¶å¼€å‘","description":"åœ¨ä½ä»£ç å¹³å°å¼€å‘è¿‡ç¨‹ï¼Œç”±äºç‰©æ–™ç®¡ç†ç³»ç»Ÿä»¥åŠNode Server ä¸­é—´å±‚çš„æ­å»ºä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¾ˆå¤šé€šç”¨çš„åº“å’Œé…ç½®å¯ä»¥\u0026hellip;\n","keywords":["Node","npm"],"articleBody":"åœ¨ä½ä»£ç å¹³å°å¼€å‘è¿‡ç¨‹ï¼Œç”±äºç‰©æ–™ç®¡ç†ç³»ç»Ÿä»¥åŠNode Server ä¸­é—´å±‚çš„æ­å»ºä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¾ˆå¤šé€šç”¨çš„åº“å’Œé…ç½®å¯ä»¥â€¦\nä¸€ã€èƒŒæ™¯ åœ¨ä½ä»£ç å¹³å°å¼€å‘è¿‡ç¨‹ï¼Œç”±äºç‰©æ–™ç®¡ç†ç³»ç»Ÿä»¥åŠNode Server ä¸­é—´å±‚çš„æ­å»ºä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¾ˆå¤šé€šç”¨çš„åº“å’Œé…ç½®å¯ä»¥æ²‰æ·€ï¼Œå½¢æˆå¯å¤åˆ¶çš„è§£å†³æ–¹æ¡ˆã€‚æ‰€ä»¥ï¼ŒåŸºäºå¼€æºæ¡†æ¶Egg.jsï¼ˆåŸºäºKoa2ï¼‰è¿›è¡Œäº†æ‹“å±•å°è£…å½¢æˆäº†åˆç‰ˆAprã€‚\næ•´ä¸ªå›¢é˜Ÿä¾èµ–åˆç‰ˆAprä½œä¸ºç»Ÿä¸€çš„Nodeæ–¹æ¡ˆï¼Œéšç€ä¸šåŠ¡åœºæ™¯è¶Šæ¥è¶Šä¸°å¯Œï¼Œä¸€äº›æ’ä»¶ã€middleç­‰å…¬å…±é…ç½®æˆä¸ºæœ€ä½³å®è·µåï¼Œé€æ¸ä¸‹æ²‰åˆ°Apræ¡†æ¶ä¸­ï¼Œè®©Aprè¶Šæ¥è¶Šæˆç†Ÿã€‚è€Œåï¼Œä¾èµ–Aprçš„å…¶ä»–é¡¹ç›®ä»…éœ€ç®€å•çš„å‡çº§ä¸‹æ¡†æ¶çš„ç‰ˆæœ¬å³å¯äº«å—åˆ°Aprå¸¦æ¥çš„çº¢åˆ©ã€‚\nå¦‚æœä½ çš„å›¢é˜Ÿä¹Ÿåœ¨è€ƒè™‘æ­å»ºç±»ä¼¼çš„æ¡†æ¶ï¼Œé‚£ä¹ˆè¯·è€ƒè™‘å¦‚ä¸‹é—®é¢˜ï¼š\nå¦‚æœä½ çš„å›¢é˜Ÿé‡åˆ°è¿‡ï¼š ç»´æŠ¤å¾ˆå¤šä¸ªé¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½éœ€è¦å¤åˆ¶æ‹·è´è¯¸å¦‚ gulpfile.js / webpack.config.js ä¹‹ç±»çš„æ–‡ä»¶ æ¯ä¸ªé¡¹ç›®éƒ½éœ€è¦ä½¿ç”¨ä¸€äº›ç›¸åŒçš„ç±»åº“ï¼Œç›¸åŒçš„é…ç½® åœ¨æ–°é¡¹ç›®ä¸­å¯¹ä¸Šé¢çš„é…ç½®åšäº†ä¸€ä¸ªä¼˜åŒ–åï¼Œå¦‚ä½•åŒæ­¥åˆ°å…¶ä»–é¡¹ç›®ï¼Ÿ å¦‚æœä½ çš„å›¢é˜Ÿéœ€è¦ï¼š ç»Ÿä¸€çš„æŠ€æœ¯é€‰å‹ï¼Œæ¯”å¦‚æ•°æ®åº“ã€æ¨¡æ¿ã€å‰ç«¯æ¡†æ¶åŠå„ç§ä¸­é—´ä»¶è®¾æ–½éƒ½éœ€è¦é€‰å‹ï¼Œè€Œæ¡†æ¶å°è£…åä¿è¯åº”ç”¨ä½¿ç”¨ä¸€å¥—æ¶æ„ ç»Ÿä¸€çš„é»˜è®¤é…ç½®ï¼Œå¼€æºç¤¾åŒºçš„é…ç½®å¯èƒ½ä¸é€‚ç”¨äºå…¬å¸ï¼Œè€Œåˆä¸å¸Œæœ›åº”ç”¨å»é…ç½® ç»Ÿä¸€çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œé€šè¿‡æ¡†æ¶å’Œå¹³å°çš„åŒå‘æ§åˆ¶ï¼Œåº”ç”¨åªéœ€è¦å…³æ³¨è‡ªå·±çš„ä»£ç ï¼Œå…·ä½“æŸ¥çœ‹åº”ç”¨éƒ¨ç½² ç»Ÿä¸€çš„ä»£ç é£æ ¼ï¼Œæ¡†æ¶ä¸ä»…ä»…è§£å†³ä»£ç é‡ç”¨é—®é¢˜ï¼Œè¿˜å¯ä»¥å¯¹åº”ç”¨åšä¸€å®šçº¦æŸï¼Œä½œä¸ºä¼ä¸šæ¡†æ¶æ˜¯å¾ˆå¿…è¦çš„ã€‚Aprä¾èµ–äº Egg, Egg åœ¨ Koa åŸºç¡€ä¸Šåšäº†å¾ˆå¤šçº¦å®šï¼Œæ¡†æ¶å¯ä»¥ä½¿ç”¨ Loader è‡ªå·±å®šä¹‰ä»£ç è§„åˆ™ å¦‚æœéœ€è¦ï¼Œä»¥ä¸‹æ˜¯Aprçš„ç®€æ˜“ç‰ˆæ­å»ºè¿‡ç¨‹ï¼Œä¹Ÿè®¸å¯¹ä½ æœ‰æ‰€å¸®åŠ©:\nç¨³å®šæˆç†Ÿç‰ˆæ¶‰åŠåˆ°å…¬å¸ç›¸å…³ä¸šåŠ¡ï¼Œæ•…ä»…å­˜å†…ç½‘ä¸­ï¼Œä¸å¯¹å¤–æš´éœ²ï¼Œè¯·å‹¿ç§èŠè·å–\näºŒã€æ¡†æ¶ä¸å¤šè¿›ç¨‹ æ¡†æ¶çš„æ‰©å±•æ˜¯å’Œå¤šè¿›ç¨‹æ¨¡å‹æœ‰å…³çš„ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“å¤šè¿›ç¨‹æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦æ‰©å±•çš„ç±»æœ‰ Agent å’Œ Applicationã€‚\nåœ¨ Agent Worker å¯åŠ¨çš„æ—¶å€™ä¼šå®ä¾‹åŒ– Agentï¼Œè€Œåœ¨ App Worker å¯åŠ¨æ—¶ä¼šå®ä¾‹åŒ– Applicationï¼Œè¿™ä¸¤ä¸ªç±»åˆåŒæ—¶ç»§æ‰¿ EggCoreã€‚\nEggCore å¯ä»¥çœ‹åš Koa Application çš„å‡çº§ç‰ˆï¼Œé»˜è®¤å†…ç½® Loaderã€Router åŠåº”ç”¨å¼‚æ­¥å¯åŠ¨ç­‰åŠŸèƒ½ï¼Œå¯ä»¥çœ‹åšæ˜¯æ”¯æŒ Loader çš„ Koaã€‚ è€Œæˆ‘ä»¬è¦æ­å»ºçš„Apråˆ™ä¾èµ–äºEggCoreã€‚\nKoa Application ^ EggCore ^ AprCore ^ â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ Apr Agent Apr Application ^ ^ agent worker app worker ä¸‰ã€å®šåˆ¶æ¡†æ¶: Apr 1. create Apr \u0026 init $ mkdir apr \u0026\u0026 cd apr $ npm init egg --type=framework $ npm i $ npm test 2. æ¡†æ¶ç»§æ‰¿ æ¡†æ¶æ”¯æŒç»§æ‰¿å…³ç³»ï¼Œå¯ä»¥æŠŠæ¡†æ¶æ¯”ä½œä¸€ä¸ªç±»ï¼ŒåŸºç±»æ˜¯ Egg æ¡†æ¶ï¼Œå®šä¹‰ä¸€ä¸ªæ¡†æ¶éœ€è¦ç»§æ‰¿äºEggä¸”å®ç° Egg æ‰€æœ‰çš„ APIã€‚\n// package.json { \"name\": \"apr\", \"dependencies\": { \"egg\": \"^2.0.0\" } } // index.js module.exports = require('./lib/framework.js'); // lib/framework.js const path = require('path'); const egg = require('egg'); const EGG_PATH = Symbol.for('egg#eggPath'); class Application extends egg.Application { get [EGG_PATH]() { // è¿”å› framework è·¯å¾„ return path.dirname(__dirname); } } // è¦†ç›–äº† Egg çš„ Application module.exports = Object.assign(egg, { Application, }); åº”ç”¨å¯åŠ¨æ—¶éœ€è¦æŒ‡å®šæ¡†æ¶åï¼ˆåœ¨ package.json æŒ‡å®š egg.frameworkï¼Œé»˜è®¤ä¸º eggï¼‰ï¼ŒLoader å°†ä» node_modules æ‰¾æŒ‡å®šæ¨¡å—ä½œä¸ºæ¡†æ¶ï¼Œå¹¶åŠ è½½å…¶ export çš„ Application\n{ \"scripts\": { \"dev\": \"egg-bin dev\" }, \"egg\": { \"framework\": \"apr\" } } ç°åœ¨ apr æ¡†æ¶ç›®å½•å·²ç»æ˜¯ä¸€ä¸ª loadUnitï¼Œé‚£ä¹ˆç›¸åº”ç›®å½•å’Œæ–‡ä»¶ï¼ˆå¦‚ app å’Œ configï¼‰éƒ½ä¼šè¢«åŠ è½½\n3. è‡ªå®šä¹‰ Agent ä¸Šé¢çš„ä¾‹å­è‡ªå®šä¹‰äº† Applicationï¼Œå› ä¸º Egg æ˜¯å¤šè¿›ç¨‹æ¨¡å‹ï¼Œæ‰€ä»¥è¿˜éœ€è¦å®šä¹‰ Agentï¼ŒåŸç†æ˜¯ä¸€æ ·çš„\n// lib/framework.js const path = require('path'); const egg = require('egg'); const EGG_PATH = Symbol.for('egg#eggPath'); class Application extends egg.Application { get [EGG_PATH]() { // è¿”å› framework è·¯å¾„ return path.dirname(__dirname); } } class Agent extends egg.Agent { get [EGG_PATH]() { return path.dirname(__dirname); } } // è¦†ç›–äº† Egg çš„ Application module.exports = Object.assign(egg, { Application, Agent, }); ä½†å› ä¸º Agent å’Œ Application æ˜¯ä¸¤ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥ API æœ‰å¯èƒ½ä¸ä¸€è‡´\n4. è‡ªå®šä¹‰ Loader Loader åº”ç”¨å¯åŠ¨çš„æ ¸å¿ƒï¼Œä½¿ç”¨å®ƒè¿˜èƒ½è§„èŒƒåº”ç”¨ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºè¿™ä¸ªç±»æ‰©å±•æ›´å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚åŠ è½½æ•°æ®ä»£ç ã€‚\næ‰©å±• Loader è¿˜èƒ½è¦†ç›–é»˜è®¤çš„å®ç°ï¼Œæˆ–è°ƒæ•´ç°æœ‰çš„åŠ è½½é¡ºåºç­‰\nè‡ªå®šä¹‰ Loader ä¹Ÿæ˜¯ç”¨ Symbol.for(â€™egg#loaderâ€™) çš„æ–¹å¼ï¼Œä¸»è¦çš„åŸå› è¿˜æ˜¯ä½¿ç”¨åŸå‹é“¾\n// lib/framework.js const path = require('path'); const egg = require('egg'); const EGG_PATH = Symbol.for('egg#eggPath'); class AppWorkerLoader extends egg.AppWorkerLoader { load() { super.load(); // è‡ªå·±æ‰©å±• } } class Application extends egg.Application { get [EGG_PATH]() { // è¿”å› framework è·¯å¾„ return path.dirname(__dirname); } // è¦†ç›– Egg çš„ Loaderï¼Œå¯åŠ¨æ—¶ä½¿ç”¨è¿™ä¸ª Loader get [EGG_LOADER]() { return AppWorkerLoader; } } // è¦†ç›–äº† Egg çš„ Application module.exports = Object.assign(egg, { Application, // è‡ªå®šä¹‰çš„ Loader ä¹Ÿéœ€è¦ exportï¼Œä¸Šå±‚æ¡†æ¶éœ€è¦åŸºäºè¿™ä¸ªæ‰©å±• AppWorkerLoader: AppWorkerLoader, }); AgentWorkerLoader æ‰©å±•ä¹Ÿç±»ä¼¼ï¼Œè¿™é‡Œä¸å†ä¸¾ä¾‹\nAgentWorkerLoader åŠ è½½çš„æ–‡ä»¶å¯ä»¥äº AppWorkerLoader ä¸åŒï¼Œæ¯”å¦‚ï¼šé»˜è®¤åŠ è½½æ—¶ï¼ŒEgg çš„ AppWorkerLoader ä¼šåŠ è½½ app.js è€Œ AgentWorkerLoader åŠ è½½çš„æ˜¯ agent.jsã€‚\n5. æ‹“å±•å…¶ä»–åŠŸèƒ½ ä½ è¿˜å¯ä»¥è‡ªå·±å»ä¸°å¯Œpluginsã€middleç­‰å„ç§å„æ ·çš„åŠŸèƒ½ç‰¹æ•ˆï¼Œè®©ä½ çš„ApråŠŸèƒ½å˜å¾—å˜å¾—è¶Šæ¥è¶Šå¼ºå¤§ï¼Œæ­¤å¤„ä»¥pluginsä¸ºä¾‹ã€‚\nå†…ç½® nunjucks æ¥æä¾›æœåŠ¡ç«¯æ¨¡æ¿æ¸²æŸ“èƒ½åŠ› å°è£… egg-mysql // Apr æ¡†æ¶é…ç½® // package.json { \"name\": \"apr\", \"version\": \"1.0.0\", \"dependencies\": { \"egg-mysql\": \"^3.0.0\", \"egg-view-nunjucks\": \"^2.0.0\" } } // config/plugin.js /** * @desc: framework é›†æˆå„ç§ plugins * @path: 'config/plugin.js' * */ module.exports = { // mysql mysql: { enable: false, package: 'egg-mysql', }, // add you build-in plugin here, example: nunjucks: { enable: false, package: 'egg-view-nunjucks', } } ä½¿ç”¨Aprçš„åº”ç”¨é…ç½®:\n// åº”ç”¨é…ç½® // package.json { \"dependencies\": { \"apr\": \"^1.0.0\", } } // config/plugin.js module.exports = { // å¼€å¯æ’ä»¶ mysql: true, nunjucks: true, } åœ¨æ¡†æ¶çš„åŸºç¡€ä¸Šè¿˜å¯ä»¥æ‰©å±•å‡ºæ–°çš„æ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ¡†æ¶æ˜¯å¯ä»¥æ— é™çº§ç»§æ‰¿çš„ï¼Œæœ‰ç‚¹åƒç±»çš„ç»§æ‰¿\n+-----------------------------------+--------+ | app1, app2, app3, app4 | | +-----+--------------+--------------+ | | | | framework2 | | + | Apr +--------------+ plugin | | | | framework1 | | + +--------------+--------------+ | | Egg | | +-----------------------------------+--------| | Koa | +-----------------------------------+--------+ å››ã€å•å…ƒæµ‹è¯• å¾…è¡¥å……â€¦\nå¯ å‚è€ƒ\näº”ã€æ¡†æ¶å¯åŠ¨åŸç† startCluster å¯åŠ¨ä¼ å…¥ baseDir å’Œ frameworkï¼ŒMaster è¿›ç¨‹å¯åŠ¨ Master å…ˆ fork Agent Worker æ ¹æ® framework æ‰¾åˆ°æ¡†æ¶ç›®å½•ï¼Œå®ä¾‹åŒ–è¯¥æ¡†æ¶çš„ Agent ç±» Agent æ‰¾åˆ°å®šä¹‰çš„ AgentWorkerLoaderï¼Œå¼€å§‹è¿›è¡ŒåŠ è½½ AgentWorkerLoaderï¼Œå¼€å§‹è¿›è¡ŒåŠ è½½ æ•´ä¸ªåŠ è½½è¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼ŒæŒ‰ plugin \u003e config \u003e extend \u003e agent.js \u003e å…¶ä»–æ–‡ä»¶é¡ºåºåŠ è½½ agent.js å¯è‡ªå®šä¹‰åˆå§‹åŒ–ï¼Œæ”¯æŒå¼‚æ­¥å¯åŠ¨ï¼Œå¦‚æœå®šä¹‰äº† beforeStart ä¼šç­‰å¾…æ‰§è¡Œå®Œæˆä¹‹åé€šçŸ¥ Master å¯åŠ¨å®Œæˆã€‚ Master å¾—åˆ° Agent Worker å¯åŠ¨æˆåŠŸçš„æ¶ˆæ¯ï¼Œä½¿ç”¨ cluster fork App Worker App Worker æœ‰å¤šä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥è¿™å‡ ä¸ªè¿›ç¨‹æ˜¯å¹¶è¡Œå¯åŠ¨çš„ï¼Œä½†æ‰§è¡Œé€»è¾‘æ˜¯ä¸€è‡´çš„ å•ä¸ª App Worker å’Œ Agent ç±»ä¼¼ï¼Œé€šè¿‡ framework æ‰¾åˆ°æ¡†æ¶ç›®å½•ï¼Œå®ä¾‹åŒ–è¯¥æ¡†æ¶çš„ Application ç±» Application æ‰¾åˆ° AppWorkerLoaderï¼Œå¼€å§‹è¿›è¡ŒåŠ è½½ï¼Œé¡ºåºä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¼šå¼‚æ­¥ç­‰å¾…ï¼Œå®Œæˆåé€šçŸ¥ Master å¯åŠ¨å®Œæˆ Master ç­‰å¾…å¤šä¸ª App Worker çš„æˆåŠŸæ¶ˆæ¯åå¯åŠ¨å®Œæˆï¼Œèƒ½å¯¹å¤–æä¾›æœåŠ¡ å…­ã€Aprç»“æ„ Apr â”œâ”€â”€ README.md â”œâ”€â”€ app â”‚ â”œâ”€â”€ extend â”‚ â”‚ â”œâ”€â”€ application.js â”‚ â”‚ â””â”€â”€ context.js â”‚ â””â”€â”€ service â”‚ â””â”€â”€ test.js â”œâ”€â”€ config â”‚ â”œâ”€â”€ config.default.js â”‚ â””â”€â”€ plugin.js â”œâ”€â”€ index.js â”œâ”€â”€ lib â”‚ â””â”€â”€ framework.js â”œâ”€â”€ package-lock.json â”œâ”€â”€ package.json â””â”€â”€ test â”œâ”€â”€ fixtures â”‚ â””â”€â”€ example â”‚ â”œâ”€â”€ app â”‚ â”‚ â”œâ”€â”€ controller â”‚ â”‚ â”‚ â””â”€â”€ home.js â”‚ â”‚ â””â”€â”€ router.js â”‚ â”œâ”€â”€ config â”‚ â”‚ â””â”€â”€ config.default.js â”‚ â””â”€â”€ package.json â””â”€â”€ framework.test.js å¼•ç”¨ç¤ºä¾‹ demoæºç ä»“åº“ï¼Œæ¬¢è¿ starã€‚\næœ€åï¼Œ å¸Œæœ›å¤§å®¶æ—©æ—¥å®ç°ï¼šæˆä¸ºç¼–ç¨‹é«˜æ‰‹çš„ä¼Ÿå¤§æ¢¦æƒ³ï¼ æ¬¢è¿äº¤æµ~\næœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ›œçµæ‰€æœ‰ï¼æœªç»å…è®¸ï¼Œä¸¥ç¦è½¬è½½ï¼å¯¹éæ³•è½¬è½½è€…, åŸä½œè€…ä¿ç•™é‡‡ç”¨æ³•å¾‹æ‰‹æ®µè¿½ç©¶çš„æƒåˆ©ï¼ è‹¥éœ€è½¬è½½ï¼Œè¯·è”ç³»å¾®ä¿¡å…¬ä¼—å·ï¼šè¿å…ˆç”Ÿæœ‰çŒ«ç—…ï¼Œå¯è·å–ä½œè€…è”ç³»æ–¹å¼ï¼\n","wordCount":"2483","inLanguage":"zh","datePublished":"2021-04-12T17:37:09+08:00","dateModified":"2021-04-12T17:37:09+08:00","author":{"@type":"Person","name":"æ›œçµ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lianpf.github.io/posts/backend-develop/11.apr-framework-develop/"},"publisher":{"@type":"Organization","name":"æ›œçµï¼ˆSUNï¼‰Site","logo":{"@type":"ImageObject","url":"https://lianpf.github.io/img-common/favicon.png"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lianpf.github.io/ accesskey=h title="æ›œçµï¼ˆSUNï¼‰Site (Alt + H)"><img src=https://lianpf.github.io/img-common/avatar.jpeg alt=logo aria-label=logo height=35>æ›œçµï¼ˆSUNï¼‰Site</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lianpf.github.io/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://lianpf.github.io/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://lianpf.github.io/archives/ title="â±ï¸ å½’æ¡£"><span>â±ï¸ å½’æ¡£</span></a></li><li><a href=https://lianpf.github.io/tags title="ğŸ§© æ ‡ç­¾"><span>ğŸ§© æ ‡ç­¾</span></a></li><li><a href=https://lianpf.github.io/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://lianpf.github.io/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://lianpf.github.io/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://lianpf.github.io/posts/backend-develop/>ğŸ§± åç«¯å¼€å‘</a></div><h1 class=post-title>Node: Apræ¡†æ¶å¼€å‘</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2021-04-12
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>2483å­—
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>5åˆ†é’Ÿ
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>æ›œçµ
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://lianpf.github.io/tags/node/ style=color:var(--secondary)!important>Node</a>
&nbsp;<a href=https://lianpf.github.io/tags/npm/ style=color:var(--secondary)!important>npm</a></span></span></span></span>
<span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script>
<script>let url=document.documentURI,dnsUrl="https://lianpf.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:null,region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e4%b8%80%e8%83%8c%e6%99%af aria-label=ä¸€ã€èƒŒæ™¯>ä¸€ã€èƒŒæ™¯</a></li><li><a href=#%e4%ba%8c%e6%a1%86%e6%9e%b6%e4%b8%8e%e5%a4%9a%e8%bf%9b%e7%a8%8b aria-label=äºŒã€æ¡†æ¶ä¸å¤šè¿›ç¨‹>äºŒã€æ¡†æ¶ä¸å¤šè¿›ç¨‹</a></li><li><a href=#%e4%b8%89%e5%ae%9a%e5%88%b6%e6%a1%86%e6%9e%b6-apr aria-label="ä¸‰ã€å®šåˆ¶æ¡†æ¶: Apr">ä¸‰ã€å®šåˆ¶æ¡†æ¶: Apr</a><ul><li><a href=#1-create-apr--init aria-label="1. create Apr &amp;amp; init">1. create Apr & init</a></li><li><a href=#2-%e6%a1%86%e6%9e%b6%e7%bb%a7%e6%89%bf aria-label="2. æ¡†æ¶ç»§æ‰¿">2. æ¡†æ¶ç»§æ‰¿</a></li><li><a href=#3-%e8%87%aa%e5%ae%9a%e4%b9%89-agent aria-label="3. è‡ªå®šä¹‰ Agent">3. è‡ªå®šä¹‰ Agent</a></li><li><a href=#4-%e8%87%aa%e5%ae%9a%e4%b9%89-loader aria-label="4. è‡ªå®šä¹‰ Loader">4. è‡ªå®šä¹‰ Loader</a></li><li><a href=#5-%e6%8b%93%e5%b1%95%e5%85%b6%e4%bb%96%e5%8a%9f%e8%83%bd aria-label="5. æ‹“å±•å…¶ä»–åŠŸèƒ½">5. æ‹“å±•å…¶ä»–åŠŸèƒ½</a></li></ul></li><li><a href=#%e5%9b%9b%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95 aria-label=å››ã€å•å…ƒæµ‹è¯•>å››ã€å•å…ƒæµ‹è¯•</a></li><li><a href=#%e4%ba%94%e6%a1%86%e6%9e%b6%e5%90%af%e5%8a%a8%e5%8e%9f%e7%90%86 aria-label=äº”ã€æ¡†æ¶å¯åŠ¨åŸç†>äº”ã€æ¡†æ¶å¯åŠ¨åŸç†</a></li><li><a href=#%e5%85%adapr%e7%bb%93%e6%9e%84 aria-label=å…­ã€Aprç»“æ„>å…­ã€<code>Apr</code>ç»“æ„</a></li><li><a href=#%e5%bc%95%e7%94%a8%e7%a4%ba%e4%be%8b aria-label=å¼•ç”¨ç¤ºä¾‹>å¼•ç”¨ç¤ºä¾‹</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>åœ¨ä½ä»£ç å¹³å°å¼€å‘è¿‡ç¨‹ï¼Œç”±äºç‰©æ–™ç®¡ç†ç³»ç»Ÿä»¥åŠNode Server ä¸­é—´å±‚çš„æ­å»ºä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¾ˆå¤šé€šç”¨çš„åº“å’Œé…ç½®å¯ä»¥&mldr;</p><h2 id=ä¸€èƒŒæ™¯>ä¸€ã€èƒŒæ™¯<a hidden class=anchor aria-hidden=true href=#ä¸€èƒŒæ™¯>#</a></h2><p>åœ¨ä½ä»£ç å¹³å°å¼€å‘è¿‡ç¨‹ï¼Œç”±äºç‰©æ–™ç®¡ç†ç³»ç»Ÿä»¥åŠNode Server ä¸­é—´å±‚çš„æ­å»ºä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¾ˆå¤šé€šç”¨çš„åº“å’Œé…ç½®å¯ä»¥æ²‰æ·€ï¼Œå½¢æˆå¯å¤åˆ¶çš„è§£å†³æ–¹æ¡ˆã€‚æ‰€ä»¥ï¼ŒåŸºäºå¼€æºæ¡†æ¶Egg.jsï¼ˆåŸºäºKoa2ï¼‰è¿›è¡Œäº†æ‹“å±•å°è£…å½¢æˆäº†åˆç‰ˆAprã€‚</p><p>æ•´ä¸ªå›¢é˜Ÿä¾èµ–åˆç‰ˆAprä½œä¸ºç»Ÿä¸€çš„Nodeæ–¹æ¡ˆï¼Œéšç€ä¸šåŠ¡åœºæ™¯è¶Šæ¥è¶Šä¸°å¯Œï¼Œä¸€äº›æ’ä»¶ã€middleç­‰å…¬å…±é…ç½®æˆä¸ºæœ€ä½³å®è·µåï¼Œé€æ¸ä¸‹æ²‰åˆ°Apræ¡†æ¶ä¸­ï¼Œè®©Aprè¶Šæ¥è¶Šæˆç†Ÿã€‚è€Œåï¼Œä¾èµ–Aprçš„å…¶ä»–é¡¹ç›®ä»…éœ€ç®€å•çš„å‡çº§ä¸‹æ¡†æ¶çš„ç‰ˆæœ¬å³å¯äº«å—åˆ°Aprå¸¦æ¥çš„çº¢åˆ©ã€‚</p><p>å¦‚æœä½ çš„å›¢é˜Ÿä¹Ÿåœ¨è€ƒè™‘æ­å»ºç±»ä¼¼çš„æ¡†æ¶ï¼Œé‚£ä¹ˆè¯·è€ƒè™‘å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li>å¦‚æœä½ çš„å›¢é˜Ÿé‡åˆ°è¿‡ï¼š<ul><li>ç»´æŠ¤å¾ˆå¤šä¸ªé¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½éœ€è¦å¤åˆ¶æ‹·è´è¯¸å¦‚ <code>gulpfile.js</code> / <code>webpack.config.js</code> ä¹‹ç±»çš„æ–‡ä»¶</li><li>æ¯ä¸ªé¡¹ç›®éƒ½éœ€è¦ä½¿ç”¨ä¸€äº›ç›¸åŒçš„ç±»åº“ï¼Œç›¸åŒçš„é…ç½®</li><li>åœ¨æ–°é¡¹ç›®ä¸­å¯¹ä¸Šé¢çš„é…ç½®åšäº†ä¸€ä¸ªä¼˜åŒ–åï¼Œå¦‚ä½•åŒæ­¥åˆ°å…¶ä»–é¡¹ç›®ï¼Ÿ</li></ul></li><li>å¦‚æœä½ çš„å›¢é˜Ÿéœ€è¦ï¼š<ul><li>ç»Ÿä¸€çš„æŠ€æœ¯é€‰å‹ï¼Œæ¯”å¦‚æ•°æ®åº“ã€æ¨¡æ¿ã€å‰ç«¯æ¡†æ¶åŠå„ç§ä¸­é—´ä»¶è®¾æ–½éƒ½éœ€è¦é€‰å‹ï¼Œè€Œæ¡†æ¶å°è£…åä¿è¯åº”ç”¨ä½¿ç”¨ä¸€å¥—æ¶æ„</li><li>ç»Ÿä¸€çš„é»˜è®¤é…ç½®ï¼Œå¼€æºç¤¾åŒºçš„é…ç½®å¯èƒ½ä¸é€‚ç”¨äºå…¬å¸ï¼Œè€Œåˆä¸å¸Œæœ›åº”ç”¨å»é…ç½®</li><li>ç»Ÿä¸€çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œé€šè¿‡æ¡†æ¶å’Œå¹³å°çš„åŒå‘æ§åˆ¶ï¼Œåº”ç”¨åªéœ€è¦å…³æ³¨è‡ªå·±çš„ä»£ç ï¼Œå…·ä½“æŸ¥çœ‹<a href=https://eggjs.org/zh-cn/core/deployment.html>åº”ç”¨éƒ¨ç½²</a></li><li>ç»Ÿä¸€çš„ä»£ç é£æ ¼ï¼Œæ¡†æ¶ä¸ä»…ä»…è§£å†³ä»£ç é‡ç”¨é—®é¢˜ï¼Œè¿˜å¯ä»¥å¯¹åº”ç”¨åšä¸€å®šçº¦æŸï¼Œä½œä¸ºä¼ä¸šæ¡†æ¶æ˜¯å¾ˆå¿…è¦çš„ã€‚Aprä¾èµ–äº Egg, Egg åœ¨ Koa åŸºç¡€ä¸Šåšäº†å¾ˆå¤šçº¦å®šï¼Œæ¡†æ¶å¯ä»¥ä½¿ç”¨ <a href=https://eggjs.org/zh-cn/advanced/loader.html>Loader</a> è‡ªå·±å®šä¹‰ä»£ç è§„åˆ™</li></ul></li></ul><p>å¦‚æœéœ€è¦ï¼Œä»¥ä¸‹æ˜¯Aprçš„ç®€æ˜“ç‰ˆæ­å»ºè¿‡ç¨‹ï¼Œä¹Ÿè®¸å¯¹ä½ æœ‰æ‰€å¸®åŠ©:</p><blockquote><p>ç¨³å®šæˆç†Ÿç‰ˆæ¶‰åŠåˆ°å…¬å¸ç›¸å…³ä¸šåŠ¡ï¼Œæ•…ä»…å­˜å†…ç½‘ä¸­ï¼Œä¸å¯¹å¤–æš´éœ²ï¼Œè¯·å‹¿ç§èŠè·å–</p></blockquote><h2 id=äºŒæ¡†æ¶ä¸å¤šè¿›ç¨‹>äºŒã€æ¡†æ¶ä¸å¤šè¿›ç¨‹<a hidden class=anchor aria-hidden=true href=#äºŒæ¡†æ¶ä¸å¤šè¿›ç¨‹>#</a></h2><p>æ¡†æ¶çš„æ‰©å±•æ˜¯å’Œå¤šè¿›ç¨‹æ¨¡å‹æœ‰å…³çš„ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“å¤šè¿›ç¨‹æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦æ‰©å±•çš„ç±»æœ‰ Agent å’Œ Applicationã€‚</p><p>åœ¨ Agent Worker å¯åŠ¨çš„æ—¶å€™ä¼šå®ä¾‹åŒ– Agentï¼Œè€Œåœ¨ App Worker å¯åŠ¨æ—¶ä¼šå®ä¾‹åŒ– Applicationï¼Œè¿™ä¸¤ä¸ªç±»åˆåŒæ—¶ç»§æ‰¿ EggCoreã€‚</p><p>EggCore å¯ä»¥çœ‹åš Koa Application çš„å‡çº§ç‰ˆï¼Œé»˜è®¤å†…ç½® Loaderã€Router åŠåº”ç”¨å¼‚æ­¥å¯åŠ¨ç­‰åŠŸèƒ½ï¼Œå¯ä»¥çœ‹åšæ˜¯æ”¯æŒ Loader çš„ Koaã€‚
è€Œæˆ‘ä»¬è¦æ­å»ºçš„Apråˆ™ä¾èµ–äºEggCoreã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>      Koa Application
</span></span><span style=display:flex><span>             ^
</span></span><span style=display:flex><span>          EggCore
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>             ^
</span></span><span style=display:flex><span>          AprCore
</span></span><span style=display:flex><span>             ^
</span></span><span style=display:flex><span>      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>      â”‚              â”‚
</span></span><span style=display:flex><span>  Apr Agent      Apr Application
</span></span><span style=display:flex><span>     ^               ^
</span></span><span style=display:flex><span>agent worker     app worker
</span></span></code></pre></div><h2 id=ä¸‰å®šåˆ¶æ¡†æ¶-apr>ä¸‰ã€å®šåˆ¶æ¡†æ¶: Apr<a hidden class=anchor aria-hidden=true href=#ä¸‰å®šåˆ¶æ¡†æ¶-apr>#</a></h2><h3 id=1-create-apr--init>1. create Apr & init<a hidden class=anchor aria-hidden=true href=#1-create-apr--init>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ mkdir apr &amp;&amp; cd apr
</span></span><span style=display:flex><span>$ npm init egg --type=framework
</span></span><span style=display:flex><span>$ npm i
</span></span><span style=display:flex><span>$ npm test
</span></span></code></pre></div><h3 id=2-æ¡†æ¶ç»§æ‰¿>2. æ¡†æ¶ç»§æ‰¿<a hidden class=anchor aria-hidden=true href=#2-æ¡†æ¶ç»§æ‰¿>#</a></h3><p>æ¡†æ¶æ”¯æŒç»§æ‰¿å…³ç³»ï¼Œå¯ä»¥æŠŠæ¡†æ¶æ¯”ä½œä¸€ä¸ªç±»ï¼ŒåŸºç±»æ˜¯ Egg æ¡†æ¶ï¼Œå®šä¹‰ä¸€ä¸ªæ¡†æ¶éœ€è¦ç»§æ‰¿äºEggä¸”å®ç° Egg æ‰€æœ‰çš„ APIã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>// package.json
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;name&#34;: &#34;apr&#34;,
</span></span><span style=display:flex><span>  &#34;dependencies&#34;: {
</span></span><span style=display:flex><span>    &#34;egg&#34;: &#34;^2.0.0&#34;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// index.js
</span></span><span style=display:flex><span>module.exports = require(&#39;./lib/framework.js&#39;);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// lib/framework.js
</span></span><span style=display:flex><span>const path = require(&#39;path&#39;);
</span></span><span style=display:flex><span>const egg = require(&#39;egg&#39;);
</span></span><span style=display:flex><span>const EGG_PATH = Symbol.for(&#39;egg#eggPath&#39;);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class Application extends egg.Application {
</span></span><span style=display:flex><span>  get [EGG_PATH]() {
</span></span><span style=display:flex><span>    // è¿”å› framework è·¯å¾„
</span></span><span style=display:flex><span>    return path.dirname(__dirname);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// è¦†ç›–äº† Egg çš„ Application
</span></span><span style=display:flex><span>module.exports = Object.assign(egg, {
</span></span><span style=display:flex><span>  Application,
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>åº”ç”¨å¯åŠ¨æ—¶éœ€è¦æŒ‡å®šæ¡†æ¶åï¼ˆåœ¨ package.json æŒ‡å®š egg.frameworkï¼Œé»˜è®¤ä¸º eggï¼‰ï¼ŒLoader å°†ä» node_modules æ‰¾æŒ‡å®šæ¨¡å—ä½œä¸ºæ¡†æ¶ï¼Œå¹¶åŠ è½½å…¶ export çš„ Application</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;scripts&#34;: {
</span></span><span style=display:flex><span>    &#34;dev&#34;: &#34;egg-bin dev&#34;
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  &#34;egg&#34;: {
</span></span><span style=display:flex><span>    &#34;framework&#34;: &#34;apr&#34;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ç°åœ¨ <code>apr</code> æ¡†æ¶ç›®å½•å·²ç»æ˜¯ä¸€ä¸ª loadUnitï¼Œé‚£ä¹ˆç›¸åº”ç›®å½•å’Œæ–‡ä»¶ï¼ˆå¦‚ app å’Œ configï¼‰éƒ½ä¼šè¢«åŠ è½½</p><h3 id=3-è‡ªå®šä¹‰-agent>3. è‡ªå®šä¹‰ Agent<a hidden class=anchor aria-hidden=true href=#3-è‡ªå®šä¹‰-agent>#</a></h3><p>ä¸Šé¢çš„ä¾‹å­è‡ªå®šä¹‰äº† Applicationï¼Œå› ä¸º Egg æ˜¯å¤šè¿›ç¨‹æ¨¡å‹ï¼Œæ‰€ä»¥è¿˜éœ€è¦å®šä¹‰ Agentï¼ŒåŸç†æ˜¯ä¸€æ ·çš„</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>// lib/framework.js
</span></span><span style=display:flex><span>const path = require(&#39;path&#39;);
</span></span><span style=display:flex><span>const egg = require(&#39;egg&#39;);
</span></span><span style=display:flex><span>const EGG_PATH = Symbol.for(&#39;egg#eggPath&#39;);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class Application extends egg.Application {
</span></span><span style=display:flex><span>  get [EGG_PATH]() {
</span></span><span style=display:flex><span>    // è¿”å› framework è·¯å¾„
</span></span><span style=display:flex><span>    return path.dirname(__dirname);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class Agent extends egg.Agent {
</span></span><span style=display:flex><span>  get [EGG_PATH]() {
</span></span><span style=display:flex><span>    return path.dirname(__dirname);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// è¦†ç›–äº† Egg çš„ Application
</span></span><span style=display:flex><span>module.exports = Object.assign(egg, {
</span></span><span style=display:flex><span>  Application,
</span></span><span style=display:flex><span>  Agent,
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><blockquote><p>ä½†å› ä¸º Agent å’Œ Application æ˜¯ä¸¤ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥ API æœ‰å¯èƒ½ä¸ä¸€è‡´</p></blockquote><h3 id=4-è‡ªå®šä¹‰-loader>4. è‡ªå®šä¹‰ Loader<a hidden class=anchor aria-hidden=true href=#4-è‡ªå®šä¹‰-loader>#</a></h3><p>Loader åº”ç”¨å¯åŠ¨çš„æ ¸å¿ƒï¼Œä½¿ç”¨å®ƒè¿˜èƒ½è§„èŒƒåº”ç”¨ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºè¿™ä¸ªç±»æ‰©å±•æ›´å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚åŠ è½½æ•°æ®ä»£ç ã€‚</p><blockquote><p>æ‰©å±• Loader è¿˜èƒ½è¦†ç›–é»˜è®¤çš„å®ç°ï¼Œæˆ–è°ƒæ•´ç°æœ‰çš„åŠ è½½é¡ºåºç­‰</p></blockquote><blockquote><p>è‡ªå®šä¹‰ Loader ä¹Ÿæ˜¯ç”¨ Symbol.for(&rsquo;egg#loader&rsquo;) çš„æ–¹å¼ï¼Œä¸»è¦çš„åŸå› è¿˜æ˜¯ä½¿ç”¨åŸå‹é“¾</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>// lib/framework.js
</span></span><span style=display:flex><span>const path = require(&#39;path&#39;);
</span></span><span style=display:flex><span>const egg = require(&#39;egg&#39;);
</span></span><span style=display:flex><span>const EGG_PATH = Symbol.for(&#39;egg#eggPath&#39;);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class AppWorkerLoader extends egg.AppWorkerLoader {
</span></span><span style=display:flex><span>  load() {
</span></span><span style=display:flex><span>    super.load();
</span></span><span style=display:flex><span>    // è‡ªå·±æ‰©å±•
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class Application extends egg.Application {
</span></span><span style=display:flex><span>  get [EGG_PATH]() {
</span></span><span style=display:flex><span>    // è¿”å› framework è·¯å¾„
</span></span><span style=display:flex><span>    return path.dirname(__dirname);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  // è¦†ç›– Egg çš„ Loaderï¼Œå¯åŠ¨æ—¶ä½¿ç”¨è¿™ä¸ª Loader
</span></span><span style=display:flex><span>  get [EGG_LOADER]() {
</span></span><span style=display:flex><span>    return AppWorkerLoader;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// è¦†ç›–äº† Egg çš„ Application
</span></span><span style=display:flex><span>module.exports = Object.assign(egg, {
</span></span><span style=display:flex><span>  Application,
</span></span><span style=display:flex><span>  // è‡ªå®šä¹‰çš„ Loader ä¹Ÿéœ€è¦ exportï¼Œä¸Šå±‚æ¡†æ¶éœ€è¦åŸºäºè¿™ä¸ªæ‰©å±•
</span></span><span style=display:flex><span>  AppWorkerLoader: AppWorkerLoader,
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>AgentWorkerLoader æ‰©å±•ä¹Ÿç±»ä¼¼ï¼Œè¿™é‡Œä¸å†ä¸¾ä¾‹</p><blockquote><p>AgentWorkerLoader åŠ è½½çš„æ–‡ä»¶å¯ä»¥äº AppWorkerLoader ä¸åŒï¼Œæ¯”å¦‚ï¼šé»˜è®¤åŠ è½½æ—¶ï¼ŒEgg çš„ AppWorkerLoader ä¼šåŠ è½½ app.js è€Œ AgentWorkerLoader åŠ è½½çš„æ˜¯ agent.jsã€‚</p></blockquote><h3 id=5-æ‹“å±•å…¶ä»–åŠŸèƒ½>5. æ‹“å±•å…¶ä»–åŠŸèƒ½<a hidden class=anchor aria-hidden=true href=#5-æ‹“å±•å…¶ä»–åŠŸèƒ½>#</a></h3><p>ä½ è¿˜å¯ä»¥è‡ªå·±å»ä¸°å¯Œpluginsã€middleç­‰å„ç§å„æ ·çš„åŠŸèƒ½ç‰¹æ•ˆï¼Œè®©ä½ çš„<code>Apr</code>åŠŸèƒ½å˜å¾—å˜å¾—è¶Šæ¥è¶Šå¼ºå¤§ï¼Œæ­¤å¤„ä»¥pluginsä¸ºä¾‹ã€‚</p><ul><li>å†…ç½® <code>nunjucks</code> æ¥æä¾›æœåŠ¡ç«¯æ¨¡æ¿æ¸²æŸ“èƒ½åŠ›</li><li>å°è£… <code>egg-mysql</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>// Apr æ¡†æ¶é…ç½®
</span></span><span style=display:flex><span>// package.json
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;name&#34;: &#34;apr&#34;,
</span></span><span style=display:flex><span>  &#34;version&#34;: &#34;1.0.0&#34;,
</span></span><span style=display:flex><span>  &#34;dependencies&#34;: {
</span></span><span style=display:flex><span>    &#34;egg-mysql&#34;: &#34;^3.0.0&#34;,
</span></span><span style=display:flex><span>    &#34;egg-view-nunjucks&#34;: &#34;^2.0.0&#34;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// config/plugin.js
</span></span><span style=display:flex><span>/**
</span></span><span style=display:flex><span> * @desc: framework é›†æˆå„ç§ plugins
</span></span><span style=display:flex><span> * @path: &#39;config/plugin.js&#39;
</span></span><span style=display:flex><span> * */
</span></span><span style=display:flex><span>module.exports = {
</span></span><span style=display:flex><span>  // mysql
</span></span><span style=display:flex><span>  mysql: {
</span></span><span style=display:flex><span>    enable: false,
</span></span><span style=display:flex><span>    package: &#39;egg-mysql&#39;,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  // add you build-in plugin here, example:
</span></span><span style=display:flex><span>  nunjucks: {
</span></span><span style=display:flex><span>    enable: false,
</span></span><span style=display:flex><span>    package: &#39;egg-view-nunjucks&#39;,
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä½¿ç”¨Aprçš„åº”ç”¨é…ç½®:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>// åº”ç”¨é…ç½®
</span></span><span style=display:flex><span>// package.json
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;dependencies&#34;: {
</span></span><span style=display:flex><span>    &#34;apr&#34;: &#34;^1.0.0&#34;,
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// config/plugin.js
</span></span><span style=display:flex><span>module.exports = {
</span></span><span style=display:flex><span>  // å¼€å¯æ’ä»¶
</span></span><span style=display:flex><span>  mysql: true,
</span></span><span style=display:flex><span>  nunjucks: true,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>åœ¨æ¡†æ¶çš„åŸºç¡€ä¸Šè¿˜å¯ä»¥æ‰©å±•å‡ºæ–°çš„æ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ¡†æ¶æ˜¯å¯ä»¥æ— é™çº§ç»§æ‰¿çš„ï¼Œæœ‰ç‚¹åƒç±»çš„ç»§æ‰¿</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>+-----------------------------------+--------+
</span></span><span style=display:flex><span>|      app1, app2, app3, app4       |        |
</span></span><span style=display:flex><span>+-----+--------------+--------------+        |
</span></span><span style=display:flex><span>|     |              |  framework2  |        |
</span></span><span style=display:flex><span>+     |       Apr    +--------------+ plugin |
</span></span><span style=display:flex><span>|     |              |  framework1  |        |
</span></span><span style=display:flex><span>+     +--------------+--------------+        |
</span></span><span style=display:flex><span>|                   Egg             |        |
</span></span><span style=display:flex><span>+-----------------------------------+--------|
</span></span><span style=display:flex><span>|                   Koa                      |
</span></span><span style=display:flex><span>+-----------------------------------+--------+
</span></span></code></pre></div><h2 id=å››å•å…ƒæµ‹è¯•>å››ã€å•å…ƒæµ‹è¯•<a hidden class=anchor aria-hidden=true href=#å››å•å…ƒæµ‹è¯•>#</a></h2><blockquote><p>å¾…è¡¥å……&mldr;</p></blockquote><p>å¯ <a href=https://zhuanlan.zhihu.com/p/154643011>å‚è€ƒ</a></p><h2 id=äº”æ¡†æ¶å¯åŠ¨åŸç†>äº”ã€æ¡†æ¶å¯åŠ¨åŸç†<a hidden class=anchor aria-hidden=true href=#äº”æ¡†æ¶å¯åŠ¨åŸç†>#</a></h2><ul><li>startCluster å¯åŠ¨ä¼ å…¥ baseDir å’Œ frameworkï¼ŒMaster è¿›ç¨‹å¯åŠ¨</li><li>Master å…ˆ fork Agent Worker<ul><li>æ ¹æ® framework æ‰¾åˆ°æ¡†æ¶ç›®å½•ï¼Œå®ä¾‹åŒ–è¯¥æ¡†æ¶çš„ Agent ç±»</li><li>Agent æ‰¾åˆ°å®šä¹‰çš„ AgentWorkerLoaderï¼Œå¼€å§‹è¿›è¡ŒåŠ è½½</li><li>AgentWorkerLoaderï¼Œå¼€å§‹è¿›è¡ŒåŠ è½½ æ•´ä¸ªåŠ è½½è¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼ŒæŒ‰ plugin > config > extend > agent.js > å…¶ä»–æ–‡ä»¶é¡ºåºåŠ è½½</li><li>agent.js å¯è‡ªå®šä¹‰åˆå§‹åŒ–ï¼Œæ”¯æŒå¼‚æ­¥å¯åŠ¨ï¼Œå¦‚æœå®šä¹‰äº† beforeStart ä¼šç­‰å¾…æ‰§è¡Œå®Œæˆä¹‹åé€šçŸ¥ Master å¯åŠ¨å®Œæˆã€‚</li></ul></li><li>Master å¾—åˆ° Agent Worker å¯åŠ¨æˆåŠŸçš„æ¶ˆæ¯ï¼Œä½¿ç”¨ cluster fork App Worker<ul><li>App Worker æœ‰å¤šä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥è¿™å‡ ä¸ªè¿›ç¨‹æ˜¯å¹¶è¡Œå¯åŠ¨çš„ï¼Œä½†æ‰§è¡Œé€»è¾‘æ˜¯ä¸€è‡´çš„</li><li>å•ä¸ª App Worker å’Œ Agent ç±»ä¼¼ï¼Œé€šè¿‡ framework æ‰¾åˆ°æ¡†æ¶ç›®å½•ï¼Œå®ä¾‹åŒ–è¯¥æ¡†æ¶çš„ Application ç±»</li><li>Application æ‰¾åˆ° AppWorkerLoaderï¼Œå¼€å§‹è¿›è¡ŒåŠ è½½ï¼Œé¡ºåºä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¼šå¼‚æ­¥ç­‰å¾…ï¼Œå®Œæˆåé€šçŸ¥ Master å¯åŠ¨å®Œæˆ</li></ul></li><li>Master ç­‰å¾…å¤šä¸ª App Worker çš„æˆåŠŸæ¶ˆæ¯åå¯åŠ¨å®Œæˆï¼Œèƒ½å¯¹å¤–æä¾›æœåŠ¡</li></ul><h2 id=å…­aprç»“æ„>å…­ã€<code>Apr</code>ç»“æ„<a hidden class=anchor aria-hidden=true href=#å…­aprç»“æ„>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Apr
</span></span><span style=display:flex><span>â”œâ”€â”€ README.md
</span></span><span style=display:flex><span>â”œâ”€â”€ app
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ extend
</span></span><span style=display:flex><span>â”‚   â”‚   â”œâ”€â”€ application.js
</span></span><span style=display:flex><span>â”‚   â”‚   â””â”€â”€ context.js
</span></span><span style=display:flex><span>â”‚   â””â”€â”€ service
</span></span><span style=display:flex><span>â”‚       â””â”€â”€ test.js
</span></span><span style=display:flex><span>â”œâ”€â”€ config
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ config.default.js
</span></span><span style=display:flex><span>â”‚   â””â”€â”€ plugin.js
</span></span><span style=display:flex><span>â”œâ”€â”€ index.js
</span></span><span style=display:flex><span>â”œâ”€â”€ lib
</span></span><span style=display:flex><span>â”‚   â””â”€â”€ framework.js
</span></span><span style=display:flex><span>â”œâ”€â”€ package-lock.json
</span></span><span style=display:flex><span>â”œâ”€â”€ package.json
</span></span><span style=display:flex><span>â””â”€â”€ test
</span></span><span style=display:flex><span>    â”œâ”€â”€ fixtures
</span></span><span style=display:flex><span>    â”‚   â””â”€â”€ example
</span></span><span style=display:flex><span>    â”‚       â”œâ”€â”€ app
</span></span><span style=display:flex><span>    â”‚       â”‚   â”œâ”€â”€ controller
</span></span><span style=display:flex><span>    â”‚       â”‚   â”‚   â””â”€â”€ home.js
</span></span><span style=display:flex><span>    â”‚       â”‚   â””â”€â”€ router.js
</span></span><span style=display:flex><span>    â”‚       â”œâ”€â”€ config
</span></span><span style=display:flex><span>    â”‚       â”‚   â””â”€â”€ config.default.js
</span></span><span style=display:flex><span>    â”‚       â””â”€â”€ package.json
</span></span><span style=display:flex><span>    â””â”€â”€ framework.test.js
</span></span></code></pre></div><hr><h2 id=å¼•ç”¨ç¤ºä¾‹>å¼•ç”¨ç¤ºä¾‹<a hidden class=anchor aria-hidden=true href=#å¼•ç”¨ç¤ºä¾‹>#</a></h2><p><a href=https://github.com/lianpf/examples/tree/master/node/apr-example>demoæºç ä»“åº“</a>ï¼Œæ¬¢è¿ <code>star</code>ã€‚</p><hr><p><strong>æœ€åï¼Œ å¸Œæœ›å¤§å®¶æ—©æ—¥å®ç°ï¼šæˆä¸ºç¼–ç¨‹é«˜æ‰‹çš„ä¼Ÿå¤§æ¢¦æƒ³ï¼</strong><br><strong>æ¬¢è¿äº¤æµ~</strong></p><img src=/img-common/weChatPublic.jpg alt=å¾®ä¿¡å…¬ä¼—å· width=600 height=286><p><strong>æœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ›œçµæ‰€æœ‰ï¼æœªç»å…è®¸ï¼Œä¸¥ç¦è½¬è½½ï¼å¯¹éæ³•è½¬è½½è€…, åŸä½œè€…ä¿ç•™é‡‡ç”¨æ³•å¾‹æ‰‹æ®µè¿½ç©¶çš„æƒåˆ©ï¼</strong><br><strong>è‹¥éœ€è½¬è½½ï¼Œè¯·è”ç³»å¾®ä¿¡å…¬ä¼—å·ï¼šè¿å…ˆç”Ÿæœ‰çŒ«ç—…ï¼Œå¯è·å–ä½œè€…è”ç³»æ–¹å¼ï¼</strong></p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://lianpf.github.io/posts/backend-develop/12.apr-framework-docs/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Node: Apræ¡†æ¶ä½¿ç”¨æ–‡æ¡£</span></a>
<a class=next href=https://lianpf.github.io/posts/other/11.mysql-gui/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>MySQL 8.0é—®é¢˜æ’æŸ¥</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Node: Apræ¡†æ¶å¼€å‘ on twitter" href="https://twitter.com/intent/tweet/?text=Node%3a%20Apr%e6%a1%86%e6%9e%b6%e5%bc%80%e5%8f%91&amp;url=https%3a%2f%2flianpf.github.io%2fposts%2fbackend-develop%2f11.apr-framework-develop%2f&amp;hashtags=Node%2cnpm"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Node: Apræ¡†æ¶å¼€å‘ on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flianpf.github.io%2fposts%2fbackend-develop%2f11.apr-framework-develop%2f&amp;title=Node%3a%20Apr%e6%a1%86%e6%9e%b6%e5%bc%80%e5%8f%91&amp;summary=Node%3a%20Apr%e6%a1%86%e6%9e%b6%e5%bc%80%e5%8f%91&amp;source=https%3a%2f%2flianpf.github.io%2fposts%2fbackend-develop%2f11.apr-framework-develop%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Node: Apræ¡†æ¶å¼€å‘ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2flianpf.github.io%2fposts%2fbackend-develop%2f11.apr-framework-develop%2f&title=Node%3a%20Apr%e6%a1%86%e6%9e%b6%e5%bc%80%e5%8f%91"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Node: Apræ¡†æ¶å¼€å‘ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2flianpf.github.io%2fposts%2fbackend-develop%2f11.apr-framework-develop%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Node: Apræ¡†æ¶å¼€å‘ on whatsapp" href="https://api.whatsapp.com/send?text=Node%3a%20Apr%e6%a1%86%e6%9e%b6%e5%bc%80%e5%8f%91%20-%20https%3a%2f%2flianpf.github.io%2fposts%2fbackend-develop%2f11.apr-framework-develop%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Node: Apræ¡†æ¶å¼€å‘ on telegram" href="https://telegram.me/share/url?text=Node%3a%20Apr%e6%a1%86%e6%9e%b6%e5%bc%80%e5%8f%91&amp;url=https%3a%2f%2flianpf.github.io%2fposts%2fbackend-develop%2f11.apr-framework-develop%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></div><script src=https://utteranc.es/client.js repo=lianpf/lianpf.github.io issue-term=title label=comments theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>Copyright
&copy;
2016-2024
<a href=https://lianpf.github.io/ style=color:#939393>æ›œçµï¼ˆSUNï¼‰Site</a>.
åŸºäº Hugo å¼•æ“å’Œ PaperMod ä¸»é¢˜</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href,s=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œæ›œçµï¼ˆSUNï¼‰Siteã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>